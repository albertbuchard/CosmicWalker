{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2bae5a7bb47a3fd94eb5","webpack:///external {\"commonjs\":\"experiment-js\",\"commonjs2\":\"experiment-js\",\"amd\":\"experiment-js\",\"root\":\"experiment\"}","webpack:///external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}","webpack:///external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}","webpack:///external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}","webpack:///./src/task/scenes/main/functions/globalFunctions.js","webpack:///./src/task/startup/startup.js","webpack:///./builder.js","webpack:///./src/config.js","webpack:///./src/task/scenes/main/MainScene.js","webpack:///./src/task/scenes/main/states/active.js","webpack:///./src/task/scenes/main/states/end.js","webpack:///./src/task/scenes/main/states/pause.js","webpack:///./src/task/scenes/main/states/running.js","webpack:///./src/task/scenes/main/states/tryout.js","webpack:///./src/task/scenes/main/states/tutorial.js","webpack:///./src/task/utilities/taskUtilities.js","webpack:///external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}","webpack:///external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}"],"names":["placePoints","points","length","stateManager","pointSpheres","get","redraw","tempPointSpheres","i","point","pointSphere","Mesh","CreateSphere","scene","position","Vector3","push","set","updatePoints","call","hidePointSpheres","visibility","showPointSpheres","setViewForDirection","direction","camera","activeCamera","xPos","setTarget","Zero","addButton","options","taskObject","Error","canvas","baseOptions","id","timeInMs","text","x","y","width","height","fill","Canvas2D","GetSolidColorBrush","Color4","clickEventData","fontName","baseOpacity","hoverOpacity","zOrder","marginAlignment","fontSignedDistanceField","margin","padding","parent","leftPixels","rightPixels","topPixels","bottomPixels","extend","buttonOptions","roundRadius","children","Text2D","marginVAlignment","marginHAlignment","buttonRect","Rectangle2D","opacity","pointerEventObservable","add","PrimitivePointerInfo","PointerOver","PointerOut","constructor","happenedAt","data","button","addEvent","PointerUp","setMargins","prim","showCross","crossSheet","cloneAssetIntoScene","R","hasAlpha","guiCanvas","cross","Sprite2D","dispose","spriteSize","Size","spriteLocation","Vector2","spriteFrame","levelVisible","hideCross","highlightPosition","promise","hightlight","type","explode","meshes","parameters","explosionTexture","mesh","particleSystem","ParticleSystem","particleTexture","emitter","minEmitBox","maxEmitBox","color1","color2","colorDead","minSize","maxSize","minLifeTime","maxLifeTime","emitRate","blendMode","BLENDMODE_ONEONE","gravity","direction1","direction2","minAngularSpeed","maxAngularSpeed","Math","PI","minEmitPower","maxEmitPower","updateSpeed","targetStopDuration","disposeOnStop","start","setBlackScreen","on","elements2D","getGlobal","has","blackScreen","size","checkIdleAndConnection","deferred","returnToState","dataManager","connection","shouldCheckTime","query","then","r","delay","lastInteraction","delayMin","goToState","states_end","currentStateKey","catch","states_idle","onNext","events_unfrozen","state","freeze","modal","title","lostConnectionTitle","content","lostConnectionContent","Promise","resolve","window","calibrator","defferedDomLoaded","document","addEventListener","scripts","getElementsByTagName","assetsFolderFullpath","src","delimiterIndices","indicesOf","substr","p1","p2","addFiles","loadingPromise","all","DEBUG_MODE_ON","mergeWith","level","registerSceneGenerator","sceneNames","rate","numberOfPoints","maxObservationTime","fixationTime","ITI","trialsBeforePause","pauseTime","explosionTime","assetsToLoad","path","parametersNames","paramBox","bind","tempMaxNumberOfRetry","MAX_NUMBER_OF_RETRY","endpoint","loginForm","fields","userId","constraints","authorizedValues","password","format","callback","credentials","value","form","buttonText","context","states_active","authorize_manual_login","setConnection","signInForm","loggedIn","login","startTask","message","queryString","currentScene","e","loginError","en","open","close","require","MainScene","optionsBase","sceneKey","canvasBackground","backgroundRoundRadius","clearColor","canvasPercentWidth","canvasPercentHeight","mode","create3DScene","light0","HemisphericLight","diffuse","Color3","specular","groundColor","FreeCamera","Camera","ORTHOGRAPHIC_CAMERA","side","orthoTop","orthoBottom","orthoLeft","orthoRight","onResize","register","cwDataFields","addTable","connections","surveyDataFields","eventFields","setGlobal","indexOnTransitionSequence","indexOnPredictionSequence","fullSequenceIndex","states","running","tutorial","tryout","tryoutFMRI","end","checkpoint","tutorialDone","levelDone","taskDone","taskEndNoComeback","flags","levelDefined","events","sequenceGenerated","nextTrial","goNextPosition","endObservation","startPrediction","responseTimeEnded","isiAfterLearningEnded","feedbackEnded","isiAfterFeedbackEnded","pauseTransition","forcePause","predictionStartBlackout","blackoutEnds","predictionEndsBlackout","isiAfterPredictionEndsBlackout","screenWentBlack","playPredictionSound","playObservationSound","showModal","goToTutorial","hasResponded","restartTutorial","goToLevel1","goToLevel2","goToLevel3","goToLevel4","tic","moreThanFiveNA","aknowledgedEnding","tutorialNext","addState","states_tutorial","states_running","states_tryout","tutorialState","runningState","tryoutState","endState","pauseState","pause","eventData","flags_levelDefined","belongsTo","handledAt","storedAt","active","addAwakeningFunctions","addEndingFunctions","addEventFunctions","events_goToTutorial","goToPause","shouldPause","Object","currentModal","modalBox","hide","states_pause","events_nextTrial","events_goNextPosition","events_endObservation","events_startPrediction","events_pauseTransition","events_forcePause","events_windowBlur","events_moreThanFiveNA","events_click","events_keydown","events_playPredictionSound","events_playObservationSound","events_tutorialNext","events_showModal","events_responseTimeEnded","events_restartTutorial","events_windowFocus","selectLevel","checkTaskDone","checkpoint_taskDone","checkTaskEndNoComeback","checkpoint_taskEndNoComeback","checkTutorialOne","checkpoint_tutorialDone","taskEnded","results","result","code","eventLevel","wolfFaceSprite","checkpoint_levelDone","startLevel","emptyTimeTriggerEvents","agent","cross_base","levels","sequenceObject","fullSequence","endActive","awakenEnd","initialGui","event","events_aknowledgedEnding","reason","taskFinishedTitle","taskFinishedContent","taskStoppedTitle","taskStoppedMessage","taskStoppedReason","replace","setCheckpoint","awakenPause","levelObject","GUI","threshold","thresholdIdle","hitKeyTime","initialGuiVisible","backgroundFill","lastPauseInfo","time","currentTimeLeft","timerText","timeLeft","parseInt","timeLimitText","t","delayInMs","centerText","endReasonIdle","prediction","play","topText","pauseText","pauseKeyDown","ceil","pauseRestart","hasFocus","previousTimeLeft","frozenState","endPause","prematureEndPauseAboveThreshold","stateUnfrozen","currentTrialData","hasPaused","trials","index","maxTransitionTime","pameters","resolveOnKey","except","shouldtic","text2d","transitionText","finishedLevelTransition","tooltipPause","box","centerPosition","renderSize","scale","tooltip","duration","startRunning","newEvent","pausedBetween","numberOfMissed","isPredicting","nextTransitionTime","nextTransitionEvent","addTimeTriggerEvent","storeData","dataToStore","trial","choice","responseTime","startObservation","respondedAt","keysHits","clicks","correct","subject_id","observation_duration","subject_choice","response_time","key_hits","JSON","stringify","has_paused","start_observation","end_observation","responded_at","storeInErrorLog","timestamp","trialIndex","random","trialData","positions","currentIndex","stateKey","goToNextPosition","checkConnection","checkLastInteraction","pending","agent_predictionOpacity","cross_predict","sound","endResponse","predictionDuration","checkForClickPrediction","clientY","engineX","engineY","checkKeyStrokeForPrediction","keyCode","keyValue","key","keys","ArrowLeft","cross_bottomRight","ArrowRight","cross_topLeft","hasOwnProperty","keyPosition","playSound","sounds","name","awakeTryout","currentTutorial","loader","range","trialType","block","concat","blockType","tryoutGoToNextPosition","tutorials","hideTooltip","isWaitingToPredict","ntransition","askContinue","askfMRIContinue","lastChoice","endPrediction","nextPosition","observedTransitionWasDominant","dominant","block_type","dominant_structure","dominantStructure","dominant_transition_probability","dominantProbability","trial_type","observed_transition_was_dominant","transition_to","start_prediction","end_prediction","agentType","withKeys","tile","wolfFirstAppears","passed","wolfFirstAppears_title","wolfFirstAppears_message","rabbitFirstAppear","rabbitFirstAppear_title","rabbitFirstAppear_message","blackoutFirstAppear","blackoutFirstAppear_title","blackoutFirstAppear_message","wolfFmriFirstAppear","wolfFmriFirstAppear_title","wolfFmriFirstAppear_message","background","predictionTest","tilePosition","Number","numberOfPrediction","realTimeTest_message","observationDuration","minISIAfterLearning","maxISIAfterLearning","observationTime","fixedISIAfterObservation","sampleMeanISIAfterObservation","maxSampleAfterObservation","events_screenWentBlack","blackoutTime","fixedBlackScreenDuration","sampleMeanBlackScreen","maxSampleBlackScreen","tryoutStartPrediction","predictionTest_message","hitAKeyToContinue","changeCenterSquare","choiceDeferred","chooseNextPosition","crossLockByPosition","fixedISIAfterPrediction","sampleMeanISIAfterPrediction","maxSampleAfterPrediction","tryoutCheckKeyStrokeForPrediction","m","d","c","cross_bottomLeft","k","cross_topRight","chosenKey","sign","subtract","youSelectedThisTile","aLittleSquareShowsYourChoice","events_hasResponded","tooEarly","tryoutEndPrediction","tryoutEnd","pageOrderTutorialOne","awakeTutorial","pageOrder","showIntro","page","tutorialUnfrozen","show","showNextPage","currentPage","indexOf","showEvent","getAspectRatio","surfaceObject","Texture","getBaseSize","w","h","getDensity","elements","nsteps","windowSize","some","isNaN","min","max","stepSize","elementsInWindow","windowPosition","density","subset","filter","centered","windows","numberOfElements","chartOptions","datasets","label","scales","xAxes","randomColor","round","computeDurationEstimate","parametersBase","minNumberOfObservationsPerLearning","maxNumberOfObservationsPerLearning","interObservationDuration","minTimeToPredict","maxTimeToPredict","feedbackDuration","minISIAfterFeedback","maxISIAfterFeedback","rabbitAutoTransition","rabbitDominantProbability","observationSegmentSizes","observationSegmentRepetitionPerBlock","numberOfBlocks","numberOfRandomBlocks","feedbackType","numberOfObservationPerLevel","sum","oneObservationDuration","observationsDurationPerBlock","numberOfPredictionEventsPerBlock","timeDurationMatrix","matrix","factorMatrix","predictionDurationMatrix","multiply","sumPredictionDurationVector","predictionsDurationPerBlock","observationDurationMatrix","durationPerBlock","totalDuration","toArray","mean"],"mappings":"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","file":"walker.max.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"experiment-js\"), require(\"experiment-babylon-js\"), require(\"lodash\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jQuery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"walker\", [\"experiment-js\", \"experiment-babylon-js\", \"lodash\", \"experiment-boxes\", \"experiment-mathjs\", \"jQuery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"walker\"] = factory(require(\"experiment-js\"), require(\"experiment-babylon-js\"), require(\"lodash\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jQuery\"));\n\telse\n\t\troot[\"walker\"] = factory(root[\"experiment\"], root[\"BABYLON\"], root[\"_\"], root[\"experimentBoxes\"], root[\"math\"], root[\"jQuery\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_16__, __WEBPACK_EXTERNAL_MODULE_17__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2bae5a7bb47a3fd94eb5","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-js\",\"commonjs2\":\"experiment-js\",\"amd\":\"experiment-js\",\"root\":\"experiment\"}\n// module id = 0\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}\n// module id = 2\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}\n// module id = 3\n// module chunks = 0","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array,\n  String, // eslint-disable-line\n  Deferred,\n  debuglog,\n  debugWarn,\n  hasConstructor,\n  delay,\n} from 'experiment-js'\n\nconst placePoints = function (points = []) {\n  if (points.length === 0) return\n\n  const stateManager = this.stateManager\n\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  let redraw = false\n  if (points.length !== pointSpheres.length) {\n    redraw = true\n  }\n\n  const tempPointSpheres = []\n  for (let i = 0; i < points.length; i++) {\n    const point = points[i]\n\n    if (hasConstructor(Array, point)) {\n      let pointSphere\n      if (redraw || pointSpheres.length < i) {\n          // draw a sphere at point and store it in the array\n        pointSphere = BABYLON.Mesh.CreateSphere(`sphere${i}`, 32, 0.5, this.scene)\n      } else {\n        pointSphere = pointSpheres[i]\n      }\n\n      pointSphere.position = new BABYLON.Vector3(...point)\n\n      tempPointSpheres.push(pointSphere)\n    }\n  }\n  // set the data into the stateManager\n  stateManager.set('pointSpheres', tempPointSpheres)\n}\n\nconst updatePoints = function (points) {\n  if (points.length === 0) return\n\n  const stateManager = this.stateManager\n\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  if (pointSpheres.length !== points.length) {\n    stateManager.call('placePoints', points)\n  } else {\n    for (let i = 0; i < pointSpheres.length; i++) {\n      const point = points[i]\n      if (hasConstructor(Array, point)) {\n        pointSpheres[i].position = new BABYLON.Vector3(...point)\n      }\n    }\n  }\n}\n\nconst hidePointSpheres = function () {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  for (const pointSphere of pointSpheres) {\n    if (hasConstructor(BABYLON.Mesh, pointSphere)) {\n      pointSphere.visibility = false\n    }\n  }\n}\n\nconst showPointSpheres = function () {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  for (const pointSphere of pointSpheres) {\n    if (hasConstructor(BABYLON.Mesh, pointSphere)) {\n      pointSphere.visibility = true\n    }\n  }\n}\n\nconst setViewForDirection = function ({ direction = null }) {\n  const scene = this.scene\n  const camera = scene.activeCamera\n\n  if (direction === null) {\n    return 'GlobalFunctions.setViewForDirection: direction is null'\n  }\n\n  const xPos = (direction === 'LEFT') ? -50 : 50\n  camera.position = new BABYLON.Vector3(xPos, 0, 0)\n  camera.setTarget(new BABYLON.Vector3.Zero())\n  return 'View changed'\n}\n\nconst addButton = function (options = null) {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('stateManager.addButton: this.taskObject is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const canvas = stateManager.get('elements2D').canvas\n\n  const baseOptions = {\n    id: `button${stateManager.timeInMs}`,\n    text: 'text',\n    x: 50,\n    y: 50,\n    width: 100,\n    height: 50,\n    fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.8, 0.8, 0.8, 1)),\n    clickEventData: null,\n    fontName: '30pt Arial',\n    baseOpacity: 0.8,\n    hoverOpacity: 1,\n    zOrder: -0.5,\n    marginAlignment: null,\n    fontSignedDistanceField: true,\n    margin: {},\n    padding: {},\n    parent: canvas,\n  }\n\n  baseOptions.margin.leftPixels = 0\n  baseOptions.margin.rightPixels = 0\n  baseOptions.margin.topPixels = 0\n  baseOptions.margin.bottomPixels = 0\n  baseOptions.padding.leftPixels = 0\n  baseOptions.padding.rightPixels = 0\n  baseOptions.padding.topPixels = 0\n  baseOptions.padding.bottomPixels = 0\n  baseOptions.margin = _.extend(baseOptions.margin, options.margin)\n  baseOptions.padding = _.extend(baseOptions.padding, options.padding)\n  options.margin = baseOptions.margin\n  options.padding = baseOptions.padding\n\n  // extend options\n  options = _.extend(baseOptions, options)\n\n  let buttonOptions = {}\n  let margin = {}\n  let padding = {}\n  if (options.marginAlignment === null) {\n    buttonOptions = {\n      parent: options.parent,\n      id: options.id,\n      x: options.x,\n      y: options.y,\n      width: options.width,\n      height: options.height,\n      fill: options.fill,\n      zOrder: options.zOrder,\n      roundRadius: 0,\n      children: [new BABYLON.Text2D(options.text, {\n        fontName: options.fontName,\n        marginVAlignment: 'v: center',\n        fontSignedDistanceField: options.fontSignedDistanceField,\n        marginHAlignment: 3,\n      })],\n    }\n  } else {\n    buttonOptions = {\n      parent: options.parent,\n      id: options.id,\n      width: options.width,\n      height: options.height,\n      fill: options.fill,\n      zOrder: options.zOrder,\n      marginAlignment: options.marginAlignment,\n      roundRadius: 0,\n      children: [new BABYLON.Text2D(options.text, {\n        fontName: options.fontName,\n        marginVAlignment: 'v: center',\n        fontSignedDistanceField: options.fontSignedDistanceField,\n        marginHAlignment: 3,\n      })],\n    }\n    margin = options.margin\n    padding = options.padding\n  }\n\n  // create button and add to canvas\n  const buttonRect = new BABYLON.Rectangle2D(buttonOptions)\n\n  buttonRect.opacity = options.baseOpacity\n\n  if (margin !== null) {\n    buttonRect.margin.rightPixels = options.margin.rightPixels // TODO make that a specific function in the framework\n    buttonRect.margin.leftPixels = options.margin.leftPixels\n    buttonRect.margin.topPixels = options.margin.topPixels\n    buttonRect.margin.bottomPixels = options.margin.bottomPixels\n  }\n\n  if (padding !== null) {\n    buttonRect.padding.rightPixels = padding.rightPixels\n    buttonRect.padding.leftPixels = padding.leftPixels\n    buttonRect.padding.topPixels = padding.topPixels\n    buttonRect.padding.bottomPixels = padding.bottomPixels\n  }\n\n  // Add an observable for hovering\n  buttonRect.pointerEventObservable.add(() => {\n    buttonRect.opacity = options.hoverOpacity\n  }, BABYLON.PrimitivePointerInfo.PointerOver)\n\n  buttonRect.pointerEventObservable.add(() => {\n    buttonRect.opacity = options.baseOpacity\n  }, BABYLON.PrimitivePointerInfo.PointerOut)\n\n  // Add an observable for clicking\n  if ((options.clickEventData !== null) && (options.clickEventData.constructor === EventData)) {\n    buttonRect.pointerEventObservable.add(() => {\n      options.clickEventData.happenedAt = stateManager.timeInMs\n      options.clickEventData.data.button = buttonRect.id\n\n      stateManager.addEvent(options.clickEventData)\n    }, BABYLON.PrimitivePointerInfo.PointerUp)\n  }\n\n  return (buttonRect)\n}\n\nconst setMargins = function (prim, margin) {\n  prim.margin.rightPixels = margin.rightPixels // TODO make that a specific function in the framework\n  prim.margin.leftPixels = margin.leftPixels\n  prim.margin.topPixels = margin.topPixels\n  prim.margin.bottomPixels = margin.bottomPixels\n}\n\nconst showCross = function () {\n  const crossSheet = this.taskObject.cloneAssetIntoScene(this.R.get.crossSheet, this.scene)\n  crossSheet.hasAlpha = true\n\n  const guiCanvas = this.stateManager.get('GUI')\n\n\n  let cross = this.stateManager.get('cross', null)\n  if (hasConstructor(BABYLON.Sprite2D, cross)) {\n    cross.dispose()\n  }\n\n  cross = new BABYLON.Sprite2D(crossSheet, {\n    parent: guiCanvas,\n    id: 'cross',\n    marginAlignment: 'v: center, h: center',\n    spriteSize: new BABYLON.Size(20, 20),\n    spriteLocation: new BABYLON.Vector2(0, 0),\n  })\n\n  cross.spriteFrame = 0\n  cross.levelVisible = true\n\n  this.stateManager.set('cross', cross)\n}\n\nconst hideCross = function () {\n  const cross = this.stateManager.get('cross', null)\n\n  if (cross !== null) {\n    cross.levelVisible = false\n  }\n}\n\nconst highlightPosition = function (options = null) {\n  if (typeof this.stateManager === 'undefined') {\n    throw new Error('stateManager.highlightPosition: this.stateManager is undefined')\n  }\n\n  if (typeof options.position === 'undefined') {\n    throw new Error('stateManager.highlightPosition: options.position is undefined')\n  }\n\n  return (this.stateManager.promise('drawTiles', {\n    hightlight: options.position,\n    type: (typeof options.type !== 'undefined') ?\n      options.type : 'prediction',\n  }))\n}\n\nconst explode = function ({ meshes = null }) {\n  if (meshes === null) {\n    return 'No mesh given'\n  }\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  const explosionTexture = this.taskObject.cloneAssetIntoScene(this.R.get.explosionTexture, this.scene)\n  explosionTexture.hasAlpha = true\n\n  for (const mesh of meshes) {\n    const particleSystem = new BABYLON.ParticleSystem('particles', 1000, this.scene)\n    particleSystem.particleTexture = explosionTexture\n    particleSystem.emitter = mesh\n    particleSystem.minEmitBox = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.maxEmitBox = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 0.8)\n    particleSystem.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 0.7)\n    particleSystem.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0)\n    particleSystem.minSize = parameters.minSize\n    particleSystem.maxSize = parameters.maxSize\n    particleSystem.minLifeTime = parameters.minLifeTime\n    particleSystem.maxLifeTime = parameters.maxLifeTime\n    particleSystem.emitRate = parameters.emitRate\n    particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE\n    particleSystem.gravity = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.direction1 = new BABYLON.Vector3(-5, 5, 5)\n    particleSystem.direction2 = new BABYLON.Vector3(5, -5, -5)\n    particleSystem.minAngularSpeed = 0\n    particleSystem.maxAngularSpeed = Math.PI\n    particleSystem.minEmitPower = parameters.minEmitPower\n    particleSystem.maxEmitPower = parameters.maxEmitPower\n    particleSystem.updateSpeed = 0.025\n\n    particleSystem.targetStopDuration = 0.5\n    particleSystem.disposeOnStop = true\n\n    particleSystem.start()\n  }\n\n  return 'Exploded'\n}\n\nconst setBlackScreen = function (options = null) {\n  const baseOptions = { // TODO create a defaultOptions()\n    on: true,\n  }\n\n  options = _.extend(baseOptions, options)\n  const elements2D = this.stateManager.getGlobal('elements2D')\n  const canvas = elements2D.canvas\n\n  if (!_.has(elements2D, 'blackScreen')) {\n    const blackScreen = new BABYLON.Rectangle2D({\n      parent: canvas,\n      id: 'blackScreen',\n      position: new BABYLON.Vector2(0, 0),\n      width: canvas.size.width,\n      height: canvas.size.height,\n      zOrder: 0,\n    })\n\n    elements2D.blackScreen = blackScreen\n  }\n\n  if (options.on) {\n    elements2D.blackScreen.opacity = 1\n  } else {\n    elements2D.blackScreen.opacity = 0\n  }\n}\n\nconst checkIdleAndConnection = function ({ deferred = new Deferred(), returnToState = null } = { deferred: new Deferred(), returnToState: null }) {\n  const stateManager = this.stateManager\n  const R = this.R\n  const dataManager = this.dataManager\n  const connection = this.connection\n\n  const shouldCheckTime = stateManager.get('shouldCheckTime', false)\n\n  if (shouldCheckTime) {\n    return dataManager.query('getLastInteraction', null, connection, deferred).then((r) => {\n      const delay = stateManager.timeInMs - r.lastInteraction\n      const delayMin = delay / (60000)\n      if (delay > 20 * 60 * 1000) {\n        debugWarn('running.goToNextPosition: idle for too long')\n        stateManager.set('endReason', `You were idle for more than 20 min: ${delayMin} min`)\n        stateManager.goToState(R.get.states_end)\n      } else if ((returnToState !== null) && (stateManager.currentStateKey !== returnToState)) { stateManager.goToState(returnToState) }\n    })\n    .catch(() => {\n      debugWarn('running.goToNextPosition: lost connection')\n      returnToState = returnToState || stateManager.currentStateKey\n\n      if (stateManager.currentStateKey !== R.get.states_idle) {\n        stateManager.call('hideAll')\n        stateManager.onNext(this.R.get.events_unfrozen, () => { stateManager.call('showAll') })\n        this.state.freeze()\n        stateManager.goToState(R.get.states_idle)\n      }\n\n      this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n      .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState }) })\n    })\n  }\n  return Promise.resolve()\n}\n\nexport {\n  addButton,\n  highlightPosition,\n  setMargins,\n  setBlackScreen,\n  checkIdleAndConnection,\n  placePoints,\n  updatePoints,\n  showPointSpheres,\n  hidePointSpheres,\n  setViewForDirection,\n  showCross,\n  hideCross,\n  explode }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/functions/globalFunctions.js","/**\n * startUp.js\n *\n * This file holds the code that should run on your HTML page after all the framework and page is loaded.\n *\n * Here you should :\n * - create the taskObject\n * - set up the parameters of the task\n * - register loading promise\n * - register the scenes generators\n * - start the task\n * - bind the task paramBox with relevant parameters\n *\n * Do not pollute the global space with too much variables.\n * Here two global variables are created : taskObject and calibrator.\n */\nimport $ from 'jquery'\nimport _ from 'lodash'\nimport { RessourceManager, TaskObject, Deferred, debuglog, debugError } from 'experiment-js'\nimport { SmartForm } from 'experiment-boxes'\n\nimport { DEBUG_MODE_ON } from '../../config'\n\n// import LoadingScene from './scenes/LoadingScene' Using default loading\nimport MainScene from '../scenes/main/MainScene'\n\nwindow.taskObject = null\nwindow.calibrator = null\n\n\n// When page is loaded, initiate the task\nconst defferedDomLoaded = new Deferred()\ndocument.addEventListener('DOMContentLoaded', () => {\n  defferedDomLoaded.resolve()\n})\n\nif (typeof window !== 'undefined') {\n  /* === Get the absolute path of the library === */\n  const scripts = document.getElementsByTagName('script')\n  if (scripts.length) {\n    const assetsFolderFullpath = scripts[scripts.length - 1].src\n    const delimiterIndices = assetsFolderFullpath.indicesOf('/')\n    window.assetsFolderFullpath = assetsFolderFullpath.substr(0, delimiterIndices[delimiterIndices.length - 2])\n  } else {\n    window.assetsFolderFullpath = './'\n  }\n}\n\nconst R = new RessourceManager()\nwindow.p1 = defferedDomLoaded.promise\nwindow.p2 = R.addFiles(`${window.assetsFolderFullpath}/assets/yaml/ressources.yaml`, `${window.assetsFolderFullpath}/assets/json/trials_perturbed.json`)\n\nwindow.loadingPromise = Promise.all([window.p1, window.p2])\n\n\nwindow.loadingPromise.then(() => {\n  window.DEBUG_MODE_ON = DEBUG_MODE_ON\n\n  const taskObject = new TaskObject($('.task-canvas'))\n  taskObject.R.mergeWith(R)\n\n  /* --- Register scene generators --- */\n  const options = {\n    level: null,\n  }\n\n  taskObject.registerSceneGenerator(MainScene, options)\n\n  const sceneNames = ['loading', 'main']\n\n  taskObject.R.add({\n    parameters: {\n      rate: 60, // frame rate in hertz\n      numberOfPoints: 5,\n      maxObservationTime: 3000,\n      fixationTime: 500,\n      ITI: 500,\n      trialsBeforePause: 3,\n      pauseTime: 15 * 60 * 1000,\n      explosionTime: 500,\n      minSize: 0.2,\n      maxSize: 0.8,\n      minLifeTime: 0.150,\n      maxLifeTime: 0.150,\n      emitRate: 30,\n      minEmitPower: 1,\n      maxEmitPower: 2,\n    },\n  })\n\n  /* --- Register loading scene generator --- */\n// taskObject.registerLoadingFunction(LoadingScene)\n  taskObject.assetsToLoad = {\n    crossSheet: {\n      path: '/assets/sprites/cross/squareSheetMargin.svg',\n      type: 'texture',\n    },\n    explosionTexture: {\n      path: '/assets/sprites/explosion/particle_explosion.png',\n      type: 'texture',\n    },\n  }\n\n  /* list of tweakable variables from the paramBox */\n\n  const parametersNames = ['parameters.explosionTime',\n    'parameters.minSize',\n    'parameters.maxSize',\n    'parameters.minLifeTime',\n    'parameters.maxLifeTime',\n    'parameters.emitRate',\n    'parameters.minEmitPower',\n    'parameters.maxEmitPower']\n\n  // const parametersConstraints = {}\n\n  // const rParams = ['agent.scale', 'agent.predictionOpacity', 'tile.scale', 'tile.offset', 'cross.opacity']\n\n\n  // taskObject.paramBox.bind(taskObject, parametersNames, parametersConstraints)\n  taskObject.paramBox.bind(taskObject.R.data, parametersNames)\n\n\n  /* --- Login --- */\n  window.taskObject = taskObject\n  const tempMaxNumberOfRetry = taskObject.dataManager.MAX_NUMBER_OF_RETRY\n  const endpoint = `${window.assetsFolderFullpath}/api/php/mysql/index.php`\n\n  /**\n   * This function in a form generator that is called automatically by the DataManager when the user needs to login\n   * @method loginForm\n   * @return {SmartForm}  a SmartForm\n   */\n  function loginForm() {\n    const fields = {\n      userId: {\n        type: 'input',\n        constraints: 'length:3,300', // list of constraints that will be automatically verified: mandatory; alpha; numeric; length:XX; contains:a,b,@,.;\n        authorizedValues: null, // athorized values\n        parent: null,\n        title: 'User Id:',\n      },\n      password: {\n        type: 'password', // field type: input, select, textaera, slider, radio, password\n        constraints: 'length:3,300; score: 20', // list of constraints that will be automatically verified: mandatory; alpha; numeric; length:XX; contains:a,b,@,.;\n        authorizedValues: null, // athorized values\n        parent: null,\n        title: 'Enter your password, if you are new here you are free to pick one !', // you can control auto-create account in the php api config\n      },\n    }\n    const options = { fields, title: 'Login Form', format: 'topCentralSmall', callback(fields) { debuglog({ endpoint, credentials: { userId: fields.userId.value, password: fields.password.value } }) } }\n    const form = new SmartForm(options)\n    form.buttonText = 'OK'\n\n    const R = taskObject.context.R\n    const stateManager = taskObject.context.stateManager\n\n    if (stateManager) {\n      stateManager.goToState(R.get.states_active)\n    }\n\n    return form\n  }\n\n  taskObject.dataManager.authorize_manual_login = true\n\n  //  If you do not want to store the credentials for the connections localy set this variable to false (the password is not stored in any case, only a logging key)\n  // taskObject.dataManager.useLocalStorageCredentials = false\n  taskObject.setConnection({ endpoint, signInForm: loginForm }) // credentials: { userId: 'John', password: 'wrong' } })\n  .then((connection) => {\n    if (connection.loggedIn) {\n      return true\n    }\n    return taskObject.dataManager.login(connection)\n  })\n  .then(() => {\n    // reset the retry limit to its original value\n    taskObject.dataManager.MAX_NUMBER_OF_RETRY = tempMaxNumberOfRetry\n\n    /* --- Start task --- */\n    return taskObject.startTask()\n  })\n  .then((message) => {\n    debuglog(message)\n    // taskObject.paramBox.bind(taskObject, 'currentScene', parametersConstraints)\n    if ((sceneNames.length === 1) || (typeof taskObject.paramBox.queryString.currentScene === 'undefined')) {\n      taskObject.currentScene = 'main'\n    }\n  })\n  .catch((e) => {\n    debugError(e)\n    taskObject.modal({ type: 'centralLarge', title: R.get.loginError.title.en, content: R.get.loginError.content.en })\n    .then(() => {\n      window.open('', '_self').close()\n    })\n  })\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/startup/startup.js","/**\n * Experiment.js\n * Created. 2016\n *\n * Experiment.js toolbox.\n *\n * Authors. Albert Buchard\n *\n * Requires: lodash, BABYLON.js, mathjs, jQuery\n *\n * LICENSE Apache-2\n */\n\n if (typeof window !== 'undefined') {\n   require('./src/task/startup/startup')\n }\n\n\n\n// WEBPACK FOOTER //\n// ./builder.js","const DEBUG_MODE_ON = true\n\nexport { DEBUG_MODE_ON }\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  debugError,\n  hasConstructor,\n} from 'experiment-js'\n\nimport { SmartModal } from 'experiment-boxes'\n\nimport {\n  addButton,\n  highlightPosition,\n  setBlackScreen,\n  checkIdleAndConnection,\n  placePoints,\n  updatePoints,\n  showPointSpheres,\n  hidePointSpheres,\n  setViewForDirection,\n  showCross,\n  hideCross,\n  explode } from './functions/globalFunctions'\n\n\nimport { selectLevel, startLevel, endActive } from './states/active'\n\nimport { showNextPage, showModal, awakeTutorial, tutorialUnfrozen } from './states/tutorial'\n\nimport {\n  awakeTryout,\n  tryoutEndPrediction,\n  tryoutCheckKeyStrokeForPrediction,\n  tryoutGoToNextPosition,\n  tryoutStartPrediction,\n  tryoutEnd,\n} from './states/tryout'\n\nimport {\n  stateUnfrozen,\n  startRunning,\n  nextTrial,\n  goToNextPosition,\n  startPrediction,\n  checkForClickPrediction,\n  checkKeyStrokeForPrediction,\n  playSound,\n  endObservation,\n  pauseTransition,\n} from './states/running'\n\nimport { awakenPause, endPause, pauseKeyDown } from './states/pause'\n\nimport { awakenEnd } from './states/end'\n\n/* =============== Main scene =============== */\nexport default function MainScene(options = {}) {\n  // option base\n  const optionsBase = {\n    sceneKey: 'main',\n    canvasBackground: new BABYLON.Color4(0, 0, 0, 1),\n    backgroundRoundRadius: 0,\n    clearColor: new BABYLON.Color4(0, 0, 0, 1),\n    canvasPercentWidth: 1,\n    canvasPercentHeight: 1,\n    mode: 'central',\n    level: null,\n  }\n\n  options = _.extend(optionsBase, options)\n\n  /* --- Get taskObject from context --- */\n  const taskObject = this.taskObject\n\n  /* --- Create a basic 3D scene--- */\n  const scene = taskObject.create3DScene(options)\n\n  /* --- Add a light --- */\n  const light0 = new BABYLON.HemisphericLight('Hemi0', new BABYLON.Vector3(0, 1, 0), scene)\n  light0.diffuse = new BABYLON.Color3(1, 1, 1)\n  light0.specular = new BABYLON.Color3(1, 1, 1)\n  light0.groundColor = new BABYLON.Color3(1, 1, 1)\n\n  /* --- Get stateManager --- */\n  const stateManager = scene.stateManager\n\n  /* --- Get canvas --- */\n  // const canvas = scene.initialCanvas\n\n  // const camera = scene.initialCamera\n  // // // camera.detachControl(taskObject.canvas)\n  // camera.radius = 50\n  // camera.alpha = 0\n  // camera.beta = Math.PI / 2\n\n  const camera = new BABYLON.FreeCamera('OrthoCamera', new BABYLON.Vector3(-50, 0, 0), scene)\n  camera.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA\n\n  const side = 20\n  camera.orthoTop = side\n  camera.orthoBottom = -side\n  camera.orthoLeft = -side\n  camera.orthoRight = side\n  //\n  //   // This targets the camera to scene origin\n  camera.setTarget(new BABYLON.Vector3.Zero())\n  //\n  scene.activeCamera = camera\n  // camera.setPosition(new BABYLON.Vector3(50, 0, 0))\n\n  const R = taskObject.R\n\n\n  /* --- Load assets --- */\n\n  scene.onResize = []\n\n  stateManager.register(\n    addButton,\n    highlightPosition,\n    setBlackScreen,\n    checkIdleAndConnection,\n    updatePoints,\n    placePoints,\n    hidePointSpheres,\n    showPointSpheres,\n    setViewForDirection,\n    showCross,\n    hideCross,\n    explode)\n\n  stateManager.call('redrawAssets')\n\n  /* --- Setup data --- */\n  const dataManager = this.dataManager\n\n  /* --- Add cwData table that will hold a summary of the data --- */\n  const cwDataFields = [\n    'subject_id',\n    'level',\n    'block',\n    'block_type',\n    'dominant_structure',\n    'dominant_transition_probability',\n    'trial',\n    'trial_type',\n    'position',\n    'observation_duration',\n    'subject_choice', // NA for NOGO\n    'correct',\n    'response_time', // NA for NOGO or no response\n    'key_hits', // ['key', 'time'], [k,t], ...\n    'clicks',\n    'has_paused',\n    'start_observation',\n    'responded_at',\n  ]\n\n  dataManager.addTable('walkerData', cwDataFields)\n  dataManager.addTable('tryoutData', cwDataFields)\n\n  let userId = `unknown${this.timeInMs}`\n  try {\n    userId = dataManager.connections[0].credentials.userId\n  } catch (e) {\n    debugError(e)\n  }\n\n  stateManager.set('subject_id', userId)\n\n  /* --- Add the surveyData table --- */\n  const surveyDataFields = [\n    'level',\n    'similarTask',\n    'taskDifficulty',\n    'movementWolf',\n    'boredom',\n    'dependance',\n    'repeatsSequence',\n    'comments',\n  ]\n\n  dataManager.addTable('surveyData', surveyDataFields)\n\n  /* --- Add the logs for each level --- */\n  const eventFields = ['id', 'flag', 'happenedAt', 'handledAt', 'data']\n  dataManager.addTable('stateRunningEvents', eventFields)\n  dataManager.addTable('stateActiveEvents', eventFields)\n\n  /* --- Store scene level inside the stateManager --- */\n  stateManager.setGlobal('positionData', {\n    indexOnTransitionSequence: -1,\n    indexOnPredictionSequence: -1,\n    fullSequenceIndex: -1,\n  })\n\n  stateManager.setGlobal('hasSeenLearningInfo', false)\n  stateManager.setGlobal('hasSeenPredictionInfo', false)\n  /* --- Setup states --- */\n\n  /* --- Set state key and store them in the stateManager --- */\n  R.add({\n    states: {\n      running: 'running',\n      tutorial: 'tutorial',\n      tryout: 'tryout',\n      tryoutFMRI: 'tryoutFMRI',\n      end: 'end',\n    },\n    checkpoint: {\n      tutorialDone: ['tutorialOneDone', 'tutorialTwoDone'],\n      levelDone: ['levelOneDone', 'levelTwoDone', 'levelThreeDone', 'levelFourDone'],\n      taskDone: 'taskDone',\n      taskEndNoComeback: 'taskEndNoComeback',\n    },\n    flags: {\n      levelDefined: 'levelDefined',\n    },\n    events: {\n      sequenceGenerated: 'sequenceGenerated',\n      nextTrial: 'nextTrial',\n      goNextPosition: 'goNextPosition',\n      endObservation: 'endObservation',\n      startPrediction: 'startPrediction',\n      responseTimeEnded: 'responseTimeEnded',\n      isiAfterLearningEnded: 'isiAfterLearningEnded',\n      feedbackEnded: 'feedbackEnded',\n      isiAfterFeedbackEnded: 'isiAfterFeedbackEnded',\n      pauseTransition: 'pauseTransition',\n      forcePause: 'forcePause',\n      predictionStartBlackout: 'predictionStartBlackout',\n      blackoutEnds: 'blackoutEnds',\n      predictionEndsBlackout: 'predictionEndsBlackout',\n      isiAfterPredictionEndsBlackout: 'isiAfterPredictionEndsBlackout',\n      screenWentBlack: 'screenWentBlack',\n      playPredictionSound: 'playPredictionSound',\n      playObservationSound: 'playObservationSound',\n      showModal: 'showModal',\n      goToTutorial: 'goToTutorial',\n      hasResponded: 'hasResponded',\n      restartTutorial: 'restartTutorial',\n      goToLevel1: 'goToLevel1',\n      goToLevel2: 'goToLevel2',\n      goToLevel3: 'goToLevel3',\n      goToLevel4: 'goToLevel4',\n      tic: 'tic',\n      moreThanFiveNA: 'moreThanFiveNA',\n      aknowledgedEnding: 'aknowledgedEnding',\n      tutorialNext: 'tutorialNext',\n    },\n  })\n\n  // eslint-disable-next-line\n  const [tutorialState, runningState, tryoutState, endState] = stateManager.addState(R.get.states_tutorial, R.get.states_running, R.get.states_tryout, R.get.states_end)\n  const pauseState = stateManager.states.pause\n\n  /* ======== State Active ======== */\n  if (options.level !== null) {\n    const eventData = new EventData(R.get.flags_levelDefined, scene.stateManager.timeInMs, {\n      belongsTo: [\n        'globalLog', 'stateActiveEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n      level: options.level,\n    })\n    stateManager.addEvent(eventData)\n  } else {\n    stateManager.states.active.addAwakeningFunctions(selectLevel)\n  }\n\n  stateManager.states.active.addEndingFunctions(endActive)\n\n  stateManager.states.active.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  stateManager.states.active.addEventFunctions(R.get.events_goToTutorial,\n    ({ data: { tutorial } }) => {\n      stateManager.setGlobal('currentTutorial', tutorial)\n      stateManager.goToState(R.get.states_tutorial)\n    })\n\n  /* ======== State RUNNING ======== */\n  const goToPause = function () {\n    if (this.state.shouldPause) {\n      this.state.freeze()\n      if (hasConstructor(Object, this.taskObject.currentModal) && hasConstructor(SmartModal, this.taskObject.currentModal.modalBox)) {\n        this.taskObject.currentModal.modalBox.hide()\n      }\n      this.stateManager.goToState(this.R.get.states_pause)\n    }\n  }\n\n  /* --- Register functions --- */\n  runningState.addAwakeningFunctions(startRunning)\n\n  runningState.addEventFunctions(R.get.events_nextTrial, nextTrial)\n  runningState.addEventFunctions(R.get.events_goNextPosition, goToNextPosition)\n  runningState.addEventFunctions(R.get.events_endObservation, endObservation)\n\n  runningState.addEventFunctions(R.get.events_startPrediction, startPrediction)\n\n  runningState.addEventFunctions(R.get.events_pauseTransition, pauseTransition)\n\n  runningState.addEventFunctions(R.get.events_unfrozen, stateUnfrozen)\n  runningState.addEventFunctions(R.get.events_forcePause, goToPause)\n  runningState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  runningState.addEventFunctions(R.get.events_moreThanFiveNA, goToPause)\n\n  runningState.addEventFunctions(R.get.events_click, checkForClickPrediction)\n  runningState.addEventFunctions(R.get.events_keydown, checkKeyStrokeForPrediction)\n\n  runningState.addEventFunctions(R.get.events_playPredictionSound, playSound)\n  runningState.addEventFunctions(R.get.events_playObservationSound, playSound)\n\n  /* ======= State Running ======= */\n\n  // Center cross\n  // Observe movement\n  // Respond at any time\n  // ITI\n  // Center cross\n\n\n  /* ======= State Tutorial ======= */\n  tutorialState.addAwakeningFunctions(awakeTutorial)\n\n  tutorialState.addEventFunctions(R.get.events_tutorialNext, showNextPage)\n  tutorialState.addEventFunctions(R.get.events_showModal, showModal)\n\n  tutorialState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  tutorialState.addEventFunctions(R.get.events_unfrozen, tutorialUnfrozen)\n\n  tutorialState.addEventFunctions(R.get.events_playPredictionSound, playSound)\n  tutorialState.addEventFunctions(R.get.events_playObservationSound, playSound)\n\n\n  /* ======= State Tryout ======= */\n  dataManager.addTable('stateTryout1', eventFields)\n  dataManager.addTable('stateTryout2', eventFields)\n\n  tryoutState.addAwakeningFunctions(awakeTryout)\n  tryoutState.addEndingFunctions(tryoutEnd)\n\n  tryoutState.addEventFunctions(R.get.events_goNextPosition, tryoutGoToNextPosition)\n  tryoutState.addEventFunctions(R.get.events_endObservation, endObservation)\n\n  tryoutState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  tryoutState.addEventFunctions(R.get.events_unfrozen, tutorialUnfrozen)\n\n  tryoutState.addEventFunctions(R.get.events_startPrediction, tryoutStartPrediction)\n  tryoutState.addEventFunctions(R.get.events_responseTimeEnded, tryoutEndPrediction)\n  tryoutState.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  tryoutState.addEventFunctions(R.get.events_restartTutorial, () => {\n    stateManager.goToState(R.get.states_tutorial)\n  })\n\n  tryoutState.addEventFunctions(R.get.events_keydown, tryoutCheckKeyStrokeForPrediction)\n  tryoutState.addEventFunctions(R.get.events_click, checkForClickPrediction)\n\n  /* ======== State Pause ======== */\n  // stateManager.setPauseKeyStroke()\n  pauseState.addAwakeningFunctions(awakenPause)\n  pauseState.addEndingFunctions(endPause)\n  pauseState.addEventFunctions(R.get.events_keydown, pauseKeyDown)\n  pauseState.addEventFunctions(R.get.events_windowFocus, pauseKeyDown)\n  // pauseState.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  // pauseState.addEndingFunctions(function () { this.stateManager.promise('disposeOfButtons') })\n\n  /* ======= prematureEnd State ======= */\n  endState.addAwakeningFunctions(awakenEnd)\n\n  return scene\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/MainScene.js","import {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n} from 'experiment-js'\n\n\nconst selectLevel = function () {\n  if (typeof this.state === 'undefined') {\n    throw new Error('state.selectLevel: state is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const dataManager = this.dataManager\n  const elements2D = stateManager.get('elements2D')\n  // const GUI = stateManager.get('GUI')\n  const R = this.R\n\n  const checkTaskDone = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskDone }, this.connection)\n  const checkTaskEndNoComeback = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskEndNoComeback }, this.connection)\n  const checkTutorialOne = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_tutorialDone[0] }, this.connection)\n\n  stateManager.call('hideAll')\n  stateManager.set('shouldCheckTime', false)\n\n  let taskEnded = false\n  const deferred = new Deferred()\n\n  Promise.all([checkTaskDone, checkTaskEndNoComeback, checkTutorialOne])\n  .then((results) => {\n    for (const result of results) {\n      if (typeof result.code === 'undefined') {\n        if (stateManager.currentStateKey !== R.get.states_idle) {\n          stateManager.goToState(R.get.states_idle)\n        }\n\n        this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n        .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n      } else if ((result.code === R.get.checkpoint_taskDone) || (result.code === R.get.checkpoint_taskEndNoComeback)) {\n        taskEnded = true\n        stateManager.set('endReason', result.message)\n        stateManager.goToState(R.get.states_end)\n\n        deferred.resolve('active.selectLevel: end of task')\n        return false\n      } else if ((result.code === R.get.checkpoint_tutorialDone[0]) && (!taskEnded)) {\n        stateManager.set('shouldCheckTime', true)\n      }\n    }\n    return this.dataManager.query('getCheckpoint', null, this.connection)\n  })\n  .then((result) => {\n    if (result !== false) {\n      if (typeof result.code === 'undefined') {\n        if (stateManager.currentStateKey !== R.get.states_active) {\n          stateManager.goToState(R.get.states_idle)\n        }\n\n        this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n        .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n      }\n\n      let eventLevel\n      switch (result.code) {\n        case R.get.checkpoint_tutorialDone[0]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 1 })\n          elements2D.wolfFaceSprite.spriteFrame = 0\n          break\n        case R.get.checkpoint_tutorialDone[1]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 4 })\n          elements2D.wolfFaceSprite.spriteFrame = 3\n          break\n        case R.get.checkpoint_levelDone[0]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 2 })\n          elements2D.wolfFaceSprite.spriteFrame = 1\n          break\n        case R.get.checkpoint_levelDone[1]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 3 })\n          elements2D.wolfFaceSprite.spriteFrame = 2\n          break\n        case R.get.checkpoint_levelDone[2]:\n          eventLevel = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, { tutorial: 2 })\n          elements2D.wolfFaceSprite.spriteFrame = 3\n          break\n        case R.get.checkpoint_levelDone[3]:\n          stateManager.set('endReason', 'You finished the task finished')\n          stateManager.goToState(R.get.states_end)\n          break\n        case R.get.checkpoint_taskDone:\n          stateManager.set('endReason', result.message)\n          stateManager.goToState(R.get.states_end)\n          break\n        case R.get.checkpoint_taskEndNoComeback:\n          stateManager.set('endReason', result.message)\n          stateManager.goToState(R.get.states_end)\n          break\n        default:\n          // Start tutorial\n          // eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 3 }) // TODO TAKE THAT BACk\n          eventLevel = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, { tutorial: 1 })\n\n      }\n\n      delay(150).then(() => { stateManager.addEvent(eventLevel) })\n      deferred.resolve('active.selectLevel: level selected - resolved')\n    }\n  })\n  .catch(() => {\n    if (stateManager.currentStateKey !== R.get.states_active) {\n      stateManager.goToState(R.get.states_idle)\n    }\n\n    this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n    .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n  })\n\n  // GUI.levelVisible = true\n  // /* --- Delete buttons --- */\n  // stateManager.promise('disposeOfButtons')\n  //\n  // const eventButtonOne = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 1,\n  // })\n  // const eventButtonTwo = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 2,\n  // })\n  // const eventButtonThree = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 3,\n  // })\n  // const eventButtonFour = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 4,\n  // })\n  //\n  // const eventButtonTutorialOne = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, {\n  //   tutorial: 1,\n  // })\n  // const eventButtonTutorialFour = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, {\n  //   tutorial: 2,\n  // })\n  //\n  // const width = 220\n  // const height = 40\n  // const widthOffset = width / 2\n  //\n  // const buttonOptionLevelOne = {\n  //   id: 'levelOne',\n  //   parent: GUI,\n  //   text: 'Level 1',\n  //   marginAlignment: 'h: center, v: bottom',\n  //   margin: {\n  //     rightPixels: (width) + widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   width,\n  //   height,\n  //   fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.8, 0.8, 0.8, 1)),\n  //   clickEventData: eventButtonOne,\n  //   callbackFunction: null,\n  //   fontName: '20pt Arial',\n  //   baseOpacity: 0.8,\n  //   hoverOpacity: 1,\n  // }\n  //\n  // const buttonOptionTutorialOne = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonTutorialLevelFour',\n  //   text: 'Tutorial 1',\n  //   margin: {\n  //     rightPixels: (width) + widthOffset,\n  //     bottomPixels: height,\n  //   },\n  //   clickEventData: eventButtonTutorialOne,\n  // })\n  //\n  //\n  // const buttonOptionLevelTwo = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelTwo',\n  //   text: 'Level 2',\n  //   margin: {\n  //     rightPixels: widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonTwo,\n  // })\n  //\n  // const buttonOptionLevelThree = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelThree',\n  //   text: 'Level 3',\n  //   margin: {\n  //     leftPixels: widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonThree,\n  // })\n  //\n  // const buttonOptionLevelFour = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelFour',\n  //   text: 'Level 4',\n  //   margin: {\n  //     leftPixels: (width) + widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonFour,\n  // })\n  //\n  // const buttonOptionTutorialFour = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonTutorialLevelFour',\n  //   text: 'Tutorial 4',\n  //   margin: {\n  //     leftPixels: (width) + widthOffset,\n  //     bottomPixels: height,\n  //   },\n  //   clickEventData: eventButtonTutorialFour,\n  // })\n  //\n  // Promise.all([stateManager.promise('addButton', buttonOptionLevelOne),\n  //   stateManager.promise('addButton', buttonOptionLevelTwo),\n  //   stateManager.promise('addButton', buttonOptionLevelThree),\n  //   stateManager.promise('addButton', buttonOptionLevelFour),\n  //   stateManager.promise('addButton', buttonOptionTutorialOne),\n  //   stateManager.promise('addButton', buttonOptionTutorialFour),\n  // ])\n  //   .then((buttons) => {\n  //     elements2D.levelButtons = buttons\n  //     for (const button of buttons) {\n  //       button.levelVisible = true\n  //     }\n  //     deferred.resolve('stateManager.selectLevel: resolved')\n  //   })\n\n  return deferred.promise\n}\n\nconst startLevel = function (options = null) {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('state.startLevel: this.taskObject is undefined')\n  }\n\n  if (typeof options.data.level === 'undefined') {\n    throw new Error('state.startLevel: options.level is undefined')\n  }\n\n  /* --- Get context --- */\n  const taskObject = this.taskObject\n  const stateManager = this.stateManager\n  const R = this.R\n  const elements2D = stateManager.get('elements2D')\n  stateManager.emptyTimeTriggerEvents()\n  elements2D.agent.opacity = 0\n  elements2D.cross.spriteFrame = R.get.cross_base\n\n  /* --- Delete buttons --- */\n  stateManager.promise('disposeOfButtons')\n\n  stateManager.setGlobal('level', options.data.level)\n  stateManager.setGlobal('levelObject', taskObject.parameters.levels[options.data.level - 1])\n\n  stateManager.set('positionData', {\n    indexOnTransitionSequence: -1,\n    indexOnPredictionSequence: -1,\n    fullSequenceIndex: taskObject.parameters.levels[options.data.level - 1].sequenceObject.fullSequence.length - 3, // TODO PUT IT BACK -1,\n  })\n\n  if (stateManager.currentStateKey !== R.get.states_running) { stateManager.goToState(R.get.states_running) }\n\n  return ('state.startLevel: resolved')\n}\n\nconst endActive = function () {\n  // this.stateManager.promise('disposeOfButtons')\n}\nexport { startLevel, selectLevel, endActive }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/active.js","import { EventData } from 'experiment-js'\n\nconst awakenEnd = function () {\n  const R = this.R\n  const scene = this.scene\n  this.stateManager.call('hideAll')\n  scene.initialGui.levelVisible = false\n  this.dataManager.authorize_manual_login = false\n  this.dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskDone }, this.connection)\n  .then((r) => {\n    const event = new EventData(this.R.get.events_aknowledgedEnding)\n    this.stateManager.onNext(this.R.get.events_aknowledgedEnding, () => {\n      window.open('', '_self').close()\n    })\n    let reason = 'You completed the task !'\n    let title = R.get.taskFinishedTitle\n    let content = R.get.taskFinishedContent\n\n    if (r.code !== R.get.checkpoint_taskDone) {\n      reason = this.stateManager.get('endReason', '')\n      title = R.get.taskStoppedTitle\n      content = R.get.taskStoppedMessage\n      if (reason !== '') {\n        content += R.get.taskStoppedReason.replace('{t}', reason)\n      }\n      this.taskObject.setCheckpoint(R.get.checkpoint_taskEndNoComeback, reason)\n\n      this.taskObject.modal({ type: 'centralLarge', title, content, event })\n    } else {\n      // this.dataManager.query('getFinalCode', null, this.connection)\n      // .then((r) => {\n      //   content = content.replace('{c}', r.code)\n      this.taskObject.modal({ type: 'centralLarge', title, content, event })\n      // })\n    }\n  })\n}\n\nexport { awakenEnd } //eslint-disable-line\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/end.js","import BABYLON from 'experiment-babylon-js'\nimport {\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  hasConstructor,\n  delay,\n} from 'experiment-js'\n\nimport { setMargins } from '../functions/globalFunctions'\n\n\nconst awakenPause = function () {\n  const stateManager = this.stateManager\n  const levelObject = stateManager.get('levelObject')\n  const GUI = stateManager.get('GUI')\n  const R = this.R\n  const state = this.state\n  const pauseTime = stateManager.timeInMs\n  const threshold = R.get.thresholdIdle\n\n\n  state.hitKeyTime = null\n  state.initialGuiVisible = GUI.levelVisible\n\n  GUI.backgroundFill = BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0, 0, 0, 1))\n  GUI.levelVisible = true\n\n  const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: pauseTime })\n  if (lastPauseInfo.level !== levelObject.level) {\n    stateManager.set('pauseTimeLeft', threshold)\n  }\n\n  const currentTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n  stateManager.set('lastPauseInfo', { level: levelObject.level, time: pauseTime })\n\n  // datamanager get pause left\n  const options = { id: 'pauseText',\n    parent: GUI,\n    marginAlignment: 'h: center, v: center',\n    fontName: '30pt Arial',\n    fontSignedDistanceField: true,\n  }\n\n  state.timerText = function () {\n    const timeLeft = parseInt((currentTimeLeft - stateManager.timeInMs + pauseTime) / 1000, 10)\n    if (timeLeft < 0) { return false }\n    return R.get.timeLimitText.replace('{n}', String(timeLeft))\n  }\n\n  let t = 0\n  const delayInMs = 200\n  state.tic = function () {\n    state.centerText.levelVisible = true\n    const text = state.timerText()\n    if (text === false) {\n      stateManager.set('endReason', R.get.endReasonIdle.replace('{t}', (threshold / 1000)).replace('{l}', levelObject.level))\n      stateManager.goToState(R.get.states_end)\n    } else {\n      state.centerText.text = text\n      delay(delayInMs).then(() => {\n        if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n      })\n      t += delayInMs\n      if (t >= 3000) {\n        stateManager.get('sounds').prediction.play()\n        t = 0\n      }\n    }\n  }\n\n  if (!hasConstructor(BABYLON.Text2D, state.centerText)) {\n    state.topText = new BABYLON.Text2D(R.get.pauseText, options)\n    setMargins(state.topText, { topPixels: 0, bottomPixels: 40, leftPixels: 0, rightPixels: 0 })\n    state.centerText = new BABYLON.Text2D(state.timerText(), options)\n  } else {\n    state.topText.levelVisible = true\n    state.centerText.levelVisible = true\n    state.centerText.text = state.timerText\n  }\n\n\n  delay(200).then(() => {\n    if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n  })\n}\n\nconst pauseKeyDown = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n  const levelObject = { level: 0 } // stateManager.get('levelObject')\n  const R = this.R\n  const context = this\n  const threshold = R.get.thresholdIdle\n\n  if (state.hitKeyTime === null) { state.hitKeyTime = stateManager.timeInMs }\n\n  state.timerText = function () {\n    const timeLeft = Math.ceil((3000 - stateManager.timeInMs + state.hitKeyTime) / 1000, 10)\n    if (timeLeft < 0) { return false }\n    return R.get.pauseRestart.replace('{n}', String(timeLeft))\n  }\n\n  state.tic = function () {\n    const text = state.timerText()\n    if (text !== false) {\n      state.centerText.text = text\n      delay(200).then(() => {\n        if (!document.hasFocus()) {\n          const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: stateManager.timeInMs })\n          const previousTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n          const currentTimeLeft = previousTimeLeft - stateManager.timeInMs + lastPauseInfo.time\n\n          stateManager.set('pauseTimeLeft', currentTimeLeft)\n          awakenPause.bind(context)()\n        } else if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n      })\n    } else if (stateManager.frozenState) { stateManager.goToState(stateManager.frozenState) }\n  }\n\n  delay(200).then(() => {\n    if (!document.hasFocus()) {\n      awakenPause.bind(context)()\n    } else if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n  })\n}\n\nconst endPause = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const levelObject = { level: 0 } // stateManager.get('levelObject')\n  const GUI = stateManager.get('GUI')\n  const R = this.R\n  const threshold = R.get.thresholdIdle\n\n  GUI.backgroundFill = BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(1, 1, 1, 0))\n  GUI.levelVisible = state.initialGuiVisible\n\n  state.hitKeyTime = null\n  state.topText.levelVisible = false\n  state.centerText.levelVisible = false\n\n  const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: stateManager.timeInMs })\n  const previousTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n  const currentTimeLeft = previousTimeLeft - stateManager.timeInMs + lastPauseInfo.time\n\n  if (currentTimeLeft < -3) {\n    stateManager.call('prematureEnd', { reason: R.get.prematureEndPauseAboveThreshold })\n  } else {\n    stateManager.set('pauseTimeLeft', currentTimeLeft)\n  }\n}\n\n\nexport { awakenPause, endPause, pauseKeyDown }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/pause.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n  mandatory,\n  debuglog,\n  debugWarn,\n  debugError,\n  sizeToVec,\n  hasConstructor,\n} from 'experiment-js'\n\n  /* --- State function --- */\n\nconst stateUnfrozen = function () {\n  if (_.has(this.state, 'currentTrialData.hasPaused')) {\n    this.state.currentTrialData.hasPaused = true\n  }\n}\n\nconst pauseTransition = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  /* --- Get the trial data --- */\n  const trials = this.R.get.trials\n\n  const index = stateManager.get('currentTrial', 0)\n  try {\n    if (index >= trials.length) {\n      return this.taskObject.setCheckpoint(R.get.checkpoint_taskDone).promise\n      .then(() => {\n        stateManager.goToState(R.get.states_end)\n      })\n    }\n    const maxTransitionTime = R.get.pameters.pauseTime\n    const promise = stateManager.resolveOnKey({ except: null })\n    let shouldtic = true\n    let text2d\n\n    const transitionText = function () {\n      const timeLeft = Math.ceil((maxTransitionTime - stateManager.timeInMs) / 1000, 10)\n      if (timeLeft < 0) { return false }\n      return R.get.finishedLevelTransition.replace('{n}', String(timeLeft))\n    }\n\n    state.tic = function () {\n      if (!shouldtic) { return }\n      const text = transitionText()\n      if (text !== false) {\n        text2d.text = text\n        state.tooltipPause.box.levelVisible = true\n        delay(200).then(() => {\n          state.tooltipPause.box.levelVisible = false\n          state.tic()\n        })\n      } else {\n        stateManager.set('endReason', 'You were idle for more than 15 min')\n        stateManager.goToState(R.get.states_end)\n      }\n    }\n\n\n    const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n    state.tooltipPause = stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, (this.taskObject.renderSize.height / 2) - 100)), text: transitionText(), duration: promise })\n    text2d = state.tooltipPause.text\n    this.state.shouldPause = false\n    state.tic()\n\n    return promise.then(() => {\n      shouldtic = false\n      stateManager.goToState(R.get.states_active)\n          // stateManager.newEvent(R.get.flags_levelDefined, null, { level: level + 1 }, ['globalLog', `stateRunningEventsLvl${level}`])\n    })\n  } catch (e) {\n    debugError('running.pauseTransition: error with the level data.')\n    stateManager.set('endReason', 'There was an error with the task. We are sorry.')\n    stateManager.goToState(R.get.states_end)\n  }\n}\n\nconst startRunning = function () {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('state.startRunning: this.taskObject is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = stateManager.R\n\n  if (!document.hasFocus()) {\n    stateManager.newEvent(R.get.forcePause)\n  }\n\n  state.shouldPause = false\n  state.pausedBetween = []\n  stateManager.call('showAll')\n\n  /* --- Setup state variables --- */\n  if (typeof state.data === 'undefined') {\n    state.data = []\n  }\n  state.numberOfMissed = 0\n  state.isPredicting = false\n\n  /* --- Store the data --- */\n  const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n  const promise = stateManager.resolveOnKey({ except: null })\n  stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, (this.taskObject.renderSize.height / 2) - 100)), text: 'You are about to start the task\\nHit a key to when ready', duration: promise })\n\n  promise.then(() => {\n    // show the first position\n    const nextTransitionTime = this.stateManager.timeInMs + 100\n    const nextTransitionEvent = new EventData(R.get.events_nextTrial, nextTransitionTime, {\n      belongsTo: [\n        'globalLog', 'stateRunningEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n    })\n    stateManager.addTimeTriggerEvent(nextTransitionEvent)\n  })\n\n\n  return ('state.startRunning: resolved')\n}\n\nconst storeData = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n\n  /* --- If currentTrialData is already set, send it to the dataManager to be stored before handling new position --- */\n  let dataToStore = state.currentTrialData\n  try {\n    if ((hasConstructor(Object, state.currentTrialData)) && (stateManager.get('subject_id'))) {\n      const { trial, direction, choice, responseTime, startObservation,\n      endObservation, respondedAt, keysHits, hasPaused, clicks } = state.currentTrialData\n\n      // check if next position is not end of sequence\n      const correct = direction === choice\n\n      /* --- Store the data --- */\n      dataToStore = {\n        subject_id: stateManager.get('subject_id'),\n        trial,\n        direction,\n        observation_duration: endObservation - startObservation,\n        subject_choice: choice, // NA for NOGO\n        response_time: responseTime, // NA for NOGO or no response\n        correct,\n        key_hits: JSON.stringify(keysHits), // ['key', 'time'], [k,t], ...\n        clicks: JSON.stringify(clicks),\n        has_paused: hasPaused,\n        start_observation: startObservation,\n        end_observation: endObservation,\n        responded_at: respondedAt,\n        belongsTo: ['walkerData'],\n      }\n\n      stateManager.storeData(dataToStore)\n      state.currentTrialData = null\n    }\n  } catch (e) {\n    const message = 'runningState.goToNextPosition: could not store cwData.'\n    debugError(message)\n    stateManager.storeInErrorLog({ message, timestamp: stateManager.timeInMs, data: dataToStore })\n    // TODO check that the stateManager will store it in the DB\n  }\n}\n\nconst nextTrial = function () {\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  // explode spheres\n  if ((hasConstructor(Object, this.state.currentTrialData)) && (this.state.currentTrialData.direction === this.state.currentTrialData.choice)) {\n    this.stateManager.call('explode', { meshes: this.stateManager.get('pointSpheres', []) })\n  }\n\n  /* --- Store Data --- */\n  storeData.bind(this)()\n\n  /* --- Get the trial data --- */\n  const trials = this.R.get.trials\n  // const trialIndex = this.stateManager.get('currentTrial', -1) + 1\n  // if (trialIndex >= trials.length) {\n  //   return 'End trials'\n  // }\n\n  const trialIndex = _.random(0, trials.length - 1)\n  this.stateManager.set('currentTrial', trialIndex)\n  const trialData = trials[trialIndex] // TODO Change that\n\n  /* --- Set up the stored data --- */\n  // setup the trialData for this specific trial\n  const data = {\n    trial: trialIndex, // sequenceObject.trial[index],\n    direction: trialData.direction, // sequenceObject.trialType[index],\n    positions: trialData.positions,\n    currentIndex: -1,\n    state: this.state.stateKey,\n    choice: null,\n    responseTime: null,\n    startObservation: null,\n    endObservation: null,\n    respondedAt: null,\n    keysHits: [],\n    clicks: [],\n    hasPaused: false,\n  }\n\n  this.state.data.push(data)\n\n  // Change the currentTrialData to match new index\n  // keep the currentTrialData reference directly in the state\n  this.state.currentTrialData = data\n\n  // start from a new position - set the prediction phase to false\n  this.state.isPredicting = false\n\n  // hide the spheres\n  this.stateManager.call('hidePointSpheres')\n\n  // wait for explosion to finish\n  delay(parameters.explosionTime).then(() => {\n    // change the camera based on the future direction\n    this.stateManager.call('setViewForDirection', data)\n\n    // show the center cross\n    this.stateManager.call('showCross')\n  })\n\n  // wait fixation time then start looping\n  this.stateManager.newEvent(this.R.get.events_goNextPosition, parameters.ITI + parameters.explosionTime, null, ['stateRunningEvents'])\n}\n\nconst goToNextPosition = function () {\n  if (this.state.currentTrialData === 'undefined') {\n    return 'State.Running.goToNextPosition: undefined current trial data'\n  }\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = stateManager.R\n  const parameters = R.get.parameters\n\n  // hide the cross\n  stateManager.call('hideCross')\n\n  // get the trial data\n  const trialData = state.currentTrialData\n\n  /* --- Check the participant is doing the task and has valid connection --- */\n  if (!document.hasFocus()) {\n    stateManager.newEvent(R.get.events_windowBlur, null, null, ['stateRunningEvents'])\n  }\n\n  let checkConnection = false\n  if (hasConstructor(Deferred, this.state.checkLastInteraction)) {\n    if (!this.state.checkLastInteraction.pending) {\n      this.state.checkLastInteraction = new Deferred()\n      checkConnection = true\n    }\n  } else {\n    this.state.checkLastInteraction = new Deferred()\n    checkConnection = true\n  }\n\n  if (checkConnection) {\n    stateManager.call('checkIdleAndConnection', { deferred: this.state.checkLastInteraction })\n  }\n\n  /* --- Check if observation has started or set it up --- */\n  if (trialData.startObservation === null) {\n    trialData.startObservation = stateManager.timeInMs\n  }\n\n  /* --- Check if observation-prediction is finished --- */\n  if (((stateManager.timeInMs - trialData.startObservation) > parameters.maxObservationTime) || (trialData.choice !== null)) {\n    trialData.endObservation = stateManager.timeInMs\n    stateManager.newEvent(R.get.events_nextTrial, null, null, ['stateRunningEvents'])\n    return 'End observation'\n  }\n\n  // make sure the spheres are showing\n  this.stateManager.call('showPointSpheres')\n\n  // accept prediction\n  state.isPredicting = true\n\n  /* --- Setup next position --- */\n  const positions = trialData.positions\n\n  /* --- Set index --- */\n  if (trialData.currentIndex + 1 >= positions.length) {\n    trialData.currentIndex = -1\n  }\n  trialData.currentIndex += 1\n\n  const index = trialData.currentIndex\n\n  /* --- Check if end of level --- */\n  if (index >= positions.length) {\n    // positionData.fullSequenceIndex -= 1\n    // go to endBlock -> pause - wait for next level to start\n    const nextTransitionEvent = new EventData(R.get.events_pauseTransition, stateManager.timeInMs, {\n      belongsTo: [\n        'globalLog', 'stateRunningEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n    })\n    stateManager.addTimeTriggerEvent(nextTransitionEvent)\n    return ('goToNextPosition: resolved. End of sequence.')\n  }\n\n\n  // set up a deferred object to return and catch promises resolution\n  const deferred = new Deferred()\n\n  // Redraw tiles and move to next position\n  const points = positions[index]\n  const rate = 60\n  stateManager.promise('updatePoints', points)\n  .then(() => {\n    // delay(1000 / rate).then(() => {\n    stateManager.newEvent(R.get.events_goNextPosition, 1000 / rate, null, ['stateRunningEvents'])\n    // })\n\n    if (state.numberOfMissed >= 5) {\n      stateManager.newEvent(R.get.events_moreThanFiveNA, null, null, ['stateRunningEvents'])\n      deferred.resolve('goToNextPosition: resolved. Too many NA.')\n    }\n\n    deferred.resolve('stateManager.goToNextPosition: resolved')\n  })\n  /* --- Check if data is set and if subject had not been idle  --- */\n\n\n  return deferred.promise\n}\n\nconst endObservation = function () {\n  this.state.currentTrialData.endObservation = this.stateManager.timeInMs\n  this.stateManager.call('setAgentOpacity', { opacity: 0 })\n  return 'endObservation resolved'\n}\n\nconst startPrediction = function () {\n  if (typeof this.state.currentTrialData === 'undefined') {\n    throw new Error('state.startPrediction: state.currentTrialData is undefined')\n  }\n\n  const state = this.state\n  const stateManager = this.stateManager\n  const R = stateManager.R\n\n  state.numberOfMissed += 1\n\n  const levelObject = stateManager.get('levelObject')\n  stateManager.promise('setAgentOpacity', { opacity: R.get.agent_predictionOpacity })\n\n  stateManager.call('drawPredictionTiles')\n\n  const cross = this.stateManager.get('elements2D').cross\n  cross.spriteFrame = R.get.cross_predict\n  if (levelObject.sound === true) { this.stateManager.get('sounds').prediction.play() }\n\n  state.isPredicting = true\n  state.currentTrialData.startPrediction = stateManager.timeInMs\n  const endResponse = levelObject.predictionDuration\n\n  this.stateManager.newEvent(R.get.events_responseTimeEnded, endResponse, null, ['stateRunningEvents'])\n}\n\nconst checkForClickPrediction = function (event = mandatory()) {\n  try {\n    if (typeof this.taskObject === 'undefined') {\n      throw new Error('state.checkForClickPrediction: this.taskObject is undefined')\n    }\n\n      // todo with click detection Canvas2D\n    if (typeof event.data.clientY === 'undefined') {\n      throw new Error('state.checkForClickPrediction: event.data.clientY is undefined.')\n    }\n\n    if (typeof this.state.currentTrialData === 'undefined') {\n      throw new Error('state.checkForClickPrediction: options.trialData is undefined')\n    }\n\n    const stateManager = this.stateManager\n    const state = this.state\n\n    state.currentTrialData.clicks.push([event.data.engineX, event.data.engineY, stateManager.timeInMs])\n  } catch (e) {\n    debugError(e)\n  }\n  return 'checkForClickPrediction resolved'\n}\n\nconst checkKeyStrokeForPrediction = function (event = mandatory()) {\n  try {\n    if (typeof this.taskObject === 'undefined') {\n      throw new Error('state.checkKeyStrokeForPrediction: this.taskObject is undefined')\n    }\n\n    if (typeof event.data.keyCode === 'undefined') {\n      throw new Error('state.startPrediction: event.data.keyCode is undefined')\n    }\n\n    if (typeof this.state.currentTrialData === 'undefined') {\n      throw new Error('state.startPrediction: state.currentTrialData is undefined')\n    }\n\n    const stateManager = this.stateManager\n    const state = this.state\n    const R = this.R\n\n    const keyCode = event.data.keyCode\n\n    const keyValue = event.data.key\n\n    if (_.has(state, 'currentTrialData.keysHits')) {\n      if (!hasConstructor(Array, state.currentTrialData.keysHits)) {\n        state.currentTrialData.keysHits = []\n      }\n\n      state.currentTrialData.keysHits.push([keyValue, keyCode, stateManager.timeInMs])\n    }\n\n    const keys = {\n      ArrowLeft: [39, 'LEFT', R.get.cross_bottomRight],\n      ArrowRight: [37, 'RIGHT', R.get.cross_topLeft],\n    }\n\n    let direction = null\n    for (const key in keys) {\n      if (keys.hasOwnProperty(key)) {\n        const keyPosition = keys[key]\n        if (keyValue === key) {\n          direction = keyPosition[1]\n        }\n      }\n    }\n\n    if (direction !== null) {\n      /* --- Check if the subjects click was during the prediction phase and that he did not already chose  --- */\n\n      if ((state.isPredicting === true) && (state.currentTrialData.choice === null)) {\n        /* --- If the key was one of the specified store the corresponding direction, responseTime and choice --- */\n\n\n          // Store the choice of the subject and responseTime\n        state.currentTrialData.choice = direction\n        state.currentTrialData.responseTime = stateManager.timeInMs - state.currentTrialData.startObservation\n        state.currentTrialData.respondedAt = stateManager.timeInMs\n\n        stateManager.call('highlightPosition', { direction })\n\n          // reset the number of missed trials\n        state.numberOfMissed = 0\n\n        debuglog(`state.checkKeyStrokeForPrediction: has chosen direction ${direction}.`)\n        return direction\n      }\n      debuglog('state.checkKeyStrokeForPrediction: already chosen')\n      return false\n    }\n    debuglog('state.checkKeyStrokeForPrediction: key did not correspond to state selection keys.')\n    return false\n  } catch (e) {\n    debugError(e)\n    return false\n  }\n}\n\nconst playSound = function (event) {\n  const sounds = this.stateManager.getGlobal('sounds')\n  sounds[event.data.name].play()\n}\n\nexport {\n  stateUnfrozen,\n  startRunning,\n  nextTrial,\n  goToNextPosition,\n  startPrediction,\n  checkForClickPrediction,\n  checkKeyStrokeForPrediction,\n  playSound,\n  endObservation,\n  pauseTransition,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/running.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n  mandatory,\n  debuglog,\n  hasConstructor,\n  rep,\n  sizeToVec,\n  debugError,\n  debugWarn,\n} from 'experiment-js'\n\nimport { getFullSequenceObjectForClassicLevels, sampleExponential } from '../../../utilities/taskUtilities'\n\n\nconst awakeTryout = function () {\n  const taskObject = this.taskObject\n  const state = this.state\n  const currentTutorial = this.stateManager.get('currentTutorial', 1)\n  const stateManager = this.stateManager\n  const elements2D = stateManager.get('elements2D')\n  const R = this.R\n\n  elements2D.loader.value = 0\n  stateManager.call('showAll')\n\n  state.data = state.data || []\n  state.isPredicting = false\n  state.shouldPause = (currentTutorial !== 1)\n  state.index = -1\n  stateManager.setGlobal('level', `tryout-${currentTutorial}`)\n\n  if (currentTutorial === 1) {\n    // set classic sequence object with 10 transition\n    state.sequenceObject = getFullSequenceObjectForClassicLevels([1, 3, 4, 2, 1, 3, 4, 2, 1, 3, 2, 4, 2, 1, 3])\n    stateManager.setGlobal('levelObject', this.taskObject.parameters.levels[0])\n  } else {\n    // set fMRI sequence object with 5 transition wolf and 5 transition rabbit\n    state.sequenceObject = {\n      fullSequence: [1, 2, 1, 3, 4, 2, 1, 3, 4, 3],\n      trial: _.range(1, 10),\n      trialType: rep(['observation_prediction', 'blackout'], 5),\n      block: rep(1, 5).concat(rep(2, 5)),\n      blockType: rep('random', 5).concat(rep('normal', 5)),\n    }\n    stateManager.setGlobal('levelObject', taskObject.parameters.levels[3])\n  }\n\n  this.stateManager.newEvent(this.R.get.events_goNextPosition, null, null, [`stateTryout${currentTutorial}`])\n}\n\nconst tryoutGoToNextPosition = function () {\n  // TODO experiment-boxes penser a faire dans un tooltip tool qui permet de focus sur un element et fait un modal en dessous pour expliquer\n\n  const stateManager = this.stateManager\n  const state = this.state\n  state.index += 1\n\n  const elements2D = stateManager.get('elements2D')\n  const levelObject = stateManager.get('levelObject')\n  const cross = elements2D.cross\n  const R = this.R\n  const tutorials = R.get.tutorials\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n  const index = state.index\n  const sequenceObject = state.sequenceObject\n\n  stateManager.hideTooltip()\n  state.isWaitingToPredict = new Deferred()\n  state.isWaitingToPredict.resolve()\n\n  const ntransition = sequenceObject.fullSequence.length\n  // Check if finished\n  if (index > ntransition - 1) {\n    // show finished tryout\n    stateManager.call('hideAll')\n\n    if (currentTutorial === 1) {\n      const event = new EventData(this.R.get.flags_levelDefined, stateManager.timeInMs, { level: 1 })\n      this.taskObject.modal({ title: tutorials.askContinue.title.en, content: tutorials.askContinue.content.en, event })\n    } else {\n      const event = new EventData(this.R.get.flags_levelDefined, stateManager.timeInMs, { level: 4 })\n      this.taskObject.modal({ title: tutorials.askfMRIContinue.title.en, content: tutorials.askfMRIContinue.content.en, event })\n    }\n\n    this.taskObject.currentModal.modalBox.buttonText = 'Go !'\n\n    return 'state.tryoutGoToNextPosition: finished tryout'\n  }\n\n  elements2D.loader.value = 100 * index / ntransition\n\n\n  let lastChoice = null\n  if ((typeof state.currentTrialData === 'object') && (typeof state.currentTrialData.choice === 'number')) {\n    lastChoice = parseInt(state.currentTrialData.choice, 10)\n  }\n\n  // setup the trialData for this specific trial\n  const trialData = {\n    level: levelObject.level,\n    fullSequenceIndex: index,\n    block: sequenceObject.block[index],\n    blockType: sequenceObject.blockType[index],\n    trial: sequenceObject.trial[index],\n    trialType: sequenceObject.trialType[index],\n    state: state.stateKey,\n    position: sequenceObject.fullSequence[index],\n    choice: null,\n    responseTime: null,\n    startObservation: null,\n    endObservation: null,\n    respondedAt: null,\n    startPrediction: null,\n    endPrediction: null,\n    nextPosition: null,\n    observedTransitionWasDominant: null,\n    keysHits: [],\n    clicks: [],\n    hasPaused: null,\n  }\n  state.data.push(trialData)\n\n  /* --- If currentTrialData is already set, send it to the dataManager to be stored before handling new position --- */\n  let dataToStore = state.currentTrialData\n  try {\n    if ((typeof state.currentTrialData !== 'undefined') && (stateManager.get('subject_id'))) {\n      const { block, blockType, trial, trialType, position, choice, responseTime, startObservation,\n      startPrediction, respondedAt, endPrediction, keysHits, hasPaused, clicks, endObservation } = state.currentTrialData\n\n      /* --- Check if the transition observed was dominant --- */\n      const dominant = null\n\n\n      /* --- Store the data --- */\n      dataToStore = {\n        subject_id: stateManager.get('subject_id'),\n        level: currentTutorial,\n        block,\n        block_type: blockType,\n        dominant_structure: levelObject.dominantStructure,\n        dominant_transition_probability: levelObject.dominantProbability,\n        trial,\n        trial_type: trialType,\n        position,\n        observation_duration: startPrediction ? (startPrediction - startObservation) : (this.timeInMs - startObservation),\n        observed_transition_was_dominant: dominant, // NA for first transition in a sublevel and after prediction\n        transition_to: sequenceObject.fullSequence[index], // NA for GO trials (non blackouts)\n        subject_choice: choice, // NA for NOGO\n        response_time: responseTime, // NA for NOGO or no response\n        correct: parseInt(sequenceObject.fullSequence[index], 10) === parseInt(choice, 10),\n        key_hits: JSON.stringify(keysHits), // ['key', 'time'], [k,t], ...\n        clicks: JSON.stringify(clicks),\n        has_paused: hasPaused,\n        start_observation: startObservation,\n        end_observation: endObservation,\n        start_prediction: startPrediction,\n        responded_at: respondedAt,\n        end_prediction: endPrediction,\n        belongsTo: ['tryoutData'],\n      }\n      stateManager.storeData(dataToStore)\n    }\n  } catch (e) {\n    const message = 'runningState.goToNextPosition: could not store cwData.'\n    debugError(message)\n    stateManager.storeInErrorLog({ message, timestamp: stateManager.timeInMs, data: dataToStore })\n    // TODO check that the stateManager will store it in the DB\n  }\n\n    // keep the currentTrialData reference directly in the state\n  state.currentTrialData = trialData\n\n    // start from a new position - set the prediction phase to false\n  state.isPredicting = false\n\n  // set up a deferred object to return and catch promises resolution\n  // const deferred = new Deferred()\n\n  let agentType = 'wolf'\n  if (sequenceObject.blockType[index] === 'random') { agentType = 'rabbit' }\n  if (elements2D.agentType !== agentType) {\n    stateManager.call('setAgent', { agent: agentType })\n  }\n\n  cross.spriteFrame = this.R.get.cross_base\n  stateManager.call('drawTiles', { withKeys: false })\n  stateManager.call('moveAgentToTile', { tile: trialData.position - 1, opacity: 1 })\n  let promise = Promise.resolve()\n  if ((currentTutorial === 1) && (!R.get.wolfFirstAppears.passed)) {\n    promise = this.taskObject.modal({ title: R.get.wolfFirstAppears_title, content: R.get.wolfFirstAppears_message })\n    R.get.wolfFirstAppears.passed = true\n  } else if ((currentTutorial === 2) && (!R.get.rabbitFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.rabbitFirstAppear_title, content: R.get.rabbitFirstAppear_message })\n    R.get.rabbitFirstAppear.passed = true\n  } else if ((currentTutorial === 2) && (sequenceObject.trialType[index - 1] === 'blackout') && (!R.get.blackoutFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.blackoutFirstAppear_title, content: R.get.blackoutFirstAppear_message })\n    R.get.blackoutFirstAppear.passed = true\n  } else if ((currentTutorial === 2) && (sequenceObject.blockType[index] === 'normal') && (!R.get.wolfFmriFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.wolfFmriFirstAppear_title, content: R.get.wolfFmriFirstAppear_message })\n    R.get.wolfFmriFirstAppear.passed = true\n  }\n\n  promise.then(() => {\n    trialData.startObservation = stateManager.timeInMs\n\n    let promise = Promise.resolve()\n\n    const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n    if ((index !== 0) && (sequenceObject.trialType[index - 1] !== 'blackout') && (sequenceObject.blockType[index - 1] === sequenceObject.blockType[index])) {\n      if (lastChoice === sequenceObject.fullSequence[index]) {\n         // Correct\n        const background = new BABYLON.Color4(0.1, 0.7, 0.1, 0.9)\n        let text = 'Correct!'\n        let duration = 2000\n        if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n          text += '\\nHit a key to continue'\n          promise = stateManager.resolveOnKey({ except: null })\n          duration = promise\n        }\n\n\n        let position = centerPosition\n        const tilePosition = stateManager.call('getTilePositions')[lastChoice - 1]\n        position = tilePosition\n        stateManager.tooltip({ position, background, text, duration })\n      } else {\n           // Incorrect\n        const background = new BABYLON.Color4(0.7, 0.1, 0.1, 0.9)\n\n        let position = centerPosition // TODO this.taskObject.center\n        if (hasConstructor(Number, lastChoice)) {\n          const tilePosition = stateManager.call('getTilePositions')[lastChoice - 1]\n               // const sign = Math.sign(position.subtract(tilePosition).x)\n          position = tilePosition\n        }\n\n        let text = 'Incorrect!'\n        let duration = 2000\n        if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n          text += '\\nHit a key to continue'\n          promise = stateManager.resolveOnKey({ except: null })\n          duration = promise\n        }\n\n        stateManager.tooltip({ position, background, text, duration })\n      }\n    }\n\n\n    if (currentTutorial === 1 && !R.get.predictionTest.passed && R.get.predictionTest.numberOfPrediction >= 3) {\n      R.get.predictionTest.passed = true\n      promise = stateManager.resolveOnKey({ except: null })\n      stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, centerPosition.y - 100)), text: `${R.get.realTimeTest_message}\\nHit a key to continue`, duration: promise })\n    } else if (R.get.predictionTest.passed) {\n      delay(1000).then(() => { state.isWaitingToPredict = new Deferred() })\n    }\n\n    return promise\n  })\n  .then(() => {\n    trialData.startObservation = stateManager.timeInMs\n    stateManager.newEvent(R.get.events_endObservation, levelObject.observationDuration, null, [`stateRunningEventsLvl${levelObject.level}`])\n\n    if (currentTutorial === 1) {\n      const nextTransitionTime = trialData.startObservation + levelObject.observationDuration + _.random(levelObject.minISIAfterLearning, levelObject.maxISIAfterLearning)\n      stateManager.newEvent(this.R.get.events_startPrediction, nextTransitionTime, null, [`stateTryout${currentTutorial}`])\n    } else if (sequenceObject.trialType[index] === 'blackout') {\n      const observationTime = levelObject.observationDuration +\n            levelObject.fixedISIAfterObservation +\n            sampleExponential(levelObject.sampleMeanISIAfterObservation, 0, levelObject.maxSampleAfterObservation, levelObject.maxSampleAfterObservation)\n\n      // add a blackout delay\n      delay(observationTime).then(() => {\n        stateManager.newEvent(R.get.events_screenWentBlack, null, [`stateRunningEventsLvl${levelObject.level}`])\n        stateManager.call('setAgentOpacity', { opacity: 0 })\n      })\n\n\n      const blackoutTime = observationTime + levelObject.fixedBlackScreenDuration +\n            sampleExponential(levelObject.sampleMeanBlackScreen, 0, levelObject.maxSampleBlackScreen, levelObject.maxSampleBlackScreen)\n\n          // create prediction event\n      stateManager.newEvent(R.get.events_goNextPosition, blackoutTime, null, [`stateRunningEventsLvl${levelObject.level}`])\n    } else if (sequenceObject.trialType[index] === 'observation_prediction') {\n      let observationTime = stateManager.timeInMs + levelObject.observationDuration + levelObject.fixedISIAfterObservation\n      observationTime += sampleExponential(levelObject.sampleMeanISIAfterObservation, 0, levelObject.maxSampleAfterObservation, levelObject.maxSampleAfterObservation)\n\n      debugWarn('Observation Time', (observationTime - stateManager.timeInMs) / 1000)\n          // create prediction event\n      stateManager.newEvent(R.get.events_startPrediction, observationTime, [`stateRunningEventsLvl${levelObject.level}`])\n    } else {\n      debugError('Error in sequence', sequenceObject)\n    }\n  })\n\n  return 'tryoutGoToNextPosition: finish sync call'\n}\n\nconst tryoutStartPrediction = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n  const R = stateManager.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n  const levelObject = stateManager.get('levelObject')\n  stateManager.promise('setAgentOpacity', { opacity: R.get.agent_predictionOpacity })\n\n  const cross = stateManager.get('elements2D').cross\n  cross.spriteFrame = R.get.cross_predict\n\n  const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n  let promise = Promise.resolve()\n  if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n    stateManager.call('drawPredictionTiles', { withKeys: 'dkmc' })\n    promise = stateManager.resolveOnKey({ except: null })\n    stateManager.tooltip({\n      position: centerPosition.add(new BABYLON.Vector2(0, centerPosition.y - 100)),\n      text: `${R.get.predictionTest_message}\\n${R.get.hitAKeyToContinue}`,\n      duration: promise,\n      event: new EventData('predictionTextDismissed'),\n    })\n\n    const text = R.get.changeCenterSquare\n    stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, -50)), text, duration: promise })\n  } else {\n    stateManager.call('drawPredictionTiles')\n  }\n\n  promise.then(() => {\n    state.isPredicting = true\n    state.isWaitingToPredict = new Deferred()\n    state.isWaitingToPredict.resolve()\n    state.currentTrialData.startPrediction = stateManager.timeInMs\n\n    if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n      const background = null // new BABYLON.Color4(0.6, 100 / 255, 0, 0.9)\n      const choiceDeferred = new Deferred()\n      state.choiceDeferred = choiceDeferred\n\n      const text = R.get.chooseNextPosition\n      stateManager.tooltip({ position: centerPosition, background, text, duration: choiceDeferred.promise })\n      choiceDeferred.promise.then(() => {\n        stateManager.newEvent(R.get.events_responseTimeEnded, stateManager.timeInMs + levelObject.predictionDuration, null, [`stateTryout${currentTutorial}`])\n      })\n    } else if (currentTutorial === 1) {\n      stateManager.newEvent(R.get.events_responseTimeEnded, stateManager.timeInMs + levelObject.predictionDuration, null, [`stateTryout${currentTutorial}`])\n    } else {\n      stateManager.call('setAgentOpacity', { opacity: 0 })\n      const endResponse = levelObject.predictionDuration\n      delay(endResponse).then(() => {\n        this.state.isPredicting = false\n        if (this.state.currentTrialData.choice !== null) {\n          cross.spriteFrame = R.get.crossLockByPosition[this.state.currentTrialData.choice - 1]\n        } else {\n          cross.spriteFrame = R.get.cross_base\n        }\n      })\n      const endPrediction = endResponse + levelObject.fixedISIAfterPrediction +\n          sampleExponential(levelObject.sampleMeanISIAfterPrediction, null, levelObject.maxSampleAfterPrediction, levelObject.maxSampleAfterPrediction)\n\n      this.stateManager.newEvent(R.get.events_goNextPosition, endPrediction, null, [`stateTryout${currentTutorial}`])\n    }\n  })\n}\n\nconst tryoutCheckKeyStrokeForPrediction = function (event = mandatory()) {\n  if (typeof event.data.keyCode === 'undefined') {\n    throw new Error('state.checkKeyStrokeForPrediction: event.data.keyCode is undefined')\n  }\n\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n\n  const keyCode = event.data.keyCode\n  const keyValue = event.data.key\n  const keys = {\n    m: [77, 3, R.get.cross_bottomRight],\n    d: [68, 1, R.get.cross_topLeft],\n    c: [67, 4, R.get.cross_bottomLeft],\n    k: [75, 2, R.get.cross_topRight],\n  }\n\n  if (_.has(state, 'currentTrialData.keysHits')) {\n    if (!hasConstructor(Array, state.currentTrialData.keysHits)) {\n      state.currentTrialData.keysHits = []\n    }\n\n    state.currentTrialData.keysHits.push([keyValue, keyCode, stateManager.timeInMs])\n  }\n\n  let position = null\n  let cross = 1\n  let chosenKey = null\n  for (const key in keys) {\n    if (keys.hasOwnProperty(key)) {\n      const keyPosition = keys[key]\n      if (keyValue === key) {\n  //  if (keyCode === keyPosition[0]) {\n        position = keyPosition[1]\n        cross = keyPosition[2]\n        chosenKey = key\n      }\n    }\n  }\n\n  if (position !== null) {\n  /* --- Check if the subjects hit was during the prediction phase and that he did not already chose  --- */\n\n    if ((state.isPredicting === true) && (state.currentTrialData.startPrediction !== null) && (state.currentTrialData.choice === null)) {\n    /* --- If the key was one of the specified store the corresponding position, responseTime and choice --- */\n\n      // Store the choice of the subject and responseTime\n      if (hasConstructor(Deferred, state.choiceDeferred)) {\n        state.choiceDeferred.resolve()\n        state.choiceDeferred = null\n      }\n\n      state.currentTrialData.choice = position\n      state.currentTrialData.responseTime = stateManager.timeInMs - state.currentTrialData.startPrediction\n      state.currentTrialData.respondedAt = stateManager.timeInMs\n\n      this.stateManager.get('elements2D').cross.spriteFrame = cross\n      if (!R.get.predictionTest.passed) {\n        R.get.predictionTest.numberOfPrediction += 1\n\n        const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n        let tilePosition = stateManager.call('getTilePositions')[position - 1]\n        const sign = Math.sign(centerPosition.subtract(tilePosition).x)\n        tilePosition = tilePosition.add(new BABYLON.Vector2(sign * 50, sign * 50))\n        stateManager.tooltip({ position: tilePosition, text: `${R.get.youSelectedThisTile} (${chosenKey})`, duration: delay(2000) })\n        const text = R.get.aLittleSquareShowsYourChoice\n        stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, -50)), text, duration: 2000 })\n      }\n\n      // reset the number of missed trials\n      state.numberOfMissed = 0\n\n\n      stateManager.newEvent(R.get.events_hasResponded, null, null, [`stateTryout${currentTutorial}`])\n      debuglog(`state.checkKeyStrokeForPrediction: has chosen position ${position}.`)\n      return position\n    } else if (hasConstructor(Deferred, state.isWaitingToPredict) && state.isWaitingToPredict.pending) {\n      const background = new BABYLON.Color4(0.7, 0.1, 0.1, 0.9)\n      stateManager.tooltip({ position: new BABYLON.Vector2((this.taskObject.renderSize.width / 2), (this.taskObject.renderSize.height / 2) - 100), text: R.get.tooEarly, background, duration: state.isWaitingToPredict })\n      state.isWaitingToPredict.resolve()\n      debuglog('state.checkKeyStrokeForPrediction: too early')\n      return false\n    }\n    debuglog('state.checkKeyStrokeForPrediction: already chosen')\n    return false\n  }\n  debuglog('state.checkKeyStrokeForPrediction: not a valid time to choose or already chosen')\n  return false\n}\n\nconst tryoutEndPrediction = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n  /* --- End prediction - store data --- */\n  state.isPredicting = false\n  state.currentTrialData.endPrediction = stateManager.timeInMs\n\n  stateManager.newEvent(R.get.events_goNextPosition, null, null, [`stateTryout${currentTutorial}`])\n  return ('state.endPrediction: resolved')\n}\n\n\nconst tryoutEnd = function () {\n  const stateManager = this.stateManager\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n  this.taskObject.setCheckpoint(R.get.checkpoint_tutorialDone[currentTutorial - 1])\n}\n\nexport {\n  awakeTryout,\n  tryoutEndPrediction,\n  tryoutCheckKeyStrokeForPrediction,\n  tryoutGoToNextPosition,\n  tryoutStartPrediction,\n  tryoutEnd,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/tryout.js","import {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  delay,\n  debuglog,\n  hasConstructor,\n} from 'experiment-js'\n\nimport { SmartModal } from 'experiment-boxes'\n\n\nconst pageOrderTutorialOne = ['intro', 'disclaimer', 'trialInstruction']\n\nconst awakeTutorial = function () {\n  const currentTutorial = this.stateManager.get('currentTutorial', 1)\n\n  const pageOrder = pageOrderTutorialOne\n\n  this.stateManager.set('currentPage', pageOrder[0])\n\n  const showIntro = new EventData(this.R.get.events_showModal, { page: pageOrder[0] })\n  this.stateManager.addEvent(showIntro)\n\n\n  this.stateManager.set('levelObject', { level: `tutorial-${currentTutorial}` })\n  this.state.shouldPause = (currentTutorial !== 1)\n}\n\nconst showModal = function ({ data: { page = 'intro' } }) {\n  const tutorials = this.R.get.tutorials\n  delay(50).then(() => { // TODO Check why you have to do that ...\n    if (tutorials.hasOwnProperty(page)) {\n      const tutorial = tutorials[page]\n      const event = new EventData(this.R.get.events_tutorialNext, { page })\n      this.taskObject.modal({ type: 'centralLarge', title: tutorial.title.en, content: tutorial.content.en, event })\n      this.taskObject.currentModal.modalBox.buttonText = 'Next'\n    }\n  })\n}\n\nconst tutorialUnfrozen = function () {\n  if (hasConstructor(Object, this.taskObject.currentModal) && hasConstructor(SmartModal, this.taskObject.currentModal.modalBox)) {\n    this.taskObject.currentModal.modalBox.show()\n  }\n}\n\nconst showNextPage = function ({ data: { page: currentPage = this.stateManager.get('currentPage', 'intro') } }) {\n  const pageOrder = pageOrderTutorialOne\n  const R = this.R\n\n  const currentIndex = pageOrder.indexOf(currentPage)\n  if (currentIndex !== -1) {\n    if (currentIndex !== pageOrder.length - 1) {\n      const showEvent = new EventData(R.get.events_showModal, { page: pageOrder[currentIndex + 1] })\n      this.stateManager.addEvent(showEvent)\n    } else {\n      debuglog('state.showNextPage: end of tutorial.')\n      this.stateManager.goToState(R.get.states_running, true) // TODO make it able to use the state object as well\n    }\n  } else {\n    throw new Error('state.showNextPage: invalid currentPage.')\n  }\n}\n\nexport { showNextPage, showModal, awakeTutorial, tutorialUnfrozen }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/tutorial.js","/** @module taskUtilities */\nimport math from 'experiment-mathjs'\nimport _ from 'lodash'\n\nimport { mandatory, rep } from 'experiment-js'\nimport BABYLON from 'experiment-babylon-js'\n\n/* ======= Texture Functions ======= */\nconst getAspectRatio = function (surfaceObject = mandatory()) {\n  if (surfaceObject.constructor === BABYLON.Texture) {\n    const { width: w, height: h } = surfaceObject.getBaseSize()\n    return (w / h)\n  }\n\n  throw new Error('getAspectRatio: object type not valid.')\n}\n\n/* =============== Task specific functions =============== */\n/**\n * Returns an array of the four possible main transition matrices\n * @return {Array} Each of the four entry is a 16*16 matrix with either 0 or 1\n */\n\nconst getDensity = function (elements, nsteps = 100, windowSize = 3) { // eslint-disable-line\n  if (elements.some(isNaN)) {\n    throw new Error('TaskObject.getDensity: elements are not all numeric.')\n  }\n\n  const range = [math.min(elements), math.max(elements)]\n\n  const stepSize = (range[1] - range[0]) / nsteps\n  // const windowLenght = stepSize * windowSize\n\n  const elementsInWindow = []\n  const windowPosition = []\n  const density = []\n  const points = []\n  for (let i = 0; i < nsteps; i++) {\n    const subset = _.filter(elements, (e) => {\n      const centered = e - range[0] - (i * stepSize)\n      return ((centered >= 0) && (centered < stepSize))\n    })\n\n    windowPosition[i] = (i + 0.5) * stepSize\n    elementsInWindow[i] = subset.length\n    density[i] = elementsInWindow[i] / elements.length\n    points[i] = {\n      x: windowPosition[i],\n      y: density[i],\n    }\n  }\n\n  return ({\n    windows: {\n      position: windowPosition,\n      numberOfElements: elementsInWindow,\n      density,\n    },\n    points,\n    chartOptions: {\n      type: 'line',\n      data: {\n        datasets: [{\n          label: 'Density',\n          data: points,\n        }],\n      },\n      options: {\n        scales: {\n          xAxes: [{\n            type: 'linear',\n            position: 'bottom',\n          }],\n        },\n      },\n    },\n  })\n}\n\nconst randomColor = function (opacity) {\n  return `rgba(${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${opacity || '.3'})`\n}\n\nconst computeDurationEstimate = function (options = {}) {\n  const parametersBase = {\n    dominantProbability: 0.76,\n    minNumberOfObservationsPerLearning: 3,\n    maxNumberOfObservationsPerLearning: 7,\n    observationDuration: 500,\n    interObservationDuration: 50, // to add ?\n    minTimeToPredict: 2000,\n    maxTimeToPredict: 5000,\n    feedbackDuration: 500,\n    minISIAfterLearning: 1000,\n    maxISIAfterLearning: 1500,\n    minISIAfterFeedback: 3000,\n    maxISIAfterFeedback: 5000,\n    rabbitAutoTransition: false,\n    rabbitDominantProbability: 0.6,\n    observationSegmentSizes: [3, 4, 5],\n    observationSegmentRepetitionPerBlock: 2,\n    numberOfBlocks: 6,\n    numberOfRandomBlocks: 2,\n    feedbackType: 'transition',\n  }\n\n  options = _.extend(parametersBase, options)\n\n  // number of observation = sum(segment sizes) * segment repetition per block\n  const numberOfObservationPerLevel = math.sum(options.observationSegmentSizes) * options.observationSegmentRepetitionPerBlock\n\n  // duration of one observation = observationDuration (add inter observation duration ?)\n  const oneObservationDuration = options.observationDuration\n\n  // observation duration for one block\n  const observationsDurationPerBlock = numberOfObservationPerLevel * oneObservationDuration\n\n  // number of prediction per block\n  const numberOfPredictionEventsPerBlock = options.observationSegmentSizes.length * options.observationSegmentRepetitionPerBlock\n\n  // min max and mean duration of one prediction event stored in a matrix\n  // timeDurationMatrix 4*2 min, max\n  const timeDurationMatrix = math.matrix([\n    [options.minISIAfterLearning, options.maxISIAfterLearning],\n    [options.minTimeToPredict, options.maxTimeToPredict],\n    [options.feedbackDuration, options.feedbackDuration],\n    [options.maxISIAfterFeedback, options.maxISIAfterFeedback],\n  ])\n\n  // factorMatrix 2*3 min max mean\n  const factorMatrix = math.matrix([\n    [1, 0, 1 / 2],\n    [0, 1, 1 / 2],\n  ])\n\n  // predictionDurationMatrix 4*3\n  const predictionDurationMatrix = math.multiply(timeDurationMatrix, factorMatrix)\n\n  // sumPredictionDurationVector 1*3\n  const sumPredictionDurationVector = math.multiply(math.matrix([1, 1, 1, 1]), predictionDurationMatrix)\n\n  const predictionsDurationPerBlock = math.multiply(sumPredictionDurationVector, numberOfPredictionEventsPerBlock)\n\n  // duration of one block\n  const observationDurationMatrix = math.matrix(rep(observationsDurationPerBlock, 3))\n\n  const durationPerBlock = math.add(observationDurationMatrix, predictionsDurationPerBlock)\n\n  // let total duration for one level min max mean in miliseconds\n  const totalDuration = (math.multiply(durationPerBlock, (options.numberOfBlocks + options.numberOfRandomBlocks))).toArray()\n\n  return ({\n    min: totalDuration[0],\n    max: totalDuration[1],\n    mean: totalDuration[2],\n  })\n}\n\nexport {\n  computeDurationEstimate,\n  randomColor,\n  getDensity,\n  getAspectRatio,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/utilities/taskUtilities.js","module.exports = __WEBPACK_EXTERNAL_MODULE_16__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}\n// module id = 16\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_17__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}\n// module id = 17\n// module chunks = 0"],"sourceRoot":""}