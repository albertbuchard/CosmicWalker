{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 06f843adebfb6f7b9931","webpack:///external {\"commonjs\":\"experiment-js\",\"commonjs2\":\"experiment-js\",\"amd\":\"experiment-js\",\"root\":\"experiment\"}","webpack:///external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}","webpack:///external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}","webpack:///external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}","webpack:///./src/task/scenes/main/functions/globalFunctions.js","webpack:///./src/task/startup/startup.js","webpack:///./builder.js","webpack:///./src/config.js","webpack:///./src/task/scenes/main/MainScene.js","webpack:///./src/task/scenes/main/states/active.js","webpack:///./src/task/scenes/main/states/end.js","webpack:///./src/task/scenes/main/states/pause.js","webpack:///./src/task/scenes/main/states/running.js","webpack:///./src/task/scenes/main/states/tryout.js","webpack:///./src/task/scenes/main/states/tutorial.js","webpack:///./src/task/utilities/taskUtilities.js","webpack:///external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}","webpack:///external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}"],"names":["placePoints","points","length","stateManager","pointSpheres","get","redraw","tempPointSpheres","i","point","pointSphere","Mesh","CreateSphere","scene","position","Vector3","push","set","updatePoints","call","hidePointSpheres","visibility","hidePointSphere","index","Number","debugError","showPointSpheres","setLoaderValue","value","loader","setTextLoaderValue","textLoader","Text2D","parent","fontName","marginAlignment","fontSignedDistanceField","extend","margin","leftPixels","rightPixels","topPixels","bottomPixels","text","hideLoader","levelVisible","showLoader","guiCanvas","size","Size","border","Canvas2D","GetSolidColorBrush","Color4","borderThickness","opacity","setViewForDirection","direction","camera","activeCamera","xPos","setTarget","Zero","addButton","options","taskObject","Error","canvas","baseOptions","id","timeInMs","x","y","width","height","fill","clickEventData","baseOpacity","hoverOpacity","zOrder","padding","buttonOptions","roundRadius","children","marginVAlignment","marginHAlignment","buttonRect","Rectangle2D","pointerEventObservable","add","PrimitivePointerInfo","PointerOver","PointerOut","constructor","happenedAt","data","button","addEvent","PointerUp","setMargins","prim","showCross","crossSheet","cloneAssetIntoScene","R","hasAlpha","cross","Sprite2D","dispose","spriteSize","spriteLocation","Vector2","spriteFrame","hideCross","highlightPosition","promise","hightlight","type","explode","meshes","parameters","explosion","explosionTexture","mesh","particleSystem","ParticleSystem","particleTexture","emitter","minEmitBox","maxEmitBox","color1","color2","colorDead","minSize","maxSize","minLifeTime","maxLifeTime","emitRate","blendMode","BLENDMODE_ONEONE","gravity","direction1","direction2","minAngularSpeed","maxAngularSpeed","Math","PI","minEmitPower","maxEmitPower","updateSpeed","targetStopDuration","disposeOnStop","start","setBlackScreen","on","elements2D","getGlobal","has","blackScreen","checkIdleAndConnection","deferred","returnToState","dataManager","connection","shouldCheckTime","query","then","r","delay","lastInteraction","delayMin","goToState","states_end","currentStateKey","catch","states_idle","onNext","events_unfrozen","state","freeze","modal","title","lostConnectionTitle","content","lostConnectionContent","Promise","resolve","window","calibrator","defferedDomLoaded","document","addEventListener","scripts","getElementsByTagName","assetsFolderFullpath","src","delimiterIndices","indicesOf","substr","p1","p2","addFiles","loadingPromise","all","DEBUG_MODE_ON","mergeWith","level","registerSceneGenerator","sceneNames","rate","framePerPosition","numberOfPoints","maxObservationTime","fixationTime","ITI","trialsBeforePause","pauseTime","keptPoints","shouldRandomize","feedback","animation","animationStartTurn","angularVelocity","explosionTime","assetsToLoad","path","parametersNames","parametersConstraints","paramBox","bind","tempMaxNumberOfRetry","MAX_NUMBER_OF_RETRY","endpoint","loginForm","fields","userId","constraints","authorizedValues","password","format","callback","credentials","form","buttonText","context","states_active","authorize_manual_login","useLocalStorageCredentials","setConnection","signInForm","loggedIn","login","startTask","message","queryString","currentScene","e","loginError","en","open","close","require","MainScene","optionsBase","sceneKey","canvasBackground","backgroundRoundRadius","clearColor","canvasPercentWidth","canvasPercentHeight","mode","create3DScene","light0","HemisphericLight","diffuse","Color3","specular","groundColor","initialCamera","radius","alpha","beta","FreeCamera","Camera","ORTHOGRAPHIC_CAMERA","side","orthoTop","orthoBottom","orthoLeft","renderSize","orthoRight","onResize","register","cwDataFields","addTable","connections","surveyDataFields","eventFields","setGlobal","indexOnTransitionSequence","indexOnPredictionSequence","fullSequenceIndex","states","running","tutorial","tryout","tryoutFMRI","end","checkpoint","tutorialDone","levelDone","taskDone","taskEndNoComeback","flags","levelDefined","events","sequenceGenerated","nextTrial","goNextPosition","endObservation","startPrediction","responseTimeEnded","isiAfterLearningEnded","feedbackEnded","isiAfterFeedbackEnded","pauseTransition","forcePause","predictionStartBlackout","blackoutEnds","predictionEndsBlackout","isiAfterPredictionEndsBlackout","screenWentBlack","playPredictionSound","playObservationSound","showModal","goToTutorial","hasResponded","restartTutorial","goToLevel1","goToLevel2","goToLevel3","goToLevel4","tic","moreThanFiveNA","aknowledgedEnding","tutorialNext","addState","states_tutorial","states_running","states_tryout","tutorialState","runningState","tryoutState","endState","pauseState","pause","eventData","flags_levelDefined","belongsTo","handledAt","storedAt","active","addAwakeningFunctions","addEndingFunctions","addEventFunctions","events_goToTutorial","goToPause","shouldPause","Object","currentModal","modalBox","hide","states_pause","events_nextTrial","events_goNextPosition","events_endObservation","events_startPrediction","events_pauseTransition","events_forcePause","events_windowBlur","events_moreThanFiveNA","events_click","events_keydown","events_playPredictionSound","events_playObservationSound","events_tutorialNext","events_showModal","events_responseTimeEnded","events_restartTutorial","events_windowFocus","selectLevel","checkTaskDone","checkpoint_taskDone","checkTaskEndNoComeback","checkpoint_taskEndNoComeback","checkTutorialOne","checkpoint_tutorialDone","taskEnded","results","result","code","eventLevel","wolfFaceSprite","checkpoint_levelDone","startLevel","emptyTimeTriggerEvents","agent","cross_base","levels","sequenceObject","fullSequence","endActive","awakenEnd","initialGui","event","events_aknowledgedEnding","reason","taskFinishedTitle","taskFinishedContent","taskStoppedTitle","taskStoppedMessage","taskStoppedReason","replace","setCheckpoint","awakenPause","levelObject","GUI","threshold","thresholdIdle","hitKeyTime","initialGuiVisible","backgroundFill","lastPauseInfo","time","currentTimeLeft","timerText","timeLeft","parseInt","timeLimitText","t","delayInMs","centerText","endReasonIdle","prediction","play","topText","pauseText","pauseKeyDown","ceil","pauseRestart","hasFocus","previousTimeLeft","frozenState","endPause","prematureEndPauseAboveThreshold","stateUnfrozen","currentTrialData","hasPaused","trials","pausesDone","maxTransitionTime","resolveOnKey","except","shouldtic","text2d","transitionText","finishedLevelTransition","tooltipPause","box","centerPosition","scale","tooltip","duration","newEvent","startRunning","slice","lastHide","pausedBetween","map","o","numberOfMissed","isPredicting","nextTransitionTime","nextTransitionEvent","addTimeTriggerEvent","storeData","dataToStore","trial","dataIndex","choice","responseTime","startObservation","respondedAt","keysHits","clicks","correct","subject_id","data_index","observation_duration","subject_choice","response_time","key_hits","JSON","stringify","has_paused","start_observation","end_observation","responded_at","storeInErrorLog","timestamp","animationPoints","first","trialIndices","trialIndex","floor","concat","trialData","positions","currentIndex","stateKey","tutorials_getHarder","goToNextPosition","checkConnection","checkLastInteraction","pending","filter","indexOf","picked","random","splice","agent_predictionOpacity","cross_predict","sound","endResponse","predictionDuration","checkForClickPrediction","clientY","engineX","engineY","checkKeyStrokeForPrediction","keyCode","keyValue","key","keys","ArrowLeft","cross_bottomRight","ArrowRight","cross_topLeft","hasOwnProperty","keyPosition","playSound","sounds","name","awakeTryout","currentTutorial","range","trialType","block","blockType","tryoutGoToNextPosition","tutorials","hideTooltip","isWaitingToPredict","ntransition","askContinue","askfMRIContinue","lastChoice","endPrediction","nextPosition","observedTransitionWasDominant","dominant","block_type","dominant_structure","dominantStructure","dominant_transition_probability","dominantProbability","trial_type","observed_transition_was_dominant","transition_to","start_prediction","end_prediction","agentType","withKeys","tile","wolfFirstAppears","passed","wolfFirstAppears_title","wolfFirstAppears_message","rabbitFirstAppear","rabbitFirstAppear_title","rabbitFirstAppear_message","blackoutFirstAppear","blackoutFirstAppear_title","blackoutFirstAppear_message","wolfFmriFirstAppear","wolfFmriFirstAppear_title","wolfFmriFirstAppear_message","background","predictionTest","tilePosition","numberOfPrediction","realTimeTest_message","observationDuration","minISIAfterLearning","maxISIAfterLearning","observationTime","fixedISIAfterObservation","sampleMeanISIAfterObservation","maxSampleAfterObservation","events_screenWentBlack","blackoutTime","fixedBlackScreenDuration","sampleMeanBlackScreen","maxSampleBlackScreen","tryoutStartPrediction","predictionTest_message","hitAKeyToContinue","changeCenterSquare","choiceDeferred","chooseNextPosition","crossLockByPosition","fixedISIAfterPrediction","sampleMeanISIAfterPrediction","maxSampleAfterPrediction","tryoutCheckKeyStrokeForPrediction","m","d","c","cross_bottomLeft","k","cross_topRight","chosenKey","sign","subtract","youSelectedThisTile","aLittleSquareShowsYourChoice","events_hasResponded","tooEarly","tryoutEndPrediction","tryoutEnd","pageOrderTutorialOne","awakeTutorial","pageOrder","showIntro","page","tutorialUnfrozen","show","showNextPage","currentPage","showEvent","getAspectRatio","surfaceObject","Texture","getBaseSize","w","h","getDensity","elements","nsteps","windowSize","some","isNaN","min","max","stepSize","elementsInWindow","windowPosition","density","subset","centered","windows","numberOfElements","chartOptions","datasets","label","scales","xAxes","randomColor","round","computeDurationEstimate","parametersBase","minNumberOfObservationsPerLearning","maxNumberOfObservationsPerLearning","interObservationDuration","minTimeToPredict","maxTimeToPredict","feedbackDuration","minISIAfterFeedback","maxISIAfterFeedback","rabbitAutoTransition","rabbitDominantProbability","observationSegmentSizes","observationSegmentRepetitionPerBlock","numberOfBlocks","numberOfRandomBlocks","feedbackType","numberOfObservationPerLevel","sum","oneObservationDuration","observationsDurationPerBlock","numberOfPredictionEventsPerBlock","timeDurationMatrix","matrix","factorMatrix","predictionDurationMatrix","multiply","sumPredictionDurationVector","predictionsDurationPerBlock","observationDurationMatrix","durationPerBlock","totalDuration","toArray","mean"],"mappings":"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EnK,mBAAagB,IAAb,CAAkB,wBAAlB,EAA4C,EAAE8I,eAAe,QAAjB,EAA5C;AAA0E,KAD9G;AAED,GA3FD;;AA6FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAOD,SAAS7C,OAAhB;AACD,CArOD;;AAuOA,IAAMiS,aAAa,SAAbA,UAAa,GAA0B;AAAA,MAAhBpV,OAAgB,uEAAN,IAAM;;AAC3C,MAAI,OAAO,KAAKC,UAAZ,KAA2B,WAA/B,EAA4C;AAC1C,UAAM,IAAIC,KAAJ,CAAU,gDAAV,CAAN;AACD;;AAED,MAAI,OAAOF,QAAQ+B,IAAR,CAAa+G,KAApB,KAA8B,WAAlC,EAA+C;AAC7C,UAAM,IAAI5I,KAAJ,CAAU,8CAAV,CAAN;AACD;;AAED;AACA,MAAMD,aAAa,KAAKA,UAAxB;AACA,MAAM9D,eAAe,KAAKA,YAA1B;AACA,MAAMqG,IAAI,KAAKA,CAAf;AACA,MAAMmD,aAAaxJ,aAAaE,GAAb,CAAiB,YAAjB,CAAnB;AACAF,eAAakZ,sBAAb;AACA1P,aAAW2P,KAAX,CAAiB/V,OAAjB,GAA2B,CAA3B;AACAoG,aAAWjD,KAAX,CAAiBM,WAAjB,GAA+BR,EAAEnG,GAAF,CAAMkZ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","file":"walker.max.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"experiment-js\"), require(\"experiment-babylon-js\"), require(\"lodash\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jQuery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"walker\", [\"experiment-js\", \"experiment-babylon-js\", \"lodash\", \"experiment-boxes\", \"experiment-mathjs\", \"jQuery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"walker\"] = factory(require(\"experiment-js\"), require(\"experiment-babylon-js\"), require(\"lodash\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jQuery\"));\n\telse\n\t\troot[\"walker\"] = factory(root[\"experiment\"], root[\"BABYLON\"], root[\"_\"], root[\"experimentBoxes\"], root[\"math\"], root[\"jQuery\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_16__, __WEBPACK_EXTERNAL_MODULE_17__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 06f843adebfb6f7b9931","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-js\",\"commonjs2\":\"experiment-js\",\"amd\":\"experiment-js\",\"root\":\"experiment\"}\n// module id = 0\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}\n// module id = 2\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}\n// module id = 3\n// module chunks = 0","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array,\n  String, // eslint-disable-line\n  Deferred,\n  debugWarn,\n  hasConstructor,\n  delay,\n  Loader,\n} from 'experiment-js'\n\nconst placePoints = function (points = []) {\n  if (points.length === 0) return\n\n  const stateManager = this.stateManager\n\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  let redraw = false\n  if (points.length !== pointSpheres.length) {\n    redraw = true\n  }\n\n  const tempPointSpheres = []\n  for (let i = 0; i < points.length; i++) {\n    const point = points[i]\n\n    if (hasConstructor(Array, point)) {\n      let pointSphere\n      if (redraw || pointSpheres.length < i) {\n          // draw a sphere at point and store it in the array\n        pointSphere = BABYLON.Mesh.CreateSphere(`sphere${i}`, 32, 0.5, this.scene)\n      } else {\n        pointSphere = pointSpheres[i]\n      }\n\n      pointSphere.position = new BABYLON.Vector3(...point)\n\n      tempPointSpheres.push(pointSphere)\n    }\n  }\n  // set the data into the stateManager\n  stateManager.set('pointSpheres', tempPointSpheres)\n}\n\nconst updatePoints = function (points) {\n  if (points.length === 0) return\n\n  const stateManager = this.stateManager\n\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  if (pointSpheres.length !== points.length) {\n    stateManager.call('placePoints', points)\n  } else {\n    for (let i = 0; i < pointSpheres.length; i++) {\n      const point = points[i]\n      if (hasConstructor(Array, point)) {\n        pointSpheres[i].position = new BABYLON.Vector3(...point)\n      }\n    }\n  }\n}\n\nconst hidePointSpheres = function () {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  for (const pointSphere of pointSpheres) {\n    if (hasConstructor(BABYLON.Mesh, pointSphere)) {\n      pointSphere.visibility = false\n    }\n  }\n}\n\nconst hidePointSphere = function ({ index }) {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  if (hasConstructor(Array, pointSpheres) &&\n      hasConstructor(Number, index) &&\n      (index < pointSpheres.length) &&\n      hasConstructor(BABYLON.Mesh, pointSpheres[index])) {\n    pointSpheres[index].visibility = false\n  } else {\n    debugError('hidePointSphere: invalid arguments.', pointSpheres, index)\n  }\n}\n\nconst showPointSpheres = function () {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  for (const pointSphere of pointSpheres) {\n    if (hasConstructor(BABYLON.Mesh, pointSphere)) {\n      pointSphere.visibility = true\n    }\n  }\n}\n\nconst setLoaderValue = function (value = 0) {\n  const loader = this.stateManager.get('loader', null)\n\n  if (loader === null) {\n    this.stateManager.call('showLoader', value)\n  } else {\n    loader.value = value\n  }\n}\n\nconst setTextLoaderValue = function (value = '0') {\n  let textLoader = this.stateManager.get('textLoader', null)\n\n  if (textLoader === null) {\n    textLoader = new BABYLON.Text2D(String(value), {\n      parent: this.stateManager.get('GUI'),\n      fontName: '20px Arial',\n      marginAlignment: 'v: bottom, h: center',\n      fontSignedDistanceField: true,\n    })\n    _.extend(textLoader.margin, { leftPixels: 0, rightPixels: 0, topPixels: 0, bottomPixels: 51 })\n\n    this.stateManager.set('textLoader', textLoader)\n  } else {\n    textLoader.text = String(value)\n  }\n}\n\nconst hideLoader = function () {\n  const textLoader = this.stateManager.get('textLoader', null)\n  if (textLoader !== null) { textLoader.levelVisible = false }\n  const loader = this.stateManager.get('loader', null)\n  if (textLoader !== null) { loader.levelVisible = false }\n}\n\nconst showLoader = function (value = 0) {\n  const guiCanvas = this.stateManager.get('GUI')\n  let loader = this.stateManager.get('loader', null)\n  if (loader !== null) {\n    loader.levelVisible = true\n  } else {\n    loader = new Loader({ parent: guiCanvas,\n      size: new BABYLON.Size(69, 23),\n      border: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.7, 0.7, 0.7, 1)),\n      marginAlignment: 'v:bottom, h:center',\n      borderThickness: 1 })\n    loader.value = value\n    loader.opacity = 1\n    _.extend(loader.margin, { leftPixels: 0.5, rightPixels: 0, topPixels: 0, bottomPixels: 53 })\n\n    this.stateManager.set('loader', loader)\n  }\n\n  const textLoader = this.stateManager.get('textLoader', null)\n  if (textLoader !== null) {\n    textLoader.levelVisible = true\n  } else {\n    this.stateManager.call('setLoaderValue', value)\n  }\n}\n\nconst setViewForDirection = function ({ direction = null }) {\n  const scene = this.scene\n  const camera = scene.activeCamera\n\n  if (direction === null) {\n    return 'GlobalFunctions.setViewForDirection: direction is null'\n  }\n\n  const xPos = (direction === 'LEFT') ? -50 : 50\n  camera.position = new BABYLON.Vector3(xPos, 0, 0)\n  camera.setTarget(new BABYLON.Vector3.Zero())\n  return 'View changed'\n}\n\nconst addButton = function (options = null) {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('stateManager.addButton: this.taskObject is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const canvas = stateManager.get('elements2D').canvas\n\n  const baseOptions = {\n    id: `button${stateManager.timeInMs}`,\n    text: 'text',\n    x: 50,\n    y: 50,\n    width: 100,\n    height: 50,\n    fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.8, 0.8, 0.8, 1)),\n    clickEventData: null,\n    fontName: '30pt Arial',\n    baseOpacity: 0.8,\n    hoverOpacity: 1,\n    zOrder: -0.5,\n    marginAlignment: null,\n    fontSignedDistanceField: true,\n    margin: {},\n    padding: {},\n    parent: canvas,\n  }\n\n  baseOptions.margin.leftPixels = 0\n  baseOptions.margin.rightPixels = 0\n  baseOptions.margin.topPixels = 0\n  baseOptions.margin.bottomPixels = 0\n  baseOptions.padding.leftPixels = 0\n  baseOptions.padding.rightPixels = 0\n  baseOptions.padding.topPixels = 0\n  baseOptions.padding.bottomPixels = 0\n  baseOptions.margin = _.extend(baseOptions.margin, options.margin)\n  baseOptions.padding = _.extend(baseOptions.padding, options.padding)\n  options.margin = baseOptions.margin\n  options.padding = baseOptions.padding\n\n  // extend options\n  options = _.extend(baseOptions, options)\n\n  let buttonOptions = {}\n  let margin = {}\n  let padding = {}\n  if (options.marginAlignment === null) {\n    buttonOptions = {\n      parent: options.parent,\n      id: options.id,\n      x: options.x,\n      y: options.y,\n      width: options.width,\n      height: options.height,\n      fill: options.fill,\n      zOrder: options.zOrder,\n      roundRadius: 0,\n      children: [new BABYLON.Text2D(options.text, {\n        fontName: options.fontName,\n        marginVAlignment: 'v: center',\n        fontSignedDistanceField: options.fontSignedDistanceField,\n        marginHAlignment: 3,\n      })],\n    }\n  } else {\n    buttonOptions = {\n      parent: options.parent,\n      id: options.id,\n      width: options.width,\n      height: options.height,\n      fill: options.fill,\n      zOrder: options.zOrder,\n      marginAlignment: options.marginAlignment,\n      roundRadius: 0,\n      children: [new BABYLON.Text2D(options.text, {\n        fontName: options.fontName,\n        marginVAlignment: 'v: center',\n        fontSignedDistanceField: options.fontSignedDistanceField,\n        marginHAlignment: 3,\n      })],\n    }\n    margin = options.margin\n    padding = options.padding\n  }\n\n  // create button and add to canvas\n  const buttonRect = new BABYLON.Rectangle2D(buttonOptions)\n\n  buttonRect.opacity = options.baseOpacity\n\n  if (margin !== null) {\n    buttonRect.margin.rightPixels = options.margin.rightPixels // TODO make that a specific function in the framework\n    buttonRect.margin.leftPixels = options.margin.leftPixels\n    buttonRect.margin.topPixels = options.margin.topPixels\n    buttonRect.margin.bottomPixels = options.margin.bottomPixels\n  }\n\n  if (padding !== null) {\n    buttonRect.padding.rightPixels = padding.rightPixels\n    buttonRect.padding.leftPixels = padding.leftPixels\n    buttonRect.padding.topPixels = padding.topPixels\n    buttonRect.padding.bottomPixels = padding.bottomPixels\n  }\n\n  // Add an observable for hovering\n  buttonRect.pointerEventObservable.add(() => {\n    buttonRect.opacity = options.hoverOpacity\n  }, BABYLON.PrimitivePointerInfo.PointerOver)\n\n  buttonRect.pointerEventObservable.add(() => {\n    buttonRect.opacity = options.baseOpacity\n  }, BABYLON.PrimitivePointerInfo.PointerOut)\n\n  // Add an observable for clicking\n  if ((options.clickEventData !== null) && (options.clickEventData.constructor === EventData)) {\n    buttonRect.pointerEventObservable.add(() => {\n      options.clickEventData.happenedAt = stateManager.timeInMs\n      options.clickEventData.data.button = buttonRect.id\n\n      stateManager.addEvent(options.clickEventData)\n    }, BABYLON.PrimitivePointerInfo.PointerUp)\n  }\n\n  return (buttonRect)\n}\n\nconst setMargins = function (prim, margin) {\n  prim.margin.rightPixels = margin.rightPixels // TODO make that a specific function in the framework\n  prim.margin.leftPixels = margin.leftPixels\n  prim.margin.topPixels = margin.topPixels\n  prim.margin.bottomPixels = margin.bottomPixels\n}\n\nconst showCross = function () {\n  const crossSheet = this.taskObject.cloneAssetIntoScene(this.R.get.crossSheet, this.scene)\n  crossSheet.hasAlpha = true\n\n  const guiCanvas = this.stateManager.get('GUI')\n\n\n  let cross = this.stateManager.get('cross', null)\n  if (hasConstructor(BABYLON.Sprite2D, cross)) {\n    cross.dispose()\n  }\n\n  cross = new BABYLON.Sprite2D(crossSheet, {\n    parent: guiCanvas,\n    id: 'cross',\n    marginAlignment: 'v: center, h: center',\n    spriteSize: new BABYLON.Size(20, 20),\n    spriteLocation: new BABYLON.Vector2(0, 0),\n  })\n\n  cross.spriteFrame = 0\n  cross.levelVisible = true\n\n  this.stateManager.set('cross', cross)\n}\n\nconst hideCross = function () {\n  const cross = this.stateManager.get('cross', null)\n\n  if (cross !== null) {\n    cross.levelVisible = false\n  }\n}\n\nconst highlightPosition = function (options = null) {\n  if (typeof this.stateManager === 'undefined') {\n    throw new Error('stateManager.highlightPosition: this.stateManager is undefined')\n  }\n\n  if (typeof options.position === 'undefined') {\n    throw new Error('stateManager.highlightPosition: options.position is undefined')\n  }\n\n  return (this.stateManager.promise('drawTiles', {\n    hightlight: options.position,\n    type: (typeof options.type !== 'undefined') ?\n      options.type : 'prediction',\n  }))\n}\n\nconst explode = function ({ meshes = null }) {\n  if (meshes === null) {\n    return 'No mesh given'\n  }\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters.explosion\n\n  const explosionTexture = this.taskObject.cloneAssetIntoScene(this.R.get.explosionTexture, this.scene)\n  explosionTexture.hasAlpha = true\n\n  for (const mesh of meshes) {\n    const particleSystem = new BABYLON.ParticleSystem('particles', 1000, this.scene)\n    particleSystem.particleTexture = explosionTexture\n    particleSystem.emitter = mesh\n    particleSystem.minEmitBox = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.maxEmitBox = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 0.8)\n    particleSystem.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 0.7)\n    particleSystem.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0)\n    particleSystem.minSize = parameters.minSize\n    particleSystem.maxSize = parameters.maxSize\n    particleSystem.minLifeTime = parameters.minLifeTime\n    particleSystem.maxLifeTime = parameters.maxLifeTime\n    particleSystem.emitRate = parameters.emitRate\n    particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE\n    particleSystem.gravity = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.direction1 = new BABYLON.Vector3(-5, 5, 5)\n    particleSystem.direction2 = new BABYLON.Vector3(5, -5, -5)\n    particleSystem.minAngularSpeed = 0\n    particleSystem.maxAngularSpeed = Math.PI\n    particleSystem.minEmitPower = parameters.minEmitPower\n    particleSystem.maxEmitPower = parameters.maxEmitPower\n    particleSystem.updateSpeed = 0.025\n\n    particleSystem.targetStopDuration = 0.5\n    particleSystem.disposeOnStop = true\n\n    particleSystem.start()\n  }\n\n  return 'Exploded'\n}\n\nconst setBlackScreen = function (options = null) {\n  const baseOptions = { // TODO create a defaultOptions()\n    on: true,\n  }\n\n  options = _.extend(baseOptions, options)\n  const elements2D = this.stateManager.getGlobal('elements2D')\n  const canvas = elements2D.canvas\n\n  if (!_.has(elements2D, 'blackScreen')) {\n    const blackScreen = new BABYLON.Rectangle2D({\n      parent: canvas,\n      id: 'blackScreen',\n      position: new BABYLON.Vector2(0, 0),\n      width: canvas.size.width,\n      height: canvas.size.height,\n      zOrder: 0,\n    })\n\n    elements2D.blackScreen = blackScreen\n  }\n\n  if (options.on) {\n    elements2D.blackScreen.opacity = 1\n  } else {\n    elements2D.blackScreen.opacity = 0\n  }\n}\n\nconst checkIdleAndConnection = function ({ deferred = new Deferred(), returnToState = null } = { deferred: new Deferred(), returnToState: null }) {\n  const stateManager = this.stateManager\n  const R = this.R\n  const dataManager = this.dataManager\n  const connection = this.connection\n\n  const shouldCheckTime = stateManager.get('shouldCheckTime', false)\n\n  if (shouldCheckTime) {\n    return dataManager.query('getLastInteraction', null, connection, deferred).then((r) => {\n      const delay = stateManager.timeInMs - r.lastInteraction\n      const delayMin = delay / (60000)\n      if (delay > 20 * 60 * 1000) {\n        debugWarn('running.goToNextPosition: idle for too long')\n        stateManager.set('endReason', `You were idle for more than 20 min: ${delayMin} min`)\n        stateManager.goToState(R.get.states_end)\n      } else if ((returnToState !== null) && (stateManager.currentStateKey !== returnToState)) { stateManager.goToState(returnToState) }\n    })\n    .catch(() => {\n      debugWarn('running.goToNextPosition: lost connection')\n      returnToState = returnToState || stateManager.currentStateKey\n\n      if (stateManager.currentStateKey !== R.get.states_idle) {\n        stateManager.call('hideAll')\n        stateManager.onNext(this.R.get.events_unfrozen, () => { stateManager.call('showAll') })\n        this.state.freeze()\n        stateManager.goToState(R.get.states_idle)\n      }\n\n      this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n      .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState }) })\n    })\n  }\n  return Promise.resolve()\n}\n\nexport {\n  addButton,\n  highlightPosition,\n  setMargins,\n  setBlackScreen,\n  checkIdleAndConnection,\n  placePoints,\n  updatePoints,\n  showPointSpheres,\n  hidePointSpheres,\n  setViewForDirection,\n  showCross,\n  hideCross,\n  explode,\n  setLoaderValue,\n  hideLoader,\n  showLoader,\n  setTextLoaderValue,\n  hidePointSphere,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/functions/globalFunctions.js","/**\n * startUp.js\n *\n * This file holds the code that should run on your HTML page after all the framework and page is loaded.\n *\n * Here you should :\n * - create the taskObject\n * - set up the parameters of the task\n * - register loading promise\n * - register the scenes generators\n * - start the task\n * - bind the task paramBox with relevant parameters\n *\n * Do not pollute the global space with too much variables.\n * Here two global variables are created : taskObject and calibrator.\n */\nimport $ from 'jquery'\nimport _ from 'lodash'\nimport { RessourceManager, TaskObject, Deferred, debuglog, debugError } from 'experiment-js'\nimport { SmartForm } from 'experiment-boxes'\n\nimport { DEBUG_MODE_ON } from '../../config'\n\n// import LoadingScene from './scenes/LoadingScene' Using default loading\nimport MainScene from '../scenes/main/MainScene'\n\nwindow.taskObject = null\nwindow.calibrator = null\n\n\n// When page is loaded, initiate the task\nconst defferedDomLoaded = new Deferred()\ndocument.addEventListener('DOMContentLoaded', () => {\n  defferedDomLoaded.resolve()\n})\n\nif (typeof window !== 'undefined') {\n  /* === Get the absolute path of the library === */\n  const scripts = document.getElementsByTagName('script')\n  if (scripts.length) {\n    const assetsFolderFullpath = scripts[scripts.length - 1].src\n    const delimiterIndices = assetsFolderFullpath.indicesOf('/')\n    window.assetsFolderFullpath = assetsFolderFullpath.substr(0, delimiterIndices[delimiterIndices.length - 2])\n  } else {\n    window.assetsFolderFullpath = './'\n  }\n}\n\nconst R = new RessourceManager()\nwindow.p1 = defferedDomLoaded.promise\nwindow.p2 = R.addFiles(`${window.assetsFolderFullpath}/assets/yaml/ressources.yaml`, `${window.assetsFolderFullpath}/assets/json/randomized_trials_final_pure_impure_with_training.json`)\n\nwindow.loadingPromise = Promise.all([window.p1, window.p2])\n\n\nwindow.loadingPromise.then(() => {\n  window.DEBUG_MODE_ON = DEBUG_MODE_ON\n\n  const taskObject = new TaskObject($('.task-canvas'))\n  taskObject.R.mergeWith(R)\n\n  /* --- Register scene generators --- */\n  const options = {\n    level: null,\n  }\n\n  taskObject.registerSceneGenerator(MainScene, options)\n\n  const sceneNames = ['loading', 'main']\n\n  taskObject.R.add({\n    parameters: {\n      rate: 60, // frame rate in hertz\n      framePerPosition: 1,\n      numberOfPoints: 5,\n      maxObservationTime: 5000,\n      fixationTime: 500,\n      ITI: 500,\n      trialsBeforePause: 200,\n      pauseTime: 10 * 60 * 1000,\n      keptPoints: [8, 10, 11, 13, 14],\n      shouldRandomize: 'no',\n      feedback: 'no',\n      animation: 'no',\n      animationStartTurn: 30,\n      angularVelocity: Math.PI / 180,\n      explosion: {\n        explosionTime: 500,\n        minSize: 0.2,\n        maxSize: 1.3,\n        minLifeTime: 0.150,\n        maxLifeTime: 0.150,\n        emitRate: 30,\n        minEmitPower: 1,\n        maxEmitPower: 2 },\n    },\n  })\n\n\n  /* --- Register loading scene generator --- */\n// taskObject.registerLoadingFunction(LoadingScene)\n  taskObject.assetsToLoad = {\n    crossSheet: {\n      path: '/assets/sprites/cross/squareSheetMargin.svg',\n      type: 'texture',\n    },\n    explosionTexture: {\n      path: '/assets/sprites/explosion/particle_explosion.png',\n      type: 'texture',\n    },\n  }\n\n  /* list of tweakable variables from the paramBox */\n\n  const parametersNames = [\n    'parameters.rate',\n    'parameters.framePerPosition',\n    'parameters.numberOfPoints',\n    'parameters.maxObservationTime',\n    'parameters.fixationTime',\n    'parameters.ITI',\n    'parameters.trialsBeforePause',\n    'parameters.pauseTime',\n    'parameters.shouldRandomize',\n    'parameters.feedback',\n    'parameters.explosion.explosionTime',\n    'parameters.explosion.minSize',\n    'parameters.explosion.maxSize',\n    'parameters.explosion.minLifeTime',\n    'parameters.explosion.maxLifeTime',\n    'parameters.explosion.emitRate',\n    'parameters.explosion.minEmitPower',\n    'parameters.explosion.maxEmitPower',\n  ]\n\n  const parametersConstraints = {\n    'parameters.feedback': ['yes', 'no'],\n    'parameters.shouldRandomize': ['yes', 'no'],\n  }\n\n  // const parametersConstraints = {}\n\n  // const rParams = ['agent.scale', 'agent.predictionOpacity', 'tile.scale', 'tile.offset', 'cross.opacity']\n\n\n  // taskObject.paramBox.bind(taskObject, parametersNames, parametersConstraints)\n  taskObject.paramBox.bind(taskObject.R.data, parametersNames, parametersConstraints)\n\n\n  /* --- Login --- */\n  window.taskObject = taskObject\n  const tempMaxNumberOfRetry = taskObject.dataManager.MAX_NUMBER_OF_RETRY\n  const endpoint = `${window.assetsFolderFullpath}/api/php/mysql/index.php`\n\n  /**\n   * This function in a form generator that is called automatically by the DataManager when the user needs to login\n   * @method loginForm\n   * @return {SmartForm}  a SmartForm\n   */\n  function loginForm() {\n    const fields = {\n      userId: {\n        type: 'input',\n        constraints: 'length:3,300', // list of constraints that will be automatically verified: mandatory; alpha; numeric; length:XX; contains:a,b,@,.;\n        authorizedValues: null, // athorized values\n        parent: null,\n        title: 'Choose an username:',\n      },\n      password: {\n        type: 'password', // field type: input, select, textaera, slider, radio, password\n        constraints: 'length:3,300; score: 20', // list of constraints that will be automatically verified: mandatory; alpha; numeric; length:XX; contains:a,b,@,.;\n        authorizedValues: null, // athorized values\n        parent: null,\n        title: 'Choose a password:', // you can control auto-create account in the php api config\n      },\n    }\n    const options = { fields, title: 'Create a login', format: 'topCentralSmall', callback(fields) { debuglog({ endpoint, credentials: { userId: fields.userId.value, password: fields.password.value } }) } }\n    const form = new SmartForm(options)\n    form.buttonText = 'OK'\n\n    const R = taskObject.context.R\n    const stateManager = taskObject.context.stateManager\n\n    if (stateManager) {\n      stateManager.goToState(R.get.states_active)\n    }\n\n    return form\n  }\n\n  taskObject.dataManager.authorize_manual_login = true\n  taskObject.dataManager.useLocalStorageCredentials = false\n\n  //  If you do not want to store the credentials for the connections localy set this variable to false (the password is not stored in any case, only a logging key)\n  // taskObject.dataManager.useLocalStorageCredentials = false\n  taskObject.setConnection({ endpoint, signInForm: loginForm }) // credentials: { userId: 'John', password: 'wrong' } })\n  .then((connection) => {\n    if (connection.loggedIn) {\n      return true\n    }\n    return taskObject.dataManager.login(connection)\n  })\n  .then(() => {\n    // reset the retry limit to its original value\n    taskObject.dataManager.MAX_NUMBER_OF_RETRY = tempMaxNumberOfRetry\n\n    /* --- Start task --- */\n    return taskObject.startTask()\n  })\n  .then((message) => {\n    debuglog(message)\n    // taskObject.paramBox.bind(taskObject, 'currentScene', parametersConstraints)\n    if ((sceneNames.length === 1) || (typeof taskObject.paramBox.queryString.currentScene === 'undefined')) {\n      taskObject.currentScene = 'main'\n    }\n  })\n  .catch((e) => {\n    debugError(e)\n    taskObject.modal({ type: 'centralLarge', title: R.get.loginError.title.en, content: R.get.loginError.content.en })\n    .then(() => {\n      window.open('', '_self').close()\n    })\n  })\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/startup/startup.js","/**\n * Experiment.js\n * Created. 2016\n *\n * Experiment.js toolbox.\n *\n * Authors. Albert Buchard\n *\n * Requires: lodash, BABYLON.js, mathjs, jQuery\n *\n * LICENSE Apache-2\n */\n\n if (typeof window !== 'undefined') {\n   require('./src/task/startup/startup')\n }\n\n\n\n// WEBPACK FOOTER //\n// ./builder.js","const DEBUG_MODE_ON = false\n\nexport { DEBUG_MODE_ON }\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  debugError,\n  hasConstructor,\n} from 'experiment-js'\n\nimport { SmartModal } from 'experiment-boxes'\n\nimport {\n  addButton,\n  highlightPosition,\n  setBlackScreen,\n  checkIdleAndConnection,\n  placePoints,\n  updatePoints,\n  showPointSpheres,\n  hidePointSpheres,\n  setViewForDirection,\n  showCross,\n  hideCross,\n  explode,\n  setLoaderValue,\n  hideLoader,\n  showLoader,\n  setTextLoaderValue,\n  hidePointSphere } from './functions/globalFunctions'\n\n\nimport { selectLevel, startLevel, endActive } from './states/active'\n\nimport { showNextPage, showModal, awakeTutorial, tutorialUnfrozen } from './states/tutorial'\n\nimport {\n  awakeTryout,\n  tryoutEndPrediction,\n  tryoutCheckKeyStrokeForPrediction,\n  tryoutGoToNextPosition,\n  tryoutStartPrediction,\n  tryoutEnd,\n} from './states/tryout'\n\nimport {\n  stateUnfrozen,\n  startRunning,\n  nextTrial,\n  goToNextPosition,\n  startPrediction,\n  checkForClickPrediction,\n  checkKeyStrokeForPrediction,\n  playSound,\n  endObservation,\n  pauseTransition,\n} from './states/running'\n\nimport { awakenPause, endPause, pauseKeyDown } from './states/pause'\n\nimport { awakenEnd } from './states/end'\n\n/* =============== Main scene =============== */\nexport default function MainScene(options = {}) {\n  // option base\n  const optionsBase = {\n    sceneKey: 'main',\n    canvasBackground: new BABYLON.Color4(0, 0, 0, 1),\n    backgroundRoundRadius: 0,\n    clearColor: new BABYLON.Color4(0, 0, 0, 1),\n    canvasPercentWidth: 1,\n    canvasPercentHeight: 1,\n    mode: 'central',\n    level: null,\n  }\n\n  options = _.extend(optionsBase, options)\n\n  /* --- Get taskObject from context --- */\n  const taskObject = this.taskObject\n\n  /* --- Create a basic 3D scene--- */\n  const scene = taskObject.create3DScene(options)\n\n  /* --- Add a strong ambient light --- */\n  const light0 = new BABYLON.HemisphericLight('Hemi0', new BABYLON.Vector3(0, 1, 0), scene)\n  light0.diffuse = new BABYLON.Color3(1, 1, 1)\n  light0.specular = new BABYLON.Color3(1, 1, 1)\n  light0.groundColor = new BABYLON.Color3(1, 1, 1)\n\n  /* --- Get stateManager --- */\n  const stateManager = scene.stateManager\n\n  const R = taskObject.R\n\n  /* --- Get canvas --- */\n  if (R.get.parameters.animation === 'yes') {\n    // const canvas = scene.initialCanvas\n\n    const camera = scene.initialCamera\n    // // camera.detachControl(taskObject.canvas)\n    camera.radius = 50\n    camera.alpha = 0\n    camera.beta = Math.PI / 2\n\n    // camera.attachControl(taskObject.canvas)\n  } else {\n    const camera = new BABYLON.FreeCamera('OrthoCamera', new BABYLON.Vector3(-50, 0, 0), scene)\n    camera.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA\n\n    const side = 17\n    camera.orthoTop = side\n    camera.orthoBottom = -side\n    camera.orthoLeft = -side * taskObject.renderSize.width / taskObject.renderSize.height\n    camera.orthoRight = side * taskObject.renderSize.width / taskObject.renderSize.height\n      //\n      //   // This targets the camera to scene origin\n    camera.setTarget(new BABYLON.Vector3.Zero())\n      //\n    scene.activeCamera = camera\n  }\n\n\n  // camera.setPosition(new BABYLON.Vector3(50, 0, 0))\n\n  // const box = BABYLON.Mesh.CreateBox('', 1, scene)\n\n  /* --- Load assets --- */\n\n  scene.onResize = []\n\n  stateManager.register(\n    addButton,\n    highlightPosition,\n    setBlackScreen,\n    checkIdleAndConnection,\n    updatePoints,\n    placePoints,\n    hidePointSpheres,\n    showPointSpheres,\n    setViewForDirection,\n    showCross,\n    hideCross,\n    explode,\n    setLoaderValue,\n    hideLoader,\n    showLoader,\n    setTextLoaderValue,\n    hidePointSphere)\n\n  stateManager.call('redrawAssets')\n\n  /* --- Setup data --- */\n  const dataManager = this.dataManager\n\n  /* --- Add cwData table that will hold a summary of the data --- */\n  const cwDataFields = [\n    'subject_id',\n    'trial',\n    'data_index',\n    'direction',\n    'position',\n    'observation_duration',\n    'subject_choice', // NA for NOGO\n    'correct',\n    'feedback',\n    'response_time', // NA for NOGO or no response\n    'key_hits', // ['key', 'time'], [k,t], ...\n    'clicks',\n    'has_paused',\n    'start_observation',\n    'end_observation',\n    'responded_at',\n  ]\n\n  dataManager.addTable('walkerData', cwDataFields)\n  dataManager.addTable('tryoutData', cwDataFields)\n\n  let userId = `unknown${this.timeInMs}`\n  try {\n    userId = dataManager.connections[0].credentials.userId\n  } catch (e) {\n    debugError(e)\n  }\n\n  stateManager.set('subject_id', userId)\n\n  /* --- Add the surveyData table --- */\n  const surveyDataFields = [\n    'level',\n    'similarTask',\n    'taskDifficulty',\n    'movementWolf',\n    'boredom',\n    'dependance',\n    'repeatsSequence',\n    'comments',\n  ]\n\n  dataManager.addTable('surveyData', surveyDataFields)\n\n  /* --- Add the logs for each level --- */\n  const eventFields = ['id', 'flag', 'happenedAt', 'handledAt', 'data']\n  dataManager.addTable('stateRunningEvents', eventFields)\n  dataManager.addTable('stateActiveEvents', eventFields)\n\n  /* --- Store scene level inside the stateManager --- */\n  stateManager.setGlobal('positionData', {\n    indexOnTransitionSequence: -1,\n    indexOnPredictionSequence: -1,\n    fullSequenceIndex: -1,\n  })\n\n  stateManager.setGlobal('hasSeenLearningInfo', false)\n  stateManager.setGlobal('hasSeenPredictionInfo', false)\n\n  /* --- Setup states --- */\n\n  /* --- Set state key and store them in the stateManager --- */\n  R.add({\n    states: {\n      running: 'running',\n      tutorial: 'tutorial',\n      tryout: 'tryout',\n      tryoutFMRI: 'tryoutFMRI',\n      end: 'end',\n    },\n    checkpoint: {\n      tutorialDone: ['tutorialOneDone', 'tutorialTwoDone'],\n      levelDone: ['levelOneDone', 'levelTwoDone', 'levelThreeDone', 'levelFourDone'],\n      taskDone: 'taskDone',\n      taskEndNoComeback: 'taskEndNoComeback',\n    },\n    flags: {\n      levelDefined: 'levelDefined',\n    },\n    events: {\n      sequenceGenerated: 'sequenceGenerated',\n      nextTrial: 'nextTrial',\n      goNextPosition: 'goNextPosition',\n      endObservation: 'endObservation',\n      startPrediction: 'startPrediction',\n      responseTimeEnded: 'responseTimeEnded',\n      isiAfterLearningEnded: 'isiAfterLearningEnded',\n      feedbackEnded: 'feedbackEnded',\n      isiAfterFeedbackEnded: 'isiAfterFeedbackEnded',\n      pauseTransition: 'pauseTransition',\n      forcePause: 'forcePause',\n      predictionStartBlackout: 'predictionStartBlackout',\n      blackoutEnds: 'blackoutEnds',\n      predictionEndsBlackout: 'predictionEndsBlackout',\n      isiAfterPredictionEndsBlackout: 'isiAfterPredictionEndsBlackout',\n      screenWentBlack: 'screenWentBlack',\n      playPredictionSound: 'playPredictionSound',\n      playObservationSound: 'playObservationSound',\n      showModal: 'showModal',\n      goToTutorial: 'goToTutorial',\n      hasResponded: 'hasResponded',\n      restartTutorial: 'restartTutorial',\n      goToLevel1: 'goToLevel1',\n      goToLevel2: 'goToLevel2',\n      goToLevel3: 'goToLevel3',\n      goToLevel4: 'goToLevel4',\n      tic: 'tic',\n      moreThanFiveNA: 'moreThanFiveNA',\n      aknowledgedEnding: 'aknowledgedEnding',\n      tutorialNext: 'tutorialNext',\n    },\n  })\n\n  // eslint-disable-next-line\n  const [tutorialState, runningState, tryoutState, endState] = stateManager.addState(R.get.states_tutorial, R.get.states_running, R.get.states_tryout, R.get.states_end)\n  const pauseState = stateManager.states.pause\n\n  /* ======== State Active ======== */\n  if (options.level !== null) {\n    const eventData = new EventData(R.get.flags_levelDefined, scene.stateManager.timeInMs, {\n      belongsTo: [\n        'globalLog', 'stateActiveEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n      level: options.level,\n    })\n    stateManager.addEvent(eventData)\n  } else {\n    stateManager.states.active.addAwakeningFunctions(selectLevel)\n  }\n\n  stateManager.states.active.addEndingFunctions(endActive)\n\n  stateManager.states.active.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  stateManager.states.active.addEventFunctions(R.get.events_goToTutorial,\n    ({ data: { tutorial } }) => {\n      stateManager.setGlobal('currentTutorial', tutorial)\n      stateManager.goToState(R.get.states_tutorial)\n    })\n\n  /* ======== State RUNNING ======== */\n  const goToPause = function () {\n    if (this.state.shouldPause) {\n      this.state.freeze()\n      if (hasConstructor(Object, this.taskObject.currentModal) && hasConstructor(SmartModal, this.taskObject.currentModal.modalBox)) {\n        this.taskObject.currentModal.modalBox.hide()\n      }\n      this.stateManager.goToState(this.R.get.states_pause)\n    }\n  }\n\n  /* --- Register functions --- */\n  runningState.addAwakeningFunctions(startRunning)\n\n  runningState.addEventFunctions(R.get.events_nextTrial, nextTrial)\n  runningState.addEventFunctions(R.get.events_goNextPosition, goToNextPosition)\n  runningState.addEventFunctions(R.get.events_endObservation, endObservation)\n\n  runningState.addEventFunctions(R.get.events_startPrediction, startPrediction)\n\n  runningState.addEventFunctions(R.get.events_pauseTransition, pauseTransition)\n\n  runningState.addEventFunctions(R.get.events_unfrozen, stateUnfrozen)\n  runningState.addEventFunctions(R.get.events_forcePause, goToPause)\n  runningState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  runningState.addEventFunctions(R.get.events_moreThanFiveNA, goToPause)\n\n  runningState.addEventFunctions(R.get.events_click, checkForClickPrediction)\n  runningState.addEventFunctions(R.get.events_keydown, checkKeyStrokeForPrediction)\n\n  runningState.addEventFunctions(R.get.events_playPredictionSound, playSound)\n  runningState.addEventFunctions(R.get.events_playObservationSound, playSound)\n\n  /* ======= State Running ======= */\n\n  // Center cross\n  // Observe movement\n  // Respond at any time\n  // ITI\n  // Center cross\n\n\n  /* ======= State Tutorial ======= */\n  tutorialState.addAwakeningFunctions(awakeTutorial)\n\n  tutorialState.addEventFunctions(R.get.events_tutorialNext, showNextPage)\n  tutorialState.addEventFunctions(R.get.events_showModal, showModal)\n\n  tutorialState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  tutorialState.addEventFunctions(R.get.events_unfrozen, tutorialUnfrozen)\n\n  tutorialState.addEventFunctions(R.get.events_playPredictionSound, playSound)\n  tutorialState.addEventFunctions(R.get.events_playObservationSound, playSound)\n\n\n  /* ======= State Tryout ======= */\n  dataManager.addTable('stateTryout1', eventFields)\n  dataManager.addTable('stateTryout2', eventFields)\n\n  tryoutState.addAwakeningFunctions(awakeTryout)\n  tryoutState.addEndingFunctions(tryoutEnd)\n\n  tryoutState.addEventFunctions(R.get.events_goNextPosition, tryoutGoToNextPosition)\n  tryoutState.addEventFunctions(R.get.events_endObservation, endObservation)\n\n  tryoutState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  tryoutState.addEventFunctions(R.get.events_unfrozen, tutorialUnfrozen)\n\n  tryoutState.addEventFunctions(R.get.events_startPrediction, tryoutStartPrediction)\n  tryoutState.addEventFunctions(R.get.events_responseTimeEnded, tryoutEndPrediction)\n  tryoutState.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  tryoutState.addEventFunctions(R.get.events_restartTutorial, () => {\n    stateManager.goToState(R.get.states_tutorial)\n  })\n\n  tryoutState.addEventFunctions(R.get.events_keydown, tryoutCheckKeyStrokeForPrediction)\n  tryoutState.addEventFunctions(R.get.events_click, checkForClickPrediction)\n\n  /* ======== State Pause ======== */\n  // stateManager.setPauseKeyStroke()\n  pauseState.addAwakeningFunctions(awakenPause)\n  pauseState.addEndingFunctions(endPause)\n  pauseState.addEventFunctions(R.get.events_keydown, pauseKeyDown)\n  pauseState.addEventFunctions(R.get.events_windowFocus, pauseKeyDown)\n  // pauseState.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  // pauseState.addEndingFunctions(function () { this.stateManager.promise('disposeOfButtons') })\n\n  /* ======= prematureEnd State ======= */\n  endState.addAwakeningFunctions(awakenEnd)\n\n  return scene\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/MainScene.js","import {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n} from 'experiment-js'\n\n\nconst selectLevel = function () {\n  if (typeof this.state === 'undefined') {\n    throw new Error('state.selectLevel: state is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const dataManager = this.dataManager\n  const elements2D = stateManager.get('elements2D')\n  // const GUI = stateManager.get('GUI')\n  const R = this.R\n  const parameters = R.get.parameters\n\n  const checkTaskDone = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskDone }, this.connection)\n  const checkTaskEndNoComeback = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskEndNoComeback }, this.connection)\n  const checkTutorialOne = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_tutorialDone[0] }, this.connection)\n\n  stateManager.call('hideAll')\n  stateManager.set('shouldCheckTime', false)\n\n  let taskEnded = false\n  const deferred = new Deferred()\n\n  Promise.all([checkTaskDone, checkTaskEndNoComeback, checkTutorialOne])\n  .then((results) => {\n    for (const result of results) {\n      if (typeof result.code === 'undefined') {\n        if (stateManager.currentStateKey !== R.get.states_idle) {\n          stateManager.goToState(R.get.states_idle)\n        }\n\n        this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n        .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n      } else if ((result.code === R.get.checkpoint_taskDone) || (result.code === R.get.checkpoint_taskEndNoComeback)) {\n        taskEnded = true\n        stateManager.set('endReason', result.message)\n        stateManager.goToState(R.get.states_end)\n\n        deferred.resolve('active.selectLevel: end of task')\n        return false\n      } else if ((result.code === R.get.checkpoint_tutorialDone[0]) && (!taskEnded)) {\n        stateManager.set('shouldCheckTime', true)\n      }\n    }\n    return this.dataManager.query('getCheckpoint', null, this.connection)\n  })\n  .then((result) => {\n    if (result !== false) {\n      if (typeof result.code === 'undefined') {\n        if (stateManager.currentStateKey !== R.get.states_active) {\n          stateManager.goToState(R.get.states_idle)\n        }\n\n        this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n        .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n      }\n\n      let eventLevel\n      switch (result.code) {\n        case R.get.checkpoint_tutorialDone[0]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 1 })\n          elements2D.wolfFaceSprite.spriteFrame = 0\n          break\n        case R.get.checkpoint_tutorialDone[1]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 4 })\n          elements2D.wolfFaceSprite.spriteFrame = 3\n          break\n        case R.get.checkpoint_levelDone[0]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 2 })\n          elements2D.wolfFaceSprite.spriteFrame = 1\n          break\n        case R.get.checkpoint_levelDone[1]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 3 })\n          elements2D.wolfFaceSprite.spriteFrame = 2\n          break\n        case R.get.checkpoint_levelDone[2]:\n          eventLevel = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, { tutorial: 2 })\n          elements2D.wolfFaceSprite.spriteFrame = 3\n          break\n        case R.get.checkpoint_levelDone[3]:\n          stateManager.set('endReason', 'You finished the task finished')\n          stateManager.goToState(R.get.states_end)\n          break\n        case R.get.checkpoint_taskDone:\n          stateManager.set('endReason', result.message)\n          stateManager.goToState(R.get.states_end)\n          break\n        case R.get.checkpoint_taskEndNoComeback:\n          stateManager.set('endReason', result.message)\n          stateManager.goToState(R.get.states_end)\n          break\n        default:\n          if (parameters.animation === 'yes') {\n            this.stateManager.goToState(R.get.states_running, true)\n            return 'animation'\n          }\n            // Start tutorial\n            // eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 3 }) // TODO TAKE THAT BACk\n          eventLevel = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, { tutorial: 1 })\n\n\n      }\n\n      delay(150).then(() => { stateManager.addEvent(eventLevel) })\n      deferred.resolve('active.selectLevel: level selected - resolved')\n    }\n  })\n  .catch(() => {\n    if (stateManager.currentStateKey !== R.get.states_active) {\n      stateManager.goToState(R.get.states_idle)\n    }\n\n    this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n    .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n  })\n\n  // GUI.levelVisible = true\n  // /* --- Delete buttons --- */\n  // stateManager.promise('disposeOfButtons')\n  //\n  // const eventButtonOne = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 1,\n  // })\n  // const eventButtonTwo = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 2,\n  // })\n  // const eventButtonThree = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 3,\n  // })\n  // const eventButtonFour = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 4,\n  // })\n  //\n  // const eventButtonTutorialOne = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, {\n  //   tutorial: 1,\n  // })\n  // const eventButtonTutorialFour = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, {\n  //   tutorial: 2,\n  // })\n  //\n  // const width = 220\n  // const height = 40\n  // const widthOffset = width / 2\n  //\n  // const buttonOptionLevelOne = {\n  //   id: 'levelOne',\n  //   parent: GUI,\n  //   text: 'Level 1',\n  //   marginAlignment: 'h: center, v: bottom',\n  //   margin: {\n  //     rightPixels: (width) + widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   width,\n  //   height,\n  //   fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.8, 0.8, 0.8, 1)),\n  //   clickEventData: eventButtonOne,\n  //   callbackFunction: null,\n  //   fontName: '20pt Arial',\n  //   baseOpacity: 0.8,\n  //   hoverOpacity: 1,\n  // }\n  //\n  // const buttonOptionTutorialOne = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonTutorialLevelFour',\n  //   text: 'Tutorial 1',\n  //   margin: {\n  //     rightPixels: (width) + widthOffset,\n  //     bottomPixels: height,\n  //   },\n  //   clickEventData: eventButtonTutorialOne,\n  // })\n  //\n  //\n  // const buttonOptionLevelTwo = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelTwo',\n  //   text: 'Level 2',\n  //   margin: {\n  //     rightPixels: widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonTwo,\n  // })\n  //\n  // const buttonOptionLevelThree = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelThree',\n  //   text: 'Level 3',\n  //   margin: {\n  //     leftPixels: widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonThree,\n  // })\n  //\n  // const buttonOptionLevelFour = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelFour',\n  //   text: 'Level 4',\n  //   margin: {\n  //     leftPixels: (width) + widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonFour,\n  // })\n  //\n  // const buttonOptionTutorialFour = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonTutorialLevelFour',\n  //   text: 'Tutorial 4',\n  //   margin: {\n  //     leftPixels: (width) + widthOffset,\n  //     bottomPixels: height,\n  //   },\n  //   clickEventData: eventButtonTutorialFour,\n  // })\n  //\n  // Promise.all([stateManager.promise('addButton', buttonOptionLevelOne),\n  //   stateManager.promise('addButton', buttonOptionLevelTwo),\n  //   stateManager.promise('addButton', buttonOptionLevelThree),\n  //   stateManager.promise('addButton', buttonOptionLevelFour),\n  //   stateManager.promise('addButton', buttonOptionTutorialOne),\n  //   stateManager.promise('addButton', buttonOptionTutorialFour),\n  // ])\n  //   .then((buttons) => {\n  //     elements2D.levelButtons = buttons\n  //     for (const button of buttons) {\n  //       button.levelVisible = true\n  //     }\n  //     deferred.resolve('stateManager.selectLevel: resolved')\n  //   })\n\n  return deferred.promise\n}\n\nconst startLevel = function (options = null) {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('state.startLevel: this.taskObject is undefined')\n  }\n\n  if (typeof options.data.level === 'undefined') {\n    throw new Error('state.startLevel: options.level is undefined')\n  }\n\n  /* --- Get context --- */\n  const taskObject = this.taskObject\n  const stateManager = this.stateManager\n  const R = this.R\n  const elements2D = stateManager.get('elements2D')\n  stateManager.emptyTimeTriggerEvents()\n  elements2D.agent.opacity = 0\n  elements2D.cross.spriteFrame = R.get.cross_base\n\n  /* --- Delete buttons --- */\n  stateManager.promise('disposeOfButtons')\n\n  stateManager.setGlobal('level', options.data.level)\n  stateManager.setGlobal('levelObject', taskObject.parameters.levels[options.data.level - 1])\n\n  stateManager.set('positionData', {\n    indexOnTransitionSequence: -1,\n    indexOnPredictionSequence: -1,\n    fullSequenceIndex: taskObject.parameters.levels[options.data.level - 1].sequenceObject.fullSequence.length - 3, // TODO PUT IT BACK -1,\n  })\n\n  if (stateManager.currentStateKey !== R.get.states_running) { stateManager.goToState(R.get.states_running) }\n\n  return ('state.startLevel: resolved')\n}\n\nconst endActive = function () {\n  // this.stateManager.promise('disposeOfButtons')\n}\nexport { startLevel, selectLevel, endActive }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/active.js","import { EventData } from 'experiment-js'\n\nconst awakenEnd = function () {\n  const R = this.R\n  const scene = this.scene\n  this.stateManager.call('hideAll')\n  scene.initialGui.levelVisible = false\n  this.dataManager.authorize_manual_login = false\n  this.dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskDone }, this.connection)\n  .then((r) => {\n    const event = new EventData(this.R.get.events_aknowledgedEnding)\n    this.stateManager.onNext(this.R.get.events_aknowledgedEnding, () => {\n      window.open('', '_self').close()\n    })\n    let reason = 'You completed the task !'\n    let title = R.get.taskFinishedTitle\n    let content = R.get.taskFinishedContent\n\n    if (r.code !== R.get.checkpoint_taskDone) {\n      reason = this.stateManager.get('endReason', '')\n      title = R.get.taskStoppedTitle\n      content = R.get.taskStoppedMessage\n      if (reason !== '') {\n        content += R.get.taskStoppedReason.replace('{t}', reason)\n      }\n      this.taskObject.setCheckpoint(R.get.checkpoint_taskEndNoComeback, reason)\n\n      this.taskObject.modal({ type: 'centralLarge', title, content, event })\n    } else {\n      // this.dataManager.query('getFinalCode', null, this.connection)\n      // .then((r) => {\n      //   content = content.replace('{c}', r.code)\n      this.taskObject.modal({ type: 'centralLarge', title, content, event })\n      // })\n    }\n  })\n}\n\nexport { awakenEnd } //eslint-disable-line\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/end.js","import BABYLON from 'experiment-babylon-js'\nimport {\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  hasConstructor,\n  delay,\n} from 'experiment-js'\n\nimport { setMargins } from '../functions/globalFunctions'\n\n\nconst awakenPause = function () {\n  const stateManager = this.stateManager\n  const levelObject = stateManager.get('levelObject')\n  const GUI = stateManager.get('GUI')\n  const R = this.R\n  const state = this.state\n  const pauseTime = stateManager.timeInMs\n  const threshold = R.get.thresholdIdle\n\n\n  state.hitKeyTime = null\n  state.initialGuiVisible = GUI.levelVisible\n\n  GUI.backgroundFill = BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0, 0, 0, 1))\n  GUI.levelVisible = true\n\n  const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: pauseTime })\n  if (lastPauseInfo.level !== levelObject.level) {\n    stateManager.set('pauseTimeLeft', threshold)\n  }\n\n  const currentTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n  stateManager.set('lastPauseInfo', { level: levelObject.level, time: pauseTime })\n\n  // datamanager get pause left\n  const options = { id: 'pauseText',\n    parent: GUI,\n    marginAlignment: 'h: center, v: center',\n    fontName: '30pt Arial',\n    fontSignedDistanceField: true,\n  }\n\n  state.timerText = function () {\n    const timeLeft = parseInt((currentTimeLeft - stateManager.timeInMs + pauseTime) / 1000, 10)\n    if (timeLeft < 0) { return false }\n    return R.get.timeLimitText.replace('{n}', String(timeLeft))\n  }\n\n  let t = 0\n  const delayInMs = 200\n  state.tic = function () {\n    state.centerText.levelVisible = true\n    const text = state.timerText()\n    if (text === false) {\n      stateManager.set('endReason', R.get.endReasonIdle.replace('{t}', (threshold / 1000)).replace('{l}', levelObject.level))\n      stateManager.goToState(R.get.states_end)\n    } else {\n      state.centerText.text = text\n      delay(delayInMs).then(() => {\n        if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n      })\n      t += delayInMs\n      if (t >= 3000) {\n        stateManager.get('sounds').prediction.play()\n        t = 0\n      }\n    }\n  }\n\n  if (!hasConstructor(BABYLON.Text2D, state.centerText)) {\n    state.topText = new BABYLON.Text2D(R.get.pauseText, options)\n    setMargins(state.topText, { topPixels: 0, bottomPixels: 40, leftPixels: 0, rightPixels: 0 })\n    state.centerText = new BABYLON.Text2D(state.timerText(), options)\n  } else {\n    state.topText.levelVisible = true\n    state.centerText.levelVisible = true\n    state.centerText.text = state.timerText\n  }\n\n\n  delay(200).then(() => {\n    if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n  })\n}\n\nconst pauseKeyDown = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n  const levelObject = { level: 0 } // stateManager.get('levelObject')\n  const R = this.R\n  const context = this\n  const threshold = R.get.thresholdIdle\n\n  if (state.hitKeyTime === null) { state.hitKeyTime = stateManager.timeInMs }\n\n  state.timerText = function () {\n    const timeLeft = Math.ceil((3000 - stateManager.timeInMs + state.hitKeyTime) / 1000, 10)\n    if (timeLeft < 0) { return false }\n    return R.get.pauseRestart.replace('{n}', String(timeLeft))\n  }\n\n  state.tic = function () {\n    const text = state.timerText()\n    if (text !== false) {\n      state.centerText.text = text\n      delay(200).then(() => {\n        if (!document.hasFocus()) {\n          const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: stateManager.timeInMs })\n          const previousTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n          const currentTimeLeft = previousTimeLeft - stateManager.timeInMs + lastPauseInfo.time\n\n          stateManager.set('pauseTimeLeft', currentTimeLeft)\n          awakenPause.bind(context)()\n        } else if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n      })\n    } else if (stateManager.frozenState) { stateManager.goToState(stateManager.frozenState) }\n  }\n\n  delay(200).then(() => {\n    if (!document.hasFocus()) {\n      awakenPause.bind(context)()\n    } else if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n  })\n}\n\nconst endPause = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const levelObject = { level: 0 } // stateManager.get('levelObject')\n  const GUI = stateManager.get('GUI')\n  const R = this.R\n  const threshold = R.get.thresholdIdle\n\n  GUI.backgroundFill = BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(1, 1, 1, 0))\n  GUI.levelVisible = state.initialGuiVisible\n\n  state.hitKeyTime = null\n  state.topText.levelVisible = false\n  state.centerText.levelVisible = false\n\n  const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: stateManager.timeInMs })\n  const previousTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n  const currentTimeLeft = previousTimeLeft - stateManager.timeInMs + lastPauseInfo.time\n\n  if (currentTimeLeft < -3) {\n    stateManager.call('prematureEnd', { reason: R.get.prematureEndPauseAboveThreshold })\n  } else {\n    stateManager.set('pauseTimeLeft', currentTimeLeft)\n  }\n}\n\n\nexport { awakenPause, endPause, pauseKeyDown }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/pause.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n  mandatory,\n  debuglog,\n  debugError,\n  sizeToVec,\n  hasConstructor,\n  samplePermutation,\n  rep,\n} from 'experiment-js'\n\n  /* --- State function --- */\n\nconst stateUnfrozen = function () {\n  if (_.has(this.state, 'currentTrialData.hasPaused')) {\n    this.state.currentTrialData.hasPaused = true\n  }\n}\n\nconst pauseTransition = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  /* --- Get the trial data --- */\n  const trials = this.R.get.trials\n\n  const index = stateManager.get('currentTrial', 0)\n  const pausesDone = stateManager.get('pausesDone', 0)\n\n  try {\n    if (index + 1 >= trials.length) {\n      return this.taskObject.setCheckpoint(R.get.checkpoint_taskDone).promise\n      .then(() => {\n        stateManager.goToState(R.get.states_end)\n      })\n    }\n    const maxTransitionTime = parameters.pauseTime + stateManager.timeInMs\n    const promise = stateManager.resolveOnKey({ except: null })\n    let shouldtic = true\n    let text2d\n\n    const transitionText = function () {\n      const timeLeft = Math.ceil((maxTransitionTime - stateManager.timeInMs) / 1000, 10)\n      if (timeLeft < 0) { return false }\n      return R.get.finishedLevelTransition.replace('{n}', String(timeLeft)).replace('{l}', String(pausesDone.length))\n    }\n\n    state.tic = function () {\n      if (!shouldtic) { return }\n      const text = transitionText()\n      if (text !== false) {\n        text2d.text = text\n        state.tooltipPause.box.levelVisible = true\n        delay(200).then(() => {\n          state.tooltipPause.box.levelVisible = false\n          state.tic()\n        })\n      } else {\n        stateManager.set('endReason', 'You were idle for more than 15 min')\n        stateManager.goToState(R.get.states_end)\n      }\n    }\n\n    const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n    state.tooltipPause = stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, (this.taskObject.renderSize.height / 2) - 100)), text: transitionText(), duration: promise })\n    text2d = state.tooltipPause.text\n    this.state.shouldPause = false\n    state.tic()\n\n    return promise.then(() => {\n      shouldtic = false\n      stateManager.newEvent(R.get.events_nextTrial, null, null, ['stateRunningEvents'])\n      // stateManager.newEvent(R.get.flags_levelDefined, null, { level: level + 1 }, ['globalLog', `stateRunningEventsLvl${level}`])\n    })\n  } catch (e) {\n    debugError('running.pauseTransition: error with the level data.')\n    stateManager.set('endReason', 'There was an error with the task. We are sorry.')\n    stateManager.goToState(R.get.states_end)\n    return 'Running.pauseTransition: Error'\n  }\n}\n\nconst startRunning = function () {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('state.startRunning: this.taskObject is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = stateManager.R\n  const parameters = R.get.parameters\n\n  R.get.trials = R.get.trials.slice(1, 20)\n\n  if (!document.hasFocus()) {\n    stateManager.newEvent(R.get.forcePause)\n  }\n\n  state.shouldPause = false\n  state.lastHide = stateManager.timeInMs\n  state.pausedBetween = []\n  stateManager.call('showAll')\n  stateManager.call('setLoaderValue', 0)\n\n  if (stateManager.get('trialIndices') === null) {\n    if (parameters.shouldRandomize === 'yes') {\n      stateManager.set('trialIndices', samplePermutation(rep(0, R.get.trials.length).map((o, i) => i)))\n    } else {\n      stateManager.set('trialIndices', rep(0, R.get.trials.length).map((o, i) => i))\n    }\n  }\n\n  /* --- Setup state variables --- */\n  if (typeof state.data === 'undefined') {\n    state.data = []\n  }\n  state.numberOfMissed = 0\n  state.isPredicting = false\n\n  /* --- Store the data --- */\n  const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n  const promise = stateManager.resolveOnKey({ except: null })\n  stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, (this.taskObject.renderSize.height / 2) - 100)), text: 'You are about to start the task\\nHit a key to when ready', duration: promise })\n\n\n  promise.then(() => {\n    // show the first position\n    const nextTransitionTime = this.stateManager.timeInMs + 100\n    const nextTransitionEvent = new EventData(R.get.events_nextTrial, nextTransitionTime, {\n      belongsTo: [\n        'globalLog', 'stateRunningEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n    })\n    stateManager.addTimeTriggerEvent(nextTransitionEvent)\n  })\n\n\n  return ('state.startRunning: resolved')\n}\n\nconst storeData = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n\n  /* --- If currentTrialData is already set, send it to the dataManager to be stored before handling new position --- */\n  let dataToStore = state.currentTrialData\n  try {\n    if ((hasConstructor(Object, state.currentTrialData)) && (stateManager.get('subject_id'))) {\n      const { trial, dataIndex, direction, choice, feedback, responseTime, startObservation,\n      endObservation, respondedAt, keysHits, hasPaused, clicks } = state.currentTrialData\n\n      // check if next position is not end of sequence\n      const correct = direction === choice\n\n      /* --- Store the data --- */\n      dataToStore = {\n        subject_id: stateManager.get('subject_id'),\n        trial,\n        data_index: dataIndex,\n        direction,\n        observation_duration: endObservation - startObservation,\n        subject_choice: choice, // NA for NOGO\n        response_time: responseTime, // NA for NOGO or no response\n        correct,\n        feedback,\n        key_hits: JSON.stringify(keysHits), // ['key', 'time'], [k,t], ...\n        clicks: JSON.stringify(clicks),\n        has_paused: hasPaused,\n        start_observation: startObservation,\n        end_observation: endObservation,\n        responded_at: respondedAt,\n        belongsTo: ['walkerData'],\n      }\n\n      stateManager.storeData(dataToStore)\n      state.currentTrialData = null\n    }\n  } catch (e) {\n    const message = 'runningState.goToNextPosition: could not store cwData.'\n    debugError(message)\n    stateManager.storeInErrorLog({ message, timestamp: stateManager.timeInMs, data: dataToStore })\n    // TODO check that the stateManager will store it in the DB\n  }\n}\n\nconst nextTrial = function () {\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  // explode spheres\n  if ((parameters.feedback === 'yes') && (hasConstructor(Object, this.state.currentTrialData)) && (this.state.currentTrialData.direction === this.state.currentTrialData.choice)) {\n    this.stateManager.call('explode', { meshes: this.stateManager.get('pointSpheres', []) })\n  }\n  // start from a new position - set the prediction phase to false\n  this.state.isPredicting = false\n\n  this.state.animationPoints = null\n  this.state.first = true\n\n  // hide the spheres\n  this.stateManager.call('hidePointSpheres')\n\n  /* --- Store Data --- */\n  if (parameters.animation !== 'yes') {\n    storeData.bind(this)()\n  }\n\n\n  /* --- Get the trial data --- */\n  const trials = this.R.get.trials\n  const trialIndices = this.stateManager.get('trialIndices', rep(0, this.R.get.trials.length).map((o, i) => i))\n  const pausesDone = this.stateManager.get('pausesDone', [])\n  const trialIndex = this.stateManager.get('currentTrial', -1) + 1\n\n  if ((trialIndex >= trials.length) || (Math.floor(trialIndex / parameters.trialsBeforePause) > pausesDone.length)) {\n    this.stateManager.set('pausesDone', pausesDone.concat(pausesDone.length))\n    this.stateManager.newEvent(this.R.get.events_pauseTransition, null, null, ['globalLog', 'stateRunningEvents'])\n    return 'End trials'\n  }\n\n\n  // const trialIndex = _.random(0, trials.length - 1)\n  this.stateManager.set('currentTrial', trialIndex)\n  this.stateManager.set('currentDataTrialIndex', trialIndices[trialIndex])\n  const trialData = trials[trialIndices[trialIndex]] // NOTE used for randomization\n\n  /* --- Set up the stored data --- */\n  // setup the trialData for this specific trial\n  const data = {\n    trial: trialIndex, // sequenceObject.trial[index],\n    dataIndex: trialIndices[trialIndex],\n    direction: trialData.direction, // sequenceObject.trialType[index],\n    positions: trialData.positions,\n    feedback: parameters.feedback,\n    currentIndex: -1,\n    state: this.state.stateKey,\n    choice: null,\n    responseTime: null,\n    startObservation: null,\n    endObservation: null,\n    respondedAt: null,\n    keysHits: [],\n    clicks: [],\n    hasPaused: false,\n  }\n\n  this.state.data.push(data)\n\n  // Change the currentTrialData to match new index\n  // keep the currentTrialData reference directly in the state\n  this.state.currentTrialData = data\n\n  if (parameters.animation !== 'yes') {\n    this.stateManager.call('setLoaderValue', Math.floor(100 * trialIndex / trials.length))\n    this.stateManager.call('setTextLoaderValue', trialIndex)\n\n  // wait for explosion to finish\n    delay(parameters.explosion.explosionTime).then(() => {\n    // change the camera based on the future direction\n      this.stateManager.call('setViewForDirection', data)\n\n    // show the center cross\n      this.stateManager.call('showCross')\n    })\n  }\n\n  // wait fixation time then start looping\n  if ((parameters.animation !== 'yes') && (trialIndex === 21)) {\n    const tutorial = this.R.get.tutorials_getHarder\n    const event = new EventData(this.R.get.events_goNextPosition)\n    this.taskObject.modal({ type: 'centralLarge', title: tutorial.title.en, content: tutorial.content.en, event })\n    this.taskObject.currentModal.modalBox.buttonText = 'Next'\n  } else {\n    this.stateManager.newEvent(this.R.get.events_goNextPosition, parameters.ITI + parameters.explosion.explosionTime, null, ['stateRunningEvents'])\n  }\n\n  return 'End nextTrial'\n}\n\nconst goToNextPosition = function () {\n  if (this.state.currentTrialData === 'undefined') {\n    return 'State.Running.goToNextPosition: undefined current trial data'\n  }\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = stateManager.R\n  const parameters = R.get.parameters\n\n  // hide the cross\n  stateManager.call('hideCross')\n\n  // get the trial data\n  const trialData = state.currentTrialData\n\n  /* --- Check the participant is doing the task and has valid connection --- */\n  if (!document.hasFocus()) {\n    stateManager.newEvent(R.get.events_windowBlur, null, null, ['stateRunningEvents'])\n  }\n\n  let checkConnection = false\n  if (hasConstructor(Deferred, this.state.checkLastInteraction)) {\n    if (!this.state.checkLastInteraction.pending) {\n      this.state.checkLastInteraction = new Deferred()\n      checkConnection = true\n    }\n  } else {\n    this.state.checkLastInteraction = new Deferred()\n    checkConnection = true\n  }\n\n  if (checkConnection) {\n    stateManager.call('checkIdleAndConnection', { deferred: this.state.checkLastInteraction })\n  }\n\n  /* --- Check if observation has started or set it up --- */\n  if (trialData.startObservation === null) {\n    trialData.startObservation = stateManager.timeInMs\n  }\n\n  /* --- Check if observation-prediction is finished --- */\n  if ((parameters.animation !== 'yes') && (((stateManager.timeInMs - trialData.startObservation) > parameters.maxObservationTime) || (trialData.choice !== null))) {\n    trialData.endObservation = stateManager.timeInMs\n    stateManager.newEvent(R.get.events_nextTrial, null, null, ['stateRunningEvents'])\n    return 'End observation'\n  }\n\n  // make sure the spheres are showing\n  if ((parameters.animation !== 'yes') || (state.first === true)) {\n    this.stateManager.call('showPointSpheres')\n    state.first = false\n  }\n\n\n  // accept prediction\n  state.isPredicting = true\n\n  /* --- Setup next position --- */\n  const positions = trialData.positions\n\n  /* --- Set index --- */\n  if (trialData.currentIndex + parameters.framePerPosition >= positions.length) {\n    trialData.currentIndex = -1\n    if ((parameters.animation === 'yes') && (state.animationPoints === null)) {\n      state.animationPoints = samplePermutation(rep(0, positions[0].length)\n      .map((o, i) => i)\n      .filter((e) => {\n        if (parameters.keptPoints.indexOf(e) !== -1) {\n          return false\n        }\n        return true\n      }))\n    }\n  }\n\n  trialData.currentIndex += parameters.framePerPosition\n\n  const index = trialData.currentIndex\n\n  // /* --- Check if end of level --- */\n  // if (index >= positions.length) {\n  //   // positionData.fullSequenceIndex -= 1\n  //   // go to endBlock -> pause - wait for next level to start\n  //   const nextTransitionEvent = new EventData(R.get.events_pauseTransition, stateManager.timeInMs, {\n  //     belongsTo: [\n  //       'globalLog', 'stateRunningEvents',\n  //     ],\n  //     handledAt: null,\n  //     storedAt: null,\n  //   })\n  //   stateManager.addTimeTriggerEvent(nextTransitionEvent)\n  //   return ('goToNextPosition: resolved. End of sequence.')\n  // }\n\n\n  // set up a deferred object to return and catch promises resolution\n  const deferred = new Deferred()\n\n  // Redraw tiles and move to next position\n  const points = positions[index]\n  const rate = parameters.rate\n  stateManager.promise('updatePoints', points)\n  .then(() => {\n    if ((state.animationPoints !== null) && ((stateManager.timeInMs - state.lastHide) > 1000) && (state.animationPoints.length)) {\n      const picked = _.random(0, state.animationPoints.length - 1)\n      stateManager.call('hidePointSphere', { index: state.animationPoints[picked] })\n      state.animationPoints.splice(picked, 1)\n      state.lastHide = stateManager.timeInMs\n    }\n\n    if (index > parameters.animationStartTurn) {\n      this.scene.initialCamera.alpha += parameters.angularVelocity\n    }\n\n    // delay(1000 / rate).then(() => {\n    stateManager.newEvent(R.get.events_goNextPosition, 1000 / rate, null, ['stateRunningEvents'])\n    // })\n\n    if (state.numberOfMissed >= 5) {\n      stateManager.newEvent(R.get.events_moreThanFiveNA, null, null, ['stateRunningEvents'])\n      deferred.resolve('goToNextPosition: resolved. Too many NA.')\n    }\n\n    deferred.resolve('stateManager.goToNextPosition: resolved')\n  })\n  /* --- Check if data is set and if subject had not been idle  --- */\n\n\n  return deferred.promise\n}\n\nconst endObservation = function () {\n  this.state.currentTrialData.endObservation = this.stateManager.timeInMs\n  this.stateManager.call('setAgentOpacity', { opacity: 0 })\n  return 'endObservation resolved'\n}\n\nconst startPrediction = function () {\n  if (typeof this.state.currentTrialData === 'undefined') {\n    throw new Error('state.startPrediction: state.currentTrialData is undefined')\n  }\n\n  const state = this.state\n  const stateManager = this.stateManager\n  const R = stateManager.R\n\n  state.numberOfMissed += 1\n\n  const levelObject = stateManager.get('levelObject')\n  stateManager.promise('setAgentOpacity', { opacity: R.get.agent_predictionOpacity })\n\n  stateManager.call('drawPredictionTiles')\n\n  const cross = this.stateManager.get('elements2D').cross\n  cross.spriteFrame = R.get.cross_predict\n  if (levelObject.sound === true) { this.stateManager.get('sounds').prediction.play() }\n\n  state.isPredicting = true\n  state.currentTrialData.startPrediction = stateManager.timeInMs\n  const endResponse = levelObject.predictionDuration\n\n  this.stateManager.newEvent(R.get.events_responseTimeEnded, endResponse, null, ['stateRunningEvents'])\n}\n\nconst checkForClickPrediction = function (event = mandatory()) {\n  try {\n    if (typeof this.taskObject === 'undefined') {\n      throw new Error('state.checkForClickPrediction: this.taskObject is undefined')\n    }\n\n      // todo with click detection Canvas2D\n    if (typeof event.data.clientY === 'undefined') {\n      throw new Error('state.checkForClickPrediction: event.data.clientY is undefined.')\n    }\n\n    if (typeof this.state.currentTrialData === 'undefined') {\n      throw new Error('state.checkForClickPrediction: options.trialData is undefined')\n    }\n\n    const stateManager = this.stateManager\n    const state = this.state\n\n    state.currentTrialData.clicks.push([event.data.engineX, event.data.engineY, stateManager.timeInMs])\n  } catch (e) {\n    debugError(e)\n  }\n  return 'checkForClickPrediction resolved'\n}\n\nconst checkKeyStrokeForPrediction = function (event = mandatory()) {\n  try {\n    if (typeof this.taskObject === 'undefined') {\n      throw new Error('state.checkKeyStrokeForPrediction: this.taskObject is undefined')\n    }\n\n    if (typeof event.data.keyCode === 'undefined') {\n      throw new Error('state.startPrediction: event.data.keyCode is undefined')\n    }\n\n    if (typeof this.state.currentTrialData === 'undefined') {\n      throw new Error('state.startPrediction: state.currentTrialData is undefined')\n    }\n\n    const stateManager = this.stateManager\n    const state = this.state\n    const R = this.R\n\n    const keyCode = event.data.keyCode\n\n    const keyValue = event.data.key\n\n    if (_.has(state, 'currentTrialData.keysHits')) {\n      if (!hasConstructor(Array, state.currentTrialData.keysHits)) {\n        state.currentTrialData.keysHits = []\n      }\n\n      state.currentTrialData.keysHits.push([keyValue, keyCode, stateManager.timeInMs])\n    }\n\n    const keys = {\n      ArrowLeft: [39, 'LEFT', R.get.cross_bottomRight],\n      ArrowRight: [37, 'RIGHT', R.get.cross_topLeft],\n    }\n\n    let direction = null\n    for (const key in keys) {\n      if (keys.hasOwnProperty(key)) {\n        const keyPosition = keys[key]\n        if (keyValue === key) {\n          direction = keyPosition[1]\n        }\n      }\n    }\n\n    if (direction !== null) {\n      /* --- Check if the subjects click was during the prediction phase and that he did not already chose  --- */\n\n      if ((state.isPredicting === true) && (state.currentTrialData.choice === null)) {\n        /* --- If the key was one of the specified store the corresponding direction, responseTime and choice --- */\n\n\n          // Store the choice of the subject and responseTime\n        state.currentTrialData.choice = direction\n        state.currentTrialData.responseTime = stateManager.timeInMs - state.currentTrialData.startObservation\n        state.currentTrialData.respondedAt = stateManager.timeInMs\n\n        // stateManager.call('highlightPosition', { direction })\n\n          // reset the number of missed trials\n        state.numberOfMissed = 0\n\n        debuglog(`state.checkKeyStrokeForPrediction: has chosen direction ${direction}.`)\n        return direction\n      }\n      debuglog('state.checkKeyStrokeForPrediction: already chosen')\n      return false\n    }\n    debuglog('state.checkKeyStrokeForPrediction: key did not correspond to state selection keys.')\n    return false\n  } catch (e) {\n    debugError(e)\n    return false\n  }\n}\n\nconst playSound = function (event) {\n  const sounds = this.stateManager.getGlobal('sounds')\n  sounds[event.data.name].play()\n}\n\nexport {\n  stateUnfrozen,\n  startRunning,\n  nextTrial,\n  goToNextPosition,\n  startPrediction,\n  checkForClickPrediction,\n  checkKeyStrokeForPrediction,\n  playSound,\n  endObservation,\n  pauseTransition,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/running.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n  mandatory,\n  debuglog,\n  hasConstructor,\n  rep,\n  sizeToVec,\n  debugError,\n  debugWarn,\n} from 'experiment-js'\n\nimport { getFullSequenceObjectForClassicLevels, sampleExponential } from '../../../utilities/taskUtilities'\n\n\nconst awakeTryout = function () {\n  const taskObject = this.taskObject\n  const state = this.state\n  const currentTutorial = this.stateManager.get('currentTutorial', 1)\n  const stateManager = this.stateManager\n  const elements2D = stateManager.get('elements2D')\n  const R = this.R\n\n  elements2D.loader.value = 0\n  stateManager.call('showAll')\n\n  state.data = state.data || []\n  state.isPredicting = false\n  state.shouldPause = (currentTutorial !== 1)\n  state.index = -1\n  stateManager.setGlobal('level', `tryout-${currentTutorial}`)\n\n  if (currentTutorial === 1) {\n    // set classic sequence object with 10 transition\n    state.sequenceObject = getFullSequenceObjectForClassicLevels([1, 3, 4, 2, 1, 3, 4, 2, 1, 3, 2, 4, 2, 1, 3])\n    stateManager.setGlobal('levelObject', this.taskObject.parameters.levels[0])\n  } else {\n    // set fMRI sequence object with 5 transition wolf and 5 transition rabbit\n    state.sequenceObject = {\n      fullSequence: [1, 2, 1, 3, 4, 2, 1, 3, 4, 3],\n      trial: _.range(1, 10),\n      trialType: rep(['observation_prediction', 'blackout'], 5),\n      block: rep(1, 5).concat(rep(2, 5)),\n      blockType: rep('random', 5).concat(rep('normal', 5)),\n    }\n    stateManager.setGlobal('levelObject', taskObject.parameters.levels[3])\n  }\n\n  this.stateManager.newEvent(this.R.get.events_goNextPosition, null, null, [`stateTryout${currentTutorial}`])\n}\n\nconst tryoutGoToNextPosition = function () {\n  // TODO experiment-boxes penser a faire dans un tooltip tool qui permet de focus sur un element et fait un modal en dessous pour expliquer\n\n  const stateManager = this.stateManager\n  const state = this.state\n  state.index += 1\n\n  const elements2D = stateManager.get('elements2D')\n  const levelObject = stateManager.get('levelObject')\n  const cross = elements2D.cross\n  const R = this.R\n  const tutorials = R.get.tutorials\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n  const index = state.index\n  const sequenceObject = state.sequenceObject\n\n  stateManager.hideTooltip()\n  state.isWaitingToPredict = new Deferred()\n  state.isWaitingToPredict.resolve()\n\n  const ntransition = sequenceObject.fullSequence.length\n  // Check if finished\n  if (index > ntransition - 1) {\n    // show finished tryout\n    stateManager.call('hideAll')\n\n    if (currentTutorial === 1) {\n      const event = new EventData(this.R.get.flags_levelDefined, stateManager.timeInMs, { level: 1 })\n      this.taskObject.modal({ title: tutorials.askContinue.title.en, content: tutorials.askContinue.content.en, event })\n    } else {\n      const event = new EventData(this.R.get.flags_levelDefined, stateManager.timeInMs, { level: 4 })\n      this.taskObject.modal({ title: tutorials.askfMRIContinue.title.en, content: tutorials.askfMRIContinue.content.en, event })\n    }\n\n    this.taskObject.currentModal.modalBox.buttonText = 'Go !'\n\n    return 'state.tryoutGoToNextPosition: finished tryout'\n  }\n\n  elements2D.loader.value = 100 * index / ntransition\n\n\n  let lastChoice = null\n  if ((typeof state.currentTrialData === 'object') && (typeof state.currentTrialData.choice === 'number')) {\n    lastChoice = parseInt(state.currentTrialData.choice, 10)\n  }\n\n  // setup the trialData for this specific trial\n  const trialData = {\n    level: levelObject.level,\n    fullSequenceIndex: index,\n    block: sequenceObject.block[index],\n    blockType: sequenceObject.blockType[index],\n    trial: sequenceObject.trial[index],\n    trialType: sequenceObject.trialType[index],\n    state: state.stateKey,\n    position: sequenceObject.fullSequence[index],\n    choice: null,\n    responseTime: null,\n    startObservation: null,\n    endObservation: null,\n    respondedAt: null,\n    startPrediction: null,\n    endPrediction: null,\n    nextPosition: null,\n    observedTransitionWasDominant: null,\n    keysHits: [],\n    clicks: [],\n    hasPaused: null,\n  }\n  state.data.push(trialData)\n\n  /* --- If currentTrialData is already set, send it to the dataManager to be stored before handling new position --- */\n  let dataToStore = state.currentTrialData\n  try {\n    if ((typeof state.currentTrialData !== 'undefined') && (stateManager.get('subject_id'))) {\n      const { block, blockType, trial, trialType, position, choice, responseTime, startObservation,\n      startPrediction, respondedAt, endPrediction, keysHits, hasPaused, clicks, endObservation } = state.currentTrialData\n\n      /* --- Check if the transition observed was dominant --- */\n      const dominant = null\n\n\n      /* --- Store the data --- */\n      dataToStore = {\n        subject_id: stateManager.get('subject_id'),\n        level: currentTutorial,\n        block,\n        block_type: blockType,\n        dominant_structure: levelObject.dominantStructure,\n        dominant_transition_probability: levelObject.dominantProbability,\n        trial,\n        trial_type: trialType,\n        position,\n        observation_duration: startPrediction ? (startPrediction - startObservation) : (this.timeInMs - startObservation),\n        observed_transition_was_dominant: dominant, // NA for first transition in a sublevel and after prediction\n        transition_to: sequenceObject.fullSequence[index], // NA for GO trials (non blackouts)\n        subject_choice: choice, // NA for NOGO\n        response_time: responseTime, // NA for NOGO or no response\n        correct: parseInt(sequenceObject.fullSequence[index], 10) === parseInt(choice, 10),\n        key_hits: JSON.stringify(keysHits), // ['key', 'time'], [k,t], ...\n        clicks: JSON.stringify(clicks),\n        has_paused: hasPaused,\n        start_observation: startObservation,\n        end_observation: endObservation,\n        start_prediction: startPrediction,\n        responded_at: respondedAt,\n        end_prediction: endPrediction,\n        belongsTo: ['tryoutData'],\n      }\n      stateManager.storeData(dataToStore)\n    }\n  } catch (e) {\n    const message = 'runningState.goToNextPosition: could not store cwData.'\n    debugError(message)\n    stateManager.storeInErrorLog({ message, timestamp: stateManager.timeInMs, data: dataToStore })\n    // TODO check that the stateManager will store it in the DB\n  }\n\n    // keep the currentTrialData reference directly in the state\n  state.currentTrialData = trialData\n\n    // start from a new position - set the prediction phase to false\n  state.isPredicting = false\n\n  // set up a deferred object to return and catch promises resolution\n  // const deferred = new Deferred()\n\n  let agentType = 'wolf'\n  if (sequenceObject.blockType[index] === 'random') { agentType = 'rabbit' }\n  if (elements2D.agentType !== agentType) {\n    stateManager.call('setAgent', { agent: agentType })\n  }\n\n  cross.spriteFrame = this.R.get.cross_base\n  stateManager.call('drawTiles', { withKeys: false })\n  stateManager.call('moveAgentToTile', { tile: trialData.position - 1, opacity: 1 })\n  let promise = Promise.resolve()\n  if ((currentTutorial === 1) && (!R.get.wolfFirstAppears.passed)) {\n    promise = this.taskObject.modal({ title: R.get.wolfFirstAppears_title, content: R.get.wolfFirstAppears_message })\n    R.get.wolfFirstAppears.passed = true\n  } else if ((currentTutorial === 2) && (!R.get.rabbitFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.rabbitFirstAppear_title, content: R.get.rabbitFirstAppear_message })\n    R.get.rabbitFirstAppear.passed = true\n  } else if ((currentTutorial === 2) && (sequenceObject.trialType[index - 1] === 'blackout') && (!R.get.blackoutFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.blackoutFirstAppear_title, content: R.get.blackoutFirstAppear_message })\n    R.get.blackoutFirstAppear.passed = true\n  } else if ((currentTutorial === 2) && (sequenceObject.blockType[index] === 'normal') && (!R.get.wolfFmriFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.wolfFmriFirstAppear_title, content: R.get.wolfFmriFirstAppear_message })\n    R.get.wolfFmriFirstAppear.passed = true\n  }\n\n  promise.then(() => {\n    trialData.startObservation = stateManager.timeInMs\n\n    let promise = Promise.resolve()\n\n    const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n    if ((index !== 0) && (sequenceObject.trialType[index - 1] !== 'blackout') && (sequenceObject.blockType[index - 1] === sequenceObject.blockType[index])) {\n      if (lastChoice === sequenceObject.fullSequence[index]) {\n         // Correct\n        const background = new BABYLON.Color4(0.1, 0.7, 0.1, 0.9)\n        let text = 'Correct!'\n        let duration = 2000\n        if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n          text += '\\nHit a key to continue'\n          promise = stateManager.resolveOnKey({ except: null })\n          duration = promise\n        }\n\n\n        let position = centerPosition\n        const tilePosition = stateManager.call('getTilePositions')[lastChoice - 1]\n        position = tilePosition\n        stateManager.tooltip({ position, background, text, duration })\n      } else {\n           // Incorrect\n        const background = new BABYLON.Color4(0.7, 0.1, 0.1, 0.9)\n\n        let position = centerPosition // TODO this.taskObject.center\n        if (hasConstructor(Number, lastChoice)) {\n          const tilePosition = stateManager.call('getTilePositions')[lastChoice - 1]\n               // const sign = Math.sign(position.subtract(tilePosition).x)\n          position = tilePosition\n        }\n\n        let text = 'Incorrect!'\n        let duration = 2000\n        if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n          text += '\\nHit a key to continue'\n          promise = stateManager.resolveOnKey({ except: null })\n          duration = promise\n        }\n\n        stateManager.tooltip({ position, background, text, duration })\n      }\n    }\n\n\n    if (currentTutorial === 1 && !R.get.predictionTest.passed && R.get.predictionTest.numberOfPrediction >= 3) {\n      R.get.predictionTest.passed = true\n      promise = stateManager.resolveOnKey({ except: null })\n      stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, centerPosition.y - 100)), text: `${R.get.realTimeTest_message}\\nHit a key to continue`, duration: promise })\n    } else if (R.get.predictionTest.passed) {\n      delay(1000).then(() => { state.isWaitingToPredict = new Deferred() })\n    }\n\n    return promise\n  })\n  .then(() => {\n    trialData.startObservation = stateManager.timeInMs\n    stateManager.newEvent(R.get.events_endObservation, levelObject.observationDuration, null, [`stateRunningEventsLvl${levelObject.level}`])\n\n    if (currentTutorial === 1) {\n      const nextTransitionTime = trialData.startObservation + levelObject.observationDuration + _.random(levelObject.minISIAfterLearning, levelObject.maxISIAfterLearning)\n      stateManager.newEvent(this.R.get.events_startPrediction, nextTransitionTime, null, [`stateTryout${currentTutorial}`])\n    } else if (sequenceObject.trialType[index] === 'blackout') {\n      const observationTime = levelObject.observationDuration +\n            levelObject.fixedISIAfterObservation +\n            sampleExponential(levelObject.sampleMeanISIAfterObservation, 0, levelObject.maxSampleAfterObservation, levelObject.maxSampleAfterObservation)\n\n      // add a blackout delay\n      delay(observationTime).then(() => {\n        stateManager.newEvent(R.get.events_screenWentBlack, null, [`stateRunningEventsLvl${levelObject.level}`])\n        stateManager.call('setAgentOpacity', { opacity: 0 })\n      })\n\n\n      const blackoutTime = observationTime + levelObject.fixedBlackScreenDuration +\n            sampleExponential(levelObject.sampleMeanBlackScreen, 0, levelObject.maxSampleBlackScreen, levelObject.maxSampleBlackScreen)\n\n          // create prediction event\n      stateManager.newEvent(R.get.events_goNextPosition, blackoutTime, null, [`stateRunningEventsLvl${levelObject.level}`])\n    } else if (sequenceObject.trialType[index] === 'observation_prediction') {\n      let observationTime = stateManager.timeInMs + levelObject.observationDuration + levelObject.fixedISIAfterObservation\n      observationTime += sampleExponential(levelObject.sampleMeanISIAfterObservation, 0, levelObject.maxSampleAfterObservation, levelObject.maxSampleAfterObservation)\n\n      debugWarn('Observation Time', (observationTime - stateManager.timeInMs) / 1000)\n          // create prediction event\n      stateManager.newEvent(R.get.events_startPrediction, observationTime, [`stateRunningEventsLvl${levelObject.level}`])\n    } else {\n      debugError('Error in sequence', sequenceObject)\n    }\n  })\n\n  return 'tryoutGoToNextPosition: finish sync call'\n}\n\nconst tryoutStartPrediction = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n  const R = stateManager.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n  const levelObject = stateManager.get('levelObject')\n  stateManager.promise('setAgentOpacity', { opacity: R.get.agent_predictionOpacity })\n\n  const cross = stateManager.get('elements2D').cross\n  cross.spriteFrame = R.get.cross_predict\n\n  const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n  let promise = Promise.resolve()\n  if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n    stateManager.call('drawPredictionTiles', { withKeys: 'dkmc' })\n    promise = stateManager.resolveOnKey({ except: null })\n    stateManager.tooltip({\n      position: centerPosition.add(new BABYLON.Vector2(0, centerPosition.y - 100)),\n      text: `${R.get.predictionTest_message}\\n${R.get.hitAKeyToContinue}`,\n      duration: promise,\n      event: new EventData('predictionTextDismissed'),\n    })\n\n    const text = R.get.changeCenterSquare\n    stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, -50)), text, duration: promise })\n  } else {\n    stateManager.call('drawPredictionTiles')\n  }\n\n  promise.then(() => {\n    state.isPredicting = true\n    state.isWaitingToPredict = new Deferred()\n    state.isWaitingToPredict.resolve()\n    state.currentTrialData.startPrediction = stateManager.timeInMs\n\n    if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n      const background = null // new BABYLON.Color4(0.6, 100 / 255, 0, 0.9)\n      const choiceDeferred = new Deferred()\n      state.choiceDeferred = choiceDeferred\n\n      const text = R.get.chooseNextPosition\n      stateManager.tooltip({ position: centerPosition, background, text, duration: choiceDeferred.promise })\n      choiceDeferred.promise.then(() => {\n        stateManager.newEvent(R.get.events_responseTimeEnded, stateManager.timeInMs + levelObject.predictionDuration, null, [`stateTryout${currentTutorial}`])\n      })\n    } else if (currentTutorial === 1) {\n      stateManager.newEvent(R.get.events_responseTimeEnded, stateManager.timeInMs + levelObject.predictionDuration, null, [`stateTryout${currentTutorial}`])\n    } else {\n      stateManager.call('setAgentOpacity', { opacity: 0 })\n      const endResponse = levelObject.predictionDuration\n      delay(endResponse).then(() => {\n        this.state.isPredicting = false\n        if (this.state.currentTrialData.choice !== null) {\n          cross.spriteFrame = R.get.crossLockByPosition[this.state.currentTrialData.choice - 1]\n        } else {\n          cross.spriteFrame = R.get.cross_base\n        }\n      })\n      const endPrediction = endResponse + levelObject.fixedISIAfterPrediction +\n          sampleExponential(levelObject.sampleMeanISIAfterPrediction, null, levelObject.maxSampleAfterPrediction, levelObject.maxSampleAfterPrediction)\n\n      this.stateManager.newEvent(R.get.events_goNextPosition, endPrediction, null, [`stateTryout${currentTutorial}`])\n    }\n  })\n}\n\nconst tryoutCheckKeyStrokeForPrediction = function (event = mandatory()) {\n  if (typeof event.data.keyCode === 'undefined') {\n    throw new Error('state.checkKeyStrokeForPrediction: event.data.keyCode is undefined')\n  }\n\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n\n  const keyCode = event.data.keyCode\n  const keyValue = event.data.key\n  const keys = {\n    m: [77, 3, R.get.cross_bottomRight],\n    d: [68, 1, R.get.cross_topLeft],\n    c: [67, 4, R.get.cross_bottomLeft],\n    k: [75, 2, R.get.cross_topRight],\n  }\n\n  if (_.has(state, 'currentTrialData.keysHits')) {\n    if (!hasConstructor(Array, state.currentTrialData.keysHits)) {\n      state.currentTrialData.keysHits = []\n    }\n\n    state.currentTrialData.keysHits.push([keyValue, keyCode, stateManager.timeInMs])\n  }\n\n  let position = null\n  let cross = 1\n  let chosenKey = null\n  for (const key in keys) {\n    if (keys.hasOwnProperty(key)) {\n      const keyPosition = keys[key]\n      if (keyValue === key) {\n  //  if (keyCode === keyPosition[0]) {\n        position = keyPosition[1]\n        cross = keyPosition[2]\n        chosenKey = key\n      }\n    }\n  }\n\n  if (position !== null) {\n  /* --- Check if the subjects hit was during the prediction phase and that he did not already chose  --- */\n\n    if ((state.isPredicting === true) && (state.currentTrialData.startPrediction !== null) && (state.currentTrialData.choice === null)) {\n    /* --- If the key was one of the specified store the corresponding position, responseTime and choice --- */\n\n      // Store the choice of the subject and responseTime\n      if (hasConstructor(Deferred, state.choiceDeferred)) {\n        state.choiceDeferred.resolve()\n        state.choiceDeferred = null\n      }\n\n      state.currentTrialData.choice = position\n      state.currentTrialData.responseTime = stateManager.timeInMs - state.currentTrialData.startPrediction\n      state.currentTrialData.respondedAt = stateManager.timeInMs\n\n      this.stateManager.get('elements2D').cross.spriteFrame = cross\n      if (!R.get.predictionTest.passed) {\n        R.get.predictionTest.numberOfPrediction += 1\n\n        const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n        let tilePosition = stateManager.call('getTilePositions')[position - 1]\n        const sign = Math.sign(centerPosition.subtract(tilePosition).x)\n        tilePosition = tilePosition.add(new BABYLON.Vector2(sign * 50, sign * 50))\n        stateManager.tooltip({ position: tilePosition, text: `${R.get.youSelectedThisTile} (${chosenKey})`, duration: delay(2000) })\n        const text = R.get.aLittleSquareShowsYourChoice\n        stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, -50)), text, duration: 2000 })\n      }\n\n      // reset the number of missed trials\n      state.numberOfMissed = 0\n\n\n      stateManager.newEvent(R.get.events_hasResponded, null, null, [`stateTryout${currentTutorial}`])\n      debuglog(`state.checkKeyStrokeForPrediction: has chosen position ${position}.`)\n      return position\n    } else if (hasConstructor(Deferred, state.isWaitingToPredict) && state.isWaitingToPredict.pending) {\n      const background = new BABYLON.Color4(0.7, 0.1, 0.1, 0.9)\n      stateManager.tooltip({ position: new BABYLON.Vector2((this.taskObject.renderSize.width / 2), (this.taskObject.renderSize.height / 2) - 100), text: R.get.tooEarly, background, duration: state.isWaitingToPredict })\n      state.isWaitingToPredict.resolve()\n      debuglog('state.checkKeyStrokeForPrediction: too early')\n      return false\n    }\n    debuglog('state.checkKeyStrokeForPrediction: already chosen')\n    return false\n  }\n  debuglog('state.checkKeyStrokeForPrediction: not a valid time to choose or already chosen')\n  return false\n}\n\nconst tryoutEndPrediction = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n  /* --- End prediction - store data --- */\n  state.isPredicting = false\n  state.currentTrialData.endPrediction = stateManager.timeInMs\n\n  stateManager.newEvent(R.get.events_goNextPosition, null, null, [`stateTryout${currentTutorial}`])\n  return ('state.endPrediction: resolved')\n}\n\n\nconst tryoutEnd = function () {\n  const stateManager = this.stateManager\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n  this.taskObject.setCheckpoint(R.get.checkpoint_tutorialDone[currentTutorial - 1])\n}\n\nexport {\n  awakeTryout,\n  tryoutEndPrediction,\n  tryoutCheckKeyStrokeForPrediction,\n  tryoutGoToNextPosition,\n  tryoutStartPrediction,\n  tryoutEnd,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/tryout.js","import {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  delay,\n  debuglog,\n  hasConstructor,\n} from 'experiment-js'\n\nimport { SmartModal } from 'experiment-boxes'\n\n\nconst pageOrderTutorialOne = ['intro', 'disclaimer', 'trialInstruction', 'arrowKeyboard', 'progressInstruction']\n\nconst awakeTutorial = function () {\n  const currentTutorial = this.stateManager.get('currentTutorial', 1)\n\n  const pageOrder = pageOrderTutorialOne\n\n  this.stateManager.set('currentPage', pageOrder[0])\n\n  const showIntro = new EventData(this.R.get.events_showModal, { page: pageOrder[0] })\n  this.stateManager.addEvent(showIntro)\n\n\n  this.stateManager.set('levelObject', { level: `tutorial-${currentTutorial}` })\n  this.state.shouldPause = (currentTutorial !== 1)\n}\n\nconst showModal = function ({ data: { page = 'intro' } }) {\n  const tutorials = this.R.get.tutorials\n  delay(50).then(() => { // TODO Check why you have to do that ...\n    if (tutorials.hasOwnProperty(page)) {\n      const tutorial = tutorials[page]\n      const event = new EventData(this.R.get.events_tutorialNext, { page })\n      this.taskObject.modal({ type: 'centralLarge', title: tutorial.title.en, content: tutorial.content.en, event })\n      this.taskObject.currentModal.modalBox.buttonText = 'Next'\n    }\n  })\n}\n\nconst tutorialUnfrozen = function () {\n  if (hasConstructor(Object, this.taskObject.currentModal) && hasConstructor(SmartModal, this.taskObject.currentModal.modalBox)) {\n    this.taskObject.currentModal.modalBox.show()\n  }\n}\n\nconst showNextPage = function ({ data: { page: currentPage = this.stateManager.get('currentPage', 'intro') } }) {\n  const pageOrder = pageOrderTutorialOne\n  const R = this.R\n\n  const currentIndex = pageOrder.indexOf(currentPage)\n  if (currentIndex !== -1) {\n    if (currentIndex !== pageOrder.length - 1) {\n      const showEvent = new EventData(R.get.events_showModal, { page: pageOrder[currentIndex + 1] })\n      this.stateManager.addEvent(showEvent)\n    } else {\n      debuglog('state.showNextPage: end of tutorial.')\n      this.stateManager.goToState(R.get.states_running, true) // TODO make it able to use the state object as well\n    }\n  } else {\n    throw new Error('state.showNextPage: invalid currentPage.')\n  }\n}\n\nexport { showNextPage, showModal, awakeTutorial, tutorialUnfrozen }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/tutorial.js","/** @module taskUtilities */\nimport math from 'experiment-mathjs'\nimport _ from 'lodash'\n\nimport { mandatory, rep } from 'experiment-js'\nimport BABYLON from 'experiment-babylon-js'\n\n/* ======= Texture Functions ======= */\nconst getAspectRatio = function (surfaceObject = mandatory()) {\n  if (surfaceObject.constructor === BABYLON.Texture) {\n    const { width: w, height: h } = surfaceObject.getBaseSize()\n    return (w / h)\n  }\n\n  throw new Error('getAspectRatio: object type not valid.')\n}\n\n/* =============== Task specific functions =============== */\n/**\n * Returns an array of the four possible main transition matrices\n * @return {Array} Each of the four entry is a 16*16 matrix with either 0 or 1\n */\n\nconst getDensity = function (elements, nsteps = 100, windowSize = 3) { // eslint-disable-line\n  if (elements.some(isNaN)) {\n    throw new Error('TaskObject.getDensity: elements are not all numeric.')\n  }\n\n  const range = [math.min(elements), math.max(elements)]\n\n  const stepSize = (range[1] - range[0]) / nsteps\n  // const windowLenght = stepSize * windowSize\n\n  const elementsInWindow = []\n  const windowPosition = []\n  const density = []\n  const points = []\n  for (let i = 0; i < nsteps; i++) {\n    const subset = _.filter(elements, (e) => {\n      const centered = e - range[0] - (i * stepSize)\n      return ((centered >= 0) && (centered < stepSize))\n    })\n\n    windowPosition[i] = (i + 0.5) * stepSize\n    elementsInWindow[i] = subset.length\n    density[i] = elementsInWindow[i] / elements.length\n    points[i] = {\n      x: windowPosition[i],\n      y: density[i],\n    }\n  }\n\n  return ({\n    windows: {\n      position: windowPosition,\n      numberOfElements: elementsInWindow,\n      density,\n    },\n    points,\n    chartOptions: {\n      type: 'line',\n      data: {\n        datasets: [{\n          label: 'Density',\n          data: points,\n        }],\n      },\n      options: {\n        scales: {\n          xAxes: [{\n            type: 'linear',\n            position: 'bottom',\n          }],\n        },\n      },\n    },\n  })\n}\n\nconst randomColor = function (opacity) {\n  return `rgba(${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${opacity || '.3'})`\n}\n\nconst computeDurationEstimate = function (options = {}) {\n  const parametersBase = {\n    dominantProbability: 0.76,\n    minNumberOfObservationsPerLearning: 3,\n    maxNumberOfObservationsPerLearning: 7,\n    observationDuration: 500,\n    interObservationDuration: 50, // to add ?\n    minTimeToPredict: 2000,\n    maxTimeToPredict: 5000,\n    feedbackDuration: 500,\n    minISIAfterLearning: 1000,\n    maxISIAfterLearning: 1500,\n    minISIAfterFeedback: 3000,\n    maxISIAfterFeedback: 5000,\n    rabbitAutoTransition: false,\n    rabbitDominantProbability: 0.6,\n    observationSegmentSizes: [3, 4, 5],\n    observationSegmentRepetitionPerBlock: 2,\n    numberOfBlocks: 6,\n    numberOfRandomBlocks: 2,\n    feedbackType: 'transition',\n  }\n\n  options = _.extend(parametersBase, options)\n\n  // number of observation = sum(segment sizes) * segment repetition per block\n  const numberOfObservationPerLevel = math.sum(options.observationSegmentSizes) * options.observationSegmentRepetitionPerBlock\n\n  // duration of one observation = observationDuration (add inter observation duration ?)\n  const oneObservationDuration = options.observationDuration\n\n  // observation duration for one block\n  const observationsDurationPerBlock = numberOfObservationPerLevel * oneObservationDuration\n\n  // number of prediction per block\n  const numberOfPredictionEventsPerBlock = options.observationSegmentSizes.length * options.observationSegmentRepetitionPerBlock\n\n  // min max and mean duration of one prediction event stored in a matrix\n  // timeDurationMatrix 4*2 min, max\n  const timeDurationMatrix = math.matrix([\n    [options.minISIAfterLearning, options.maxISIAfterLearning],\n    [options.minTimeToPredict, options.maxTimeToPredict],\n    [options.feedbackDuration, options.feedbackDuration],\n    [options.maxISIAfterFeedback, options.maxISIAfterFeedback],\n  ])\n\n  // factorMatrix 2*3 min max mean\n  const factorMatrix = math.matrix([\n    [1, 0, 1 / 2],\n    [0, 1, 1 / 2],\n  ])\n\n  // predictionDurationMatrix 4*3\n  const predictionDurationMatrix = math.multiply(timeDurationMatrix, factorMatrix)\n\n  // sumPredictionDurationVector 1*3\n  const sumPredictionDurationVector = math.multiply(math.matrix([1, 1, 1, 1]), predictionDurationMatrix)\n\n  const predictionsDurationPerBlock = math.multiply(sumPredictionDurationVector, numberOfPredictionEventsPerBlock)\n\n  // duration of one block\n  const observationDurationMatrix = math.matrix(rep(observationsDurationPerBlock, 3))\n\n  const durationPerBlock = math.add(observationDurationMatrix, predictionsDurationPerBlock)\n\n  // let total duration for one level min max mean in miliseconds\n  const totalDuration = (math.multiply(durationPerBlock, (options.numberOfBlocks + options.numberOfRandomBlocks))).toArray()\n\n  return ({\n    min: totalDuration[0],\n    max: totalDuration[1],\n    mean: totalDuration[2],\n  })\n}\n\nexport {\n  computeDurationEstimate,\n  randomColor,\n  getDensity,\n  getAspectRatio,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/utilities/taskUtilities.js","module.exports = __WEBPACK_EXTERNAL_MODULE_16__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}\n// module id = 16\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_17__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}\n// module id = 17\n// module chunks = 0"],"sourceRoot":""}