{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 9e80096f756ae036c9cf","webpack:///external {\"commonjs\":\"experiment-js\",\"commonjs2\":\"experiment-js\",\"amd\":\"experiment-js\",\"root\":\"experiment\"}","webpack:///external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}","webpack:///external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}","webpack:///external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}","webpack:///./src/task/scenes/main/functions/globalFunctions.js","webpack:///./src/task/startup/startup.js","webpack:///./builder.js","webpack:///./src/config.js","webpack:///./src/task/scenes/main/MainScene.js","webpack:///./src/task/scenes/main/states/active.js","webpack:///./src/task/scenes/main/states/end.js","webpack:///./src/task/scenes/main/states/pause.js","webpack:///./src/task/scenes/main/states/running.js","webpack:///./src/task/scenes/main/states/tryout.js","webpack:///./src/task/scenes/main/states/tutorial.js","webpack:///./src/task/utilities/taskUtilities.js","webpack:///external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}","webpack:///external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}"],"names":["placePoints","points","length","stateManager","pointSpheres","get","redraw","tempPointSpheres","i","point","pointSphere","Mesh","CreateSphere","scene","position","Vector3","push","set","updatePoints","call","hidePointSpheres","visibility","showPointSpheres","setLoaderValue","value","loader","setTextLoaderValue","textLoader","Text2D","parent","fontName","marginAlignment","fontSignedDistanceField","extend","margin","leftPixels","rightPixels","topPixels","bottomPixels","text","hideLoader","levelVisible","showLoader","guiCanvas","size","Size","border","Canvas2D","GetSolidColorBrush","Color4","borderThickness","opacity","setViewForDirection","direction","camera","activeCamera","xPos","setTarget","Zero","addButton","options","taskObject","Error","canvas","baseOptions","id","timeInMs","x","y","width","height","fill","clickEventData","baseOpacity","hoverOpacity","zOrder","padding","buttonOptions","roundRadius","children","marginVAlignment","marginHAlignment","buttonRect","Rectangle2D","pointerEventObservable","add","PrimitivePointerInfo","PointerOver","PointerOut","constructor","happenedAt","data","button","addEvent","PointerUp","setMargins","prim","showCross","crossSheet","cloneAssetIntoScene","R","hasAlpha","cross","Sprite2D","dispose","spriteSize","spriteLocation","Vector2","spriteFrame","hideCross","highlightPosition","promise","hightlight","type","explode","meshes","parameters","explosion","explosionTexture","mesh","particleSystem","ParticleSystem","particleTexture","emitter","minEmitBox","maxEmitBox","color1","color2","colorDead","minSize","maxSize","minLifeTime","maxLifeTime","emitRate","blendMode","BLENDMODE_ONEONE","gravity","direction1","direction2","minAngularSpeed","maxAngularSpeed","Math","PI","minEmitPower","maxEmitPower","updateSpeed","targetStopDuration","disposeOnStop","start","setBlackScreen","on","elements2D","getGlobal","has","blackScreen","checkIdleAndConnection","deferred","returnToState","dataManager","connection","shouldCheckTime","query","then","r","delay","lastInteraction","delayMin","goToState","states_end","currentStateKey","catch","states_idle","onNext","events_unfrozen","state","freeze","modal","title","lostConnectionTitle","content","lostConnectionContent","Promise","resolve","window","calibrator","defferedDomLoaded","document","addEventListener","scripts","getElementsByTagName","assetsFolderFullpath","src","delimiterIndices","indicesOf","substr","p1","p2","addFiles","loadingPromise","all","DEBUG_MODE_ON","mergeWith","level","registerSceneGenerator","sceneNames","rate","framePerPosition","numberOfPoints","maxObservationTime","fixationTime","ITI","trialsBeforePause","pauseTime","shouldRandomize","feedback","explosionTime","assetsToLoad","path","parametersNames","parametersConstraints","paramBox","bind","tempMaxNumberOfRetry","MAX_NUMBER_OF_RETRY","endpoint","loginForm","fields","userId","constraints","authorizedValues","password","format","callback","credentials","form","buttonText","context","states_active","authorize_manual_login","useLocalStorageCredentials","setConnection","signInForm","loggedIn","login","startTask","message","queryString","currentScene","e","loginError","en","open","close","require","MainScene","optionsBase","sceneKey","canvasBackground","backgroundRoundRadius","clearColor","canvasPercentWidth","canvasPercentHeight","mode","create3DScene","light0","HemisphericLight","diffuse","Color3","specular","groundColor","FreeCamera","Camera","ORTHOGRAPHIC_CAMERA","side","orthoTop","orthoBottom","orthoLeft","renderSize","orthoRight","onResize","register","cwDataFields","addTable","connections","surveyDataFields","eventFields","setGlobal","indexOnTransitionSequence","indexOnPredictionSequence","fullSequenceIndex","states","running","tutorial","tryout","tryoutFMRI","end","checkpoint","tutorialDone","levelDone","taskDone","taskEndNoComeback","flags","levelDefined","events","sequenceGenerated","nextTrial","goNextPosition","endObservation","startPrediction","responseTimeEnded","isiAfterLearningEnded","feedbackEnded","isiAfterFeedbackEnded","pauseTransition","forcePause","predictionStartBlackout","blackoutEnds","predictionEndsBlackout","isiAfterPredictionEndsBlackout","screenWentBlack","playPredictionSound","playObservationSound","showModal","goToTutorial","hasResponded","restartTutorial","goToLevel1","goToLevel2","goToLevel3","goToLevel4","tic","moreThanFiveNA","aknowledgedEnding","tutorialNext","addState","states_tutorial","states_running","states_tryout","tutorialState","runningState","tryoutState","endState","pauseState","pause","eventData","flags_levelDefined","belongsTo","handledAt","storedAt","active","addAwakeningFunctions","addEndingFunctions","addEventFunctions","events_goToTutorial","goToPause","shouldPause","Object","currentModal","modalBox","hide","states_pause","events_nextTrial","events_goNextPosition","events_endObservation","events_startPrediction","events_pauseTransition","events_forcePause","events_windowBlur","events_moreThanFiveNA","events_click","events_keydown","events_playPredictionSound","events_playObservationSound","events_tutorialNext","events_showModal","events_responseTimeEnded","events_restartTutorial","events_windowFocus","selectLevel","checkTaskDone","checkpoint_taskDone","checkTaskEndNoComeback","checkpoint_taskEndNoComeback","checkTutorialOne","checkpoint_tutorialDone","taskEnded","results","result","code","eventLevel","wolfFaceSprite","checkpoint_levelDone","startLevel","emptyTimeTriggerEvents","agent","cross_base","levels","sequenceObject","fullSequence","endActive","awakenEnd","initialGui","event","events_aknowledgedEnding","reason","taskFinishedTitle","taskFinishedContent","taskStoppedTitle","taskStoppedMessage","taskStoppedReason","replace","setCheckpoint","awakenPause","levelObject","GUI","threshold","thresholdIdle","hitKeyTime","initialGuiVisible","backgroundFill","lastPauseInfo","time","currentTimeLeft","timerText","timeLeft","parseInt","timeLimitText","t","delayInMs","centerText","endReasonIdle","prediction","play","topText","pauseText","pauseKeyDown","ceil","pauseRestart","hasFocus","previousTimeLeft","frozenState","endPause","prematureEndPauseAboveThreshold","stateUnfrozen","currentTrialData","hasPaused","trials","index","pausesDone","maxTransitionTime","resolveOnKey","except","shouldtic","text2d","transitionText","finishedLevelTransition","tooltipPause","box","centerPosition","scale","tooltip","duration","newEvent","startRunning","slice","pausedBetween","map","o","numberOfMissed","isPredicting","nextTransitionTime","nextTransitionEvent","addTimeTriggerEvent","storeData","dataToStore","trial","dataIndex","choice","responseTime","startObservation","respondedAt","keysHits","clicks","correct","subject_id","data_index","observation_duration","subject_choice","response_time","key_hits","JSON","stringify","has_paused","start_observation","end_observation","responded_at","storeInErrorLog","timestamp","trialIndices","trialIndex","floor","concat","trialData","positions","currentIndex","stateKey","tutorials_getHarder","goToNextPosition","checkConnection","checkLastInteraction","pending","agent_predictionOpacity","cross_predict","sound","endResponse","predictionDuration","checkForClickPrediction","clientY","engineX","engineY","checkKeyStrokeForPrediction","keyCode","keyValue","key","keys","ArrowLeft","cross_bottomRight","ArrowRight","cross_topLeft","hasOwnProperty","keyPosition","playSound","sounds","name","awakeTryout","currentTutorial","range","trialType","block","blockType","tryoutGoToNextPosition","tutorials","hideTooltip","isWaitingToPredict","ntransition","askContinue","askfMRIContinue","lastChoice","endPrediction","nextPosition","observedTransitionWasDominant","dominant","block_type","dominant_structure","dominantStructure","dominant_transition_probability","dominantProbability","trial_type","observed_transition_was_dominant","transition_to","start_prediction","end_prediction","agentType","withKeys","tile","wolfFirstAppears","passed","wolfFirstAppears_title","wolfFirstAppears_message","rabbitFirstAppear","rabbitFirstAppear_title","rabbitFirstAppear_message","blackoutFirstAppear","blackoutFirstAppear_title","blackoutFirstAppear_message","wolfFmriFirstAppear","wolfFmriFirstAppear_title","wolfFmriFirstAppear_message","background","predictionTest","tilePosition","Number","numberOfPrediction","realTimeTest_message","observationDuration","random","minISIAfterLearning","maxISIAfterLearning","observationTime","fixedISIAfterObservation","sampleMeanISIAfterObservation","maxSampleAfterObservation","events_screenWentBlack","blackoutTime","fixedBlackScreenDuration","sampleMeanBlackScreen","maxSampleBlackScreen","tryoutStartPrediction","predictionTest_message","hitAKeyToContinue","changeCenterSquare","choiceDeferred","chooseNextPosition","crossLockByPosition","fixedISIAfterPrediction","sampleMeanISIAfterPrediction","maxSampleAfterPrediction","tryoutCheckKeyStrokeForPrediction","m","d","c","cross_bottomLeft","k","cross_topRight","chosenKey","sign","subtract","youSelectedThisTile","aLittleSquareShowsYourChoice","events_hasResponded","tooEarly","tryoutEndPrediction","tryoutEnd","pageOrderTutorialOne","awakeTutorial","pageOrder","showIntro","page","tutorialUnfrozen","show","showNextPage","currentPage","indexOf","showEvent","getAspectRatio","surfaceObject","Texture","getBaseSize","w","h","getDensity","elements","nsteps","windowSize","some","isNaN","min","max","stepSize","elementsInWindow","windowPosition","density","subset","filter","centered","windows","numberOfElements","chartOptions","datasets","label","scales","xAxes","randomColor","round","computeDurationEstimate","parametersBase","minNumberOfObservationsPerLearning","maxNumberOfObservationsPerLearning","interObservationDuration","minTimeToPredict","maxTimeToPredict","feedbackDuration","minISIAfterFeedback","maxISIAfterFeedback","rabbitAutoTransition","rabbitDominantProbability","observationSegmentSizes","observationSegmentRepetitionPerBlock","numberOfBlocks","numberOfRandomBlocks","feedbackType","numberOfObservationPerLevel","sum","oneObservationDuration","observationsDurationPerBlock","numberOfPredictionEventsPerBlock","timeDurationMatrix","matrix","factorMatrix","predictionDurationMatrix","multiply","sumPredictionDurationVector","predictionsDurationPerBlock","observationDurationMatrix","durationPerBlock","totalDuration","toArray","mean"],"mappings":"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;AAED,UAAK9G,UAAL,CAAgBmH,KAAhB,CAAsB,EAAE/D,MAAM,cAAR,EAAwBgE,OAAO7E,EAAE/F,GAAF,CAAM6K,mBAArC,EAA0DC,SAAS/E,EAAE/F,GAAF,CAAM+K,qBAAzE,EAAtB,EACClB,IADD,CACM;AAAA,aAAM,yBAAM,EAAN,CAAN;AAAA,KADN,EACuBA,IADvB,CAC4B,YAAM;AAAE/J,mBAAagB,IAAb,CAAkB,wBAAlB,EAA4C,EAAE0I,eAAe,QAAjB,EAA5C;AAA0E,KAD9G;AAED,GAtFD;;AAwFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAOD,SAAS7C,OAAhB;AACD,CA/ND;;AAiOA,IAAMyR,aAAa,SAAbA,UAAa,GAA0B;AAAA,MAAhB5U,OAAgB,uEAAN,IAAM;;AAC3C,MAAI,OAAO,KAAKC,UAAZ,KAA2B,WAA/B,EAA4C;AAC1C,UAAM,IAAIC,KAAJ,CAAU,gDAAV,CAAN;AACD;;AAED,MAAI,OAAOF,QAAQ+B,IAAR,CAAa+G,KAApB,KAA8B,WAAlC,EAA+C;AAC7C,UAAM,IAAI5I,KAAJ,CAAU,8CAAV,CAAN;AACD;;AAED;AACA,MAAMD,aAAa,KAAKA,UAAxB;AACA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","file":"walker.max.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"experiment-js\"), require(\"experiment-babylon-js\"), require(\"lodash\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jQuery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"walker\", [\"experiment-js\", \"experiment-babylon-js\", \"lodash\", \"experiment-boxes\", \"experiment-mathjs\", \"jQuery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"walker\"] = factory(require(\"experiment-js\"), require(\"experiment-babylon-js\"), require(\"lodash\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jQuery\"));\n\telse\n\t\troot[\"walker\"] = factory(root[\"experiment\"], root[\"BABYLON\"], root[\"_\"], root[\"experimentBoxes\"], root[\"math\"], root[\"jQuery\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_16__, __WEBPACK_EXTERNAL_MODULE_17__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 9e80096f756ae036c9cf","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-js\",\"commonjs2\":\"experiment-js\",\"amd\":\"experiment-js\",\"root\":\"experiment\"}\n// module id = 0\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}\n// module id = 2\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}\n// module id = 3\n// module chunks = 0","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array,\n  String, // eslint-disable-line\n  Deferred,\n  debugWarn,\n  hasConstructor,\n  delay,\n  Loader,\n} from 'experiment-js'\n\nconst placePoints = function (points = []) {\n  if (points.length === 0) return\n\n  const stateManager = this.stateManager\n\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  let redraw = false\n  if (points.length !== pointSpheres.length) {\n    redraw = true\n  }\n\n  const tempPointSpheres = []\n  for (let i = 0; i < points.length; i++) {\n    const point = points[i]\n\n    if (hasConstructor(Array, point)) {\n      let pointSphere\n      if (redraw || pointSpheres.length < i) {\n          // draw a sphere at point and store it in the array\n        pointSphere = BABYLON.Mesh.CreateSphere(`sphere${i}`, 32, 0.5, this.scene)\n      } else {\n        pointSphere = pointSpheres[i]\n      }\n\n      pointSphere.position = new BABYLON.Vector3(...point)\n\n      tempPointSpheres.push(pointSphere)\n    }\n  }\n  // set the data into the stateManager\n  stateManager.set('pointSpheres', tempPointSpheres)\n}\n\nconst updatePoints = function (points) {\n  if (points.length === 0) return\n\n  const stateManager = this.stateManager\n\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  if (pointSpheres.length !== points.length) {\n    stateManager.call('placePoints', points)\n  } else {\n    for (let i = 0; i < pointSpheres.length; i++) {\n      const point = points[i]\n      if (hasConstructor(Array, point)) {\n        pointSpheres[i].position = new BABYLON.Vector3(...point)\n      }\n    }\n  }\n}\n\nconst hidePointSpheres = function () {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  for (const pointSphere of pointSpheres) {\n    if (hasConstructor(BABYLON.Mesh, pointSphere)) {\n      pointSphere.visibility = false\n    }\n  }\n}\n\nconst showPointSpheres = function () {\n  const stateManager = this.stateManager\n  const pointSpheres = stateManager.get('pointSpheres', [])\n\n  for (const pointSphere of pointSpheres) {\n    if (hasConstructor(BABYLON.Mesh, pointSphere)) {\n      pointSphere.visibility = true\n    }\n  }\n}\n\nconst setLoaderValue = function (value = 0) {\n  const loader = this.stateManager.get('loader', null)\n\n  if (loader === null) {\n    this.stateManager.call('showLoader', value)\n  } else {\n    loader.value = value\n  }\n}\n\nconst setTextLoaderValue = function (value = '0') {\n  let textLoader = this.stateManager.get('textLoader', null)\n\n  if (textLoader === null) {\n    textLoader = new BABYLON.Text2D(String(value), {\n      parent: this.stateManager.get('GUI'),\n      fontName: '20px Arial',\n      marginAlignment: 'v: bottom, h: center',\n      fontSignedDistanceField: true,\n    })\n    _.extend(textLoader.margin, { leftPixels: 0, rightPixels: 0, topPixels: 0, bottomPixels: 51 })\n\n    this.stateManager.set('textLoader', textLoader)\n  } else {\n    textLoader.text = String(value)\n  }\n}\n\nconst hideLoader = function () {\n  const textLoader = this.stateManager.get('textLoader', null)\n  if (textLoader !== null) { textLoader.levelVisible = false }\n  const loader = this.stateManager.get('loader', null)\n  if (textLoader !== null) { loader.levelVisible = false }\n}\n\nconst showLoader = function (value = 0) {\n  const guiCanvas = this.stateManager.get('GUI')\n  let loader = this.stateManager.get('loader', null)\n  if (loader !== null) {\n    loader.levelVisible = true\n  } else {\n    loader = new Loader({ parent: guiCanvas,\n      size: new BABYLON.Size(69, 23),\n      border: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.7, 0.7, 0.7, 1)),\n      marginAlignment: 'v:bottom, h:center',\n      borderThickness: 1 })\n    loader.value = value\n    loader.opacity = 1\n    _.extend(loader.margin, { leftPixels: 0.5, rightPixels: 0, topPixels: 0, bottomPixels: 53 })\n\n    this.stateManager.set('loader', loader)\n  }\n\n  const textLoader = this.stateManager.get('textLoader', null)\n  if (textLoader !== null) {\n    textLoader.levelVisible = true\n  } else {\n    this.stateManager.call('setLoaderValue', value)\n  }\n}\n\nconst setViewForDirection = function ({ direction = null }) {\n  const scene = this.scene\n  const camera = scene.activeCamera\n\n  if (direction === null) {\n    return 'GlobalFunctions.setViewForDirection: direction is null'\n  }\n\n  const xPos = (direction === 'LEFT') ? -50 : 50\n  camera.position = new BABYLON.Vector3(xPos, 0, 0)\n  camera.setTarget(new BABYLON.Vector3.Zero())\n  return 'View changed'\n}\n\nconst addButton = function (options = null) {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('stateManager.addButton: this.taskObject is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const canvas = stateManager.get('elements2D').canvas\n\n  const baseOptions = {\n    id: `button${stateManager.timeInMs}`,\n    text: 'text',\n    x: 50,\n    y: 50,\n    width: 100,\n    height: 50,\n    fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.8, 0.8, 0.8, 1)),\n    clickEventData: null,\n    fontName: '30pt Arial',\n    baseOpacity: 0.8,\n    hoverOpacity: 1,\n    zOrder: -0.5,\n    marginAlignment: null,\n    fontSignedDistanceField: true,\n    margin: {},\n    padding: {},\n    parent: canvas,\n  }\n\n  baseOptions.margin.leftPixels = 0\n  baseOptions.margin.rightPixels = 0\n  baseOptions.margin.topPixels = 0\n  baseOptions.margin.bottomPixels = 0\n  baseOptions.padding.leftPixels = 0\n  baseOptions.padding.rightPixels = 0\n  baseOptions.padding.topPixels = 0\n  baseOptions.padding.bottomPixels = 0\n  baseOptions.margin = _.extend(baseOptions.margin, options.margin)\n  baseOptions.padding = _.extend(baseOptions.padding, options.padding)\n  options.margin = baseOptions.margin\n  options.padding = baseOptions.padding\n\n  // extend options\n  options = _.extend(baseOptions, options)\n\n  let buttonOptions = {}\n  let margin = {}\n  let padding = {}\n  if (options.marginAlignment === null) {\n    buttonOptions = {\n      parent: options.parent,\n      id: options.id,\n      x: options.x,\n      y: options.y,\n      width: options.width,\n      height: options.height,\n      fill: options.fill,\n      zOrder: options.zOrder,\n      roundRadius: 0,\n      children: [new BABYLON.Text2D(options.text, {\n        fontName: options.fontName,\n        marginVAlignment: 'v: center',\n        fontSignedDistanceField: options.fontSignedDistanceField,\n        marginHAlignment: 3,\n      })],\n    }\n  } else {\n    buttonOptions = {\n      parent: options.parent,\n      id: options.id,\n      width: options.width,\n      height: options.height,\n      fill: options.fill,\n      zOrder: options.zOrder,\n      marginAlignment: options.marginAlignment,\n      roundRadius: 0,\n      children: [new BABYLON.Text2D(options.text, {\n        fontName: options.fontName,\n        marginVAlignment: 'v: center',\n        fontSignedDistanceField: options.fontSignedDistanceField,\n        marginHAlignment: 3,\n      })],\n    }\n    margin = options.margin\n    padding = options.padding\n  }\n\n  // create button and add to canvas\n  const buttonRect = new BABYLON.Rectangle2D(buttonOptions)\n\n  buttonRect.opacity = options.baseOpacity\n\n  if (margin !== null) {\n    buttonRect.margin.rightPixels = options.margin.rightPixels // TODO make that a specific function in the framework\n    buttonRect.margin.leftPixels = options.margin.leftPixels\n    buttonRect.margin.topPixels = options.margin.topPixels\n    buttonRect.margin.bottomPixels = options.margin.bottomPixels\n  }\n\n  if (padding !== null) {\n    buttonRect.padding.rightPixels = padding.rightPixels\n    buttonRect.padding.leftPixels = padding.leftPixels\n    buttonRect.padding.topPixels = padding.topPixels\n    buttonRect.padding.bottomPixels = padding.bottomPixels\n  }\n\n  // Add an observable for hovering\n  buttonRect.pointerEventObservable.add(() => {\n    buttonRect.opacity = options.hoverOpacity\n  }, BABYLON.PrimitivePointerInfo.PointerOver)\n\n  buttonRect.pointerEventObservable.add(() => {\n    buttonRect.opacity = options.baseOpacity\n  }, BABYLON.PrimitivePointerInfo.PointerOut)\n\n  // Add an observable for clicking\n  if ((options.clickEventData !== null) && (options.clickEventData.constructor === EventData)) {\n    buttonRect.pointerEventObservable.add(() => {\n      options.clickEventData.happenedAt = stateManager.timeInMs\n      options.clickEventData.data.button = buttonRect.id\n\n      stateManager.addEvent(options.clickEventData)\n    }, BABYLON.PrimitivePointerInfo.PointerUp)\n  }\n\n  return (buttonRect)\n}\n\nconst setMargins = function (prim, margin) {\n  prim.margin.rightPixels = margin.rightPixels // TODO make that a specific function in the framework\n  prim.margin.leftPixels = margin.leftPixels\n  prim.margin.topPixels = margin.topPixels\n  prim.margin.bottomPixels = margin.bottomPixels\n}\n\nconst showCross = function () {\n  const crossSheet = this.taskObject.cloneAssetIntoScene(this.R.get.crossSheet, this.scene)\n  crossSheet.hasAlpha = true\n\n  const guiCanvas = this.stateManager.get('GUI')\n\n\n  let cross = this.stateManager.get('cross', null)\n  if (hasConstructor(BABYLON.Sprite2D, cross)) {\n    cross.dispose()\n  }\n\n  cross = new BABYLON.Sprite2D(crossSheet, {\n    parent: guiCanvas,\n    id: 'cross',\n    marginAlignment: 'v: center, h: center',\n    spriteSize: new BABYLON.Size(20, 20),\n    spriteLocation: new BABYLON.Vector2(0, 0),\n  })\n\n  cross.spriteFrame = 0\n  cross.levelVisible = true\n\n  this.stateManager.set('cross', cross)\n}\n\nconst hideCross = function () {\n  const cross = this.stateManager.get('cross', null)\n\n  if (cross !== null) {\n    cross.levelVisible = false\n  }\n}\n\nconst highlightPosition = function (options = null) {\n  if (typeof this.stateManager === 'undefined') {\n    throw new Error('stateManager.highlightPosition: this.stateManager is undefined')\n  }\n\n  if (typeof options.position === 'undefined') {\n    throw new Error('stateManager.highlightPosition: options.position is undefined')\n  }\n\n  return (this.stateManager.promise('drawTiles', {\n    hightlight: options.position,\n    type: (typeof options.type !== 'undefined') ?\n      options.type : 'prediction',\n  }))\n}\n\nconst explode = function ({ meshes = null }) {\n  if (meshes === null) {\n    return 'No mesh given'\n  }\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters.explosion\n\n  const explosionTexture = this.taskObject.cloneAssetIntoScene(this.R.get.explosionTexture, this.scene)\n  explosionTexture.hasAlpha = true\n\n  for (const mesh of meshes) {\n    const particleSystem = new BABYLON.ParticleSystem('particles', 1000, this.scene)\n    particleSystem.particleTexture = explosionTexture\n    particleSystem.emitter = mesh\n    particleSystem.minEmitBox = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.maxEmitBox = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 0.8)\n    particleSystem.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 0.7)\n    particleSystem.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0)\n    particleSystem.minSize = parameters.minSize\n    particleSystem.maxSize = parameters.maxSize\n    particleSystem.minLifeTime = parameters.minLifeTime\n    particleSystem.maxLifeTime = parameters.maxLifeTime\n    particleSystem.emitRate = parameters.emitRate\n    particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE\n    particleSystem.gravity = new BABYLON.Vector3(0, 0, 0)\n    particleSystem.direction1 = new BABYLON.Vector3(-5, 5, 5)\n    particleSystem.direction2 = new BABYLON.Vector3(5, -5, -5)\n    particleSystem.minAngularSpeed = 0\n    particleSystem.maxAngularSpeed = Math.PI\n    particleSystem.minEmitPower = parameters.minEmitPower\n    particleSystem.maxEmitPower = parameters.maxEmitPower\n    particleSystem.updateSpeed = 0.025\n\n    particleSystem.targetStopDuration = 0.5\n    particleSystem.disposeOnStop = true\n\n    particleSystem.start()\n  }\n\n  return 'Exploded'\n}\n\nconst setBlackScreen = function (options = null) {\n  const baseOptions = { // TODO create a defaultOptions()\n    on: true,\n  }\n\n  options = _.extend(baseOptions, options)\n  const elements2D = this.stateManager.getGlobal('elements2D')\n  const canvas = elements2D.canvas\n\n  if (!_.has(elements2D, 'blackScreen')) {\n    const blackScreen = new BABYLON.Rectangle2D({\n      parent: canvas,\n      id: 'blackScreen',\n      position: new BABYLON.Vector2(0, 0),\n      width: canvas.size.width,\n      height: canvas.size.height,\n      zOrder: 0,\n    })\n\n    elements2D.blackScreen = blackScreen\n  }\n\n  if (options.on) {\n    elements2D.blackScreen.opacity = 1\n  } else {\n    elements2D.blackScreen.opacity = 0\n  }\n}\n\nconst checkIdleAndConnection = function ({ deferred = new Deferred(), returnToState = null } = { deferred: new Deferred(), returnToState: null }) {\n  const stateManager = this.stateManager\n  const R = this.R\n  const dataManager = this.dataManager\n  const connection = this.connection\n\n  const shouldCheckTime = stateManager.get('shouldCheckTime', false)\n\n  if (shouldCheckTime) {\n    return dataManager.query('getLastInteraction', null, connection, deferred).then((r) => {\n      const delay = stateManager.timeInMs - r.lastInteraction\n      const delayMin = delay / (60000)\n      if (delay > 20 * 60 * 1000) {\n        debugWarn('running.goToNextPosition: idle for too long')\n        stateManager.set('endReason', `You were idle for more than 20 min: ${delayMin} min`)\n        stateManager.goToState(R.get.states_end)\n      } else if ((returnToState !== null) && (stateManager.currentStateKey !== returnToState)) { stateManager.goToState(returnToState) }\n    })\n    .catch(() => {\n      debugWarn('running.goToNextPosition: lost connection')\n      returnToState = returnToState || stateManager.currentStateKey\n\n      if (stateManager.currentStateKey !== R.get.states_idle) {\n        stateManager.call('hideAll')\n        stateManager.onNext(this.R.get.events_unfrozen, () => { stateManager.call('showAll') })\n        this.state.freeze()\n        stateManager.goToState(R.get.states_idle)\n      }\n\n      this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n      .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState }) })\n    })\n  }\n  return Promise.resolve()\n}\n\nexport {\n  addButton,\n  highlightPosition,\n  setMargins,\n  setBlackScreen,\n  checkIdleAndConnection,\n  placePoints,\n  updatePoints,\n  showPointSpheres,\n  hidePointSpheres,\n  setViewForDirection,\n  showCross,\n  hideCross,\n  explode,\n  setLoaderValue,\n  hideLoader,\n  showLoader,\n  setTextLoaderValue }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/functions/globalFunctions.js","/**\n * startUp.js\n *\n * This file holds the code that should run on your HTML page after all the framework and page is loaded.\n *\n * Here you should :\n * - create the taskObject\n * - set up the parameters of the task\n * - register loading promise\n * - register the scenes generators\n * - start the task\n * - bind the task paramBox with relevant parameters\n *\n * Do not pollute the global space with too much variables.\n * Here two global variables are created : taskObject and calibrator.\n */\nimport $ from 'jquery'\nimport _ from 'lodash'\nimport { RessourceManager, TaskObject, Deferred, debuglog, debugError } from 'experiment-js'\nimport { SmartForm } from 'experiment-boxes'\n\nimport { DEBUG_MODE_ON } from '../../config'\n\n// import LoadingScene from './scenes/LoadingScene' Using default loading\nimport MainScene from '../scenes/main/MainScene'\n\nwindow.taskObject = null\nwindow.calibrator = null\n\n\n// When page is loaded, initiate the task\nconst defferedDomLoaded = new Deferred()\ndocument.addEventListener('DOMContentLoaded', () => {\n  defferedDomLoaded.resolve()\n})\n\nif (typeof window !== 'undefined') {\n  /* === Get the absolute path of the library === */\n  const scripts = document.getElementsByTagName('script')\n  if (scripts.length) {\n    const assetsFolderFullpath = scripts[scripts.length - 1].src\n    const delimiterIndices = assetsFolderFullpath.indicesOf('/')\n    window.assetsFolderFullpath = assetsFolderFullpath.substr(0, delimiterIndices[delimiterIndices.length - 2])\n  } else {\n    window.assetsFolderFullpath = './'\n  }\n}\n\nconst R = new RessourceManager()\nwindow.p1 = defferedDomLoaded.promise\nwindow.p2 = R.addFiles(`${window.assetsFolderFullpath}/assets/yaml/ressources.yaml`, `${window.assetsFolderFullpath}/assets/json/randomized_trials_final_pure_impure_with_training.json`)\n\nwindow.loadingPromise = Promise.all([window.p1, window.p2])\n\n\nwindow.loadingPromise.then(() => {\n  window.DEBUG_MODE_ON = DEBUG_MODE_ON\n\n  const taskObject = new TaskObject($('.task-canvas'))\n  taskObject.R.mergeWith(R)\n\n  /* --- Register scene generators --- */\n  const options = {\n    level: null,\n  }\n\n  taskObject.registerSceneGenerator(MainScene, options)\n\n  const sceneNames = ['loading', 'main']\n\n  taskObject.R.add({\n    parameters: {\n      rate: 60, // frame rate in hertz\n      framePerPosition: 1,\n      numberOfPoints: 5,\n      maxObservationTime: 5000,\n      fixationTime: 500,\n      ITI: 500,\n      trialsBeforePause: 200,\n      pauseTime: 10 * 60 * 1000,\n      shouldRandomize: 'no',\n      feedback: 'no',\n      explosion: {\n        explosionTime: 500,\n        minSize: 0.2,\n        maxSize: 1.3,\n        minLifeTime: 0.150,\n        maxLifeTime: 0.150,\n        emitRate: 30,\n        minEmitPower: 1,\n        maxEmitPower: 2 },\n    },\n  })\n\n\n  /* --- Register loading scene generator --- */\n// taskObject.registerLoadingFunction(LoadingScene)\n  taskObject.assetsToLoad = {\n    crossSheet: {\n      path: '/assets/sprites/cross/squareSheetMargin.svg',\n      type: 'texture',\n    },\n    explosionTexture: {\n      path: '/assets/sprites/explosion/particle_explosion.png',\n      type: 'texture',\n    },\n  }\n\n  /* list of tweakable variables from the paramBox */\n\n  const parametersNames = [\n    'parameters.rate',\n    'parameters.framePerPosition',\n    'parameters.numberOfPoints',\n    'parameters.maxObservationTime',\n    'parameters.fixationTime',\n    'parameters.ITI',\n    'parameters.trialsBeforePause',\n    'parameters.pauseTime',\n    'parameters.shouldRandomize',\n    'parameters.feedback',\n    'parameters.explosion.explosionTime',\n    'parameters.explosion.minSize',\n    'parameters.explosion.maxSize',\n    'parameters.explosion.minLifeTime',\n    'parameters.explosion.maxLifeTime',\n    'parameters.explosion.emitRate',\n    'parameters.explosion.minEmitPower',\n    'parameters.explosion.maxEmitPower',\n  ]\n\n  const parametersConstraints = {\n    'parameters.feedback': ['yes', 'no'],\n    'parameters.shouldRandomize': ['yes', 'no'],\n  }\n\n  // const parametersConstraints = {}\n\n  // const rParams = ['agent.scale', 'agent.predictionOpacity', 'tile.scale', 'tile.offset', 'cross.opacity']\n\n\n  // taskObject.paramBox.bind(taskObject, parametersNames, parametersConstraints)\n  taskObject.paramBox.bind(taskObject.R.data, parametersNames, parametersConstraints)\n\n\n  /* --- Login --- */\n  window.taskObject = taskObject\n  const tempMaxNumberOfRetry = taskObject.dataManager.MAX_NUMBER_OF_RETRY\n  const endpoint = `${window.assetsFolderFullpath}/api/php/mysql/index.php`\n\n  /**\n   * This function in a form generator that is called automatically by the DataManager when the user needs to login\n   * @method loginForm\n   * @return {SmartForm}  a SmartForm\n   */\n  function loginForm() {\n    const fields = {\n      userId: {\n        type: 'input',\n        constraints: 'length:3,300', // list of constraints that will be automatically verified: mandatory; alpha; numeric; length:XX; contains:a,b,@,.;\n        authorizedValues: null, // athorized values\n        parent: null,\n        title: 'User Id:',\n      },\n      password: {\n        type: 'password', // field type: input, select, textaera, slider, radio, password\n        constraints: 'length:3,300; score: 20', // list of constraints that will be automatically verified: mandatory; alpha; numeric; length:XX; contains:a,b,@,.;\n        authorizedValues: null, // athorized values\n        parent: null,\n        title: 'Enter your password, if you are new here you are free to pick one !', // you can control auto-create account in the php api config\n      },\n    }\n    const options = { fields, title: 'Login Form', format: 'topCentralSmall', callback(fields) { debuglog({ endpoint, credentials: { userId: fields.userId.value, password: fields.password.value } }) } }\n    const form = new SmartForm(options)\n    form.buttonText = 'OK'\n\n    const R = taskObject.context.R\n    const stateManager = taskObject.context.stateManager\n\n    if (stateManager) {\n      stateManager.goToState(R.get.states_active)\n    }\n\n    return form\n  }\n\n  taskObject.dataManager.authorize_manual_login = true\n  taskObject.dataManager.useLocalStorageCredentials = false\n\n  //  If you do not want to store the credentials for the connections localy set this variable to false (the password is not stored in any case, only a logging key)\n  // taskObject.dataManager.useLocalStorageCredentials = false\n  taskObject.setConnection({ endpoint, signInForm: loginForm }) // credentials: { userId: 'John', password: 'wrong' } })\n  .then((connection) => {\n    if (connection.loggedIn) {\n      return true\n    }\n    return taskObject.dataManager.login(connection)\n  })\n  .then(() => {\n    // reset the retry limit to its original value\n    taskObject.dataManager.MAX_NUMBER_OF_RETRY = tempMaxNumberOfRetry\n\n    /* --- Start task --- */\n    return taskObject.startTask()\n  })\n  .then((message) => {\n    debuglog(message)\n    // taskObject.paramBox.bind(taskObject, 'currentScene', parametersConstraints)\n    if ((sceneNames.length === 1) || (typeof taskObject.paramBox.queryString.currentScene === 'undefined')) {\n      taskObject.currentScene = 'main'\n    }\n  })\n  .catch((e) => {\n    debugError(e)\n    taskObject.modal({ type: 'centralLarge', title: R.get.loginError.title.en, content: R.get.loginError.content.en })\n    .then(() => {\n      window.open('', '_self').close()\n    })\n  })\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/startup/startup.js","/**\n * Experiment.js\n * Created. 2016\n *\n * Experiment.js toolbox.\n *\n * Authors. Albert Buchard\n *\n * Requires: lodash, BABYLON.js, mathjs, jQuery\n *\n * LICENSE Apache-2\n */\n\n if (typeof window !== 'undefined') {\n   require('./src/task/startup/startup')\n }\n\n\n\n// WEBPACK FOOTER //\n// ./builder.js","const DEBUG_MODE_ON = false\n\nexport { DEBUG_MODE_ON }\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  debugError,\n  hasConstructor,\n} from 'experiment-js'\n\nimport { SmartModal } from 'experiment-boxes'\n\nimport {\n  addButton,\n  highlightPosition,\n  setBlackScreen,\n  checkIdleAndConnection,\n  placePoints,\n  updatePoints,\n  showPointSpheres,\n  hidePointSpheres,\n  setViewForDirection,\n  showCross,\n  hideCross,\n  explode,\n  setLoaderValue,\n  hideLoader,\n  showLoader,\n  setTextLoaderValue } from './functions/globalFunctions'\n\n\nimport { selectLevel, startLevel, endActive } from './states/active'\n\nimport { showNextPage, showModal, awakeTutorial, tutorialUnfrozen } from './states/tutorial'\n\nimport {\n  awakeTryout,\n  tryoutEndPrediction,\n  tryoutCheckKeyStrokeForPrediction,\n  tryoutGoToNextPosition,\n  tryoutStartPrediction,\n  tryoutEnd,\n} from './states/tryout'\n\nimport {\n  stateUnfrozen,\n  startRunning,\n  nextTrial,\n  goToNextPosition,\n  startPrediction,\n  checkForClickPrediction,\n  checkKeyStrokeForPrediction,\n  playSound,\n  endObservation,\n  pauseTransition,\n} from './states/running'\n\nimport { awakenPause, endPause, pauseKeyDown } from './states/pause'\n\nimport { awakenEnd } from './states/end'\n\n/* =============== Main scene =============== */\nexport default function MainScene(options = {}) {\n  // option base\n  const optionsBase = {\n    sceneKey: 'main',\n    canvasBackground: new BABYLON.Color4(0, 0, 0, 1),\n    backgroundRoundRadius: 0,\n    clearColor: new BABYLON.Color4(0, 0, 0, 1),\n    canvasPercentWidth: 1,\n    canvasPercentHeight: 1,\n    mode: 'central',\n    level: null,\n  }\n\n  options = _.extend(optionsBase, options)\n\n  /* --- Get taskObject from context --- */\n  const taskObject = this.taskObject\n\n  /* --- Create a basic 3D scene--- */\n  const scene = taskObject.create3DScene(options)\n\n  /* --- Add a strong ambient light --- */\n  const light0 = new BABYLON.HemisphericLight('Hemi0', new BABYLON.Vector3(0, 1, 0), scene)\n  light0.diffuse = new BABYLON.Color3(1, 1, 1)\n  light0.specular = new BABYLON.Color3(1, 1, 1)\n  light0.groundColor = new BABYLON.Color3(1, 1, 1)\n\n  /* --- Get stateManager --- */\n  const stateManager = scene.stateManager\n\n  /* --- Get canvas --- */\n  // const canvas = scene.initialCanvas\n\n  // const camera = scene.initialCamera\n  // // // camera.detachControl(taskObject.canvas)\n  // camera.radius = 50\n  // camera.alpha = 0\n  // camera.beta = Math.PI / 2\n\n  const camera = new BABYLON.FreeCamera('OrthoCamera', new BABYLON.Vector3(-50, 0, 0), scene)\n  camera.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA\n\n  const side = 17\n  camera.orthoTop = side\n  camera.orthoBottom = -side\n  camera.orthoLeft = -side * taskObject.renderSize.width / taskObject.renderSize.height\n  camera.orthoRight = side * taskObject.renderSize.width / taskObject.renderSize.height\n  //\n  //   // This targets the camera to scene origin\n  camera.setTarget(new BABYLON.Vector3.Zero())\n  //\n  scene.activeCamera = camera\n  // camera.setPosition(new BABYLON.Vector3(50, 0, 0))\n\n  const R = taskObject.R\n\n  // const box = BABYLON.Mesh.CreateBox('', 1, scene)\n\n  /* --- Load assets --- */\n\n  scene.onResize = []\n\n  stateManager.register(\n    addButton,\n    highlightPosition,\n    setBlackScreen,\n    checkIdleAndConnection,\n    updatePoints,\n    placePoints,\n    hidePointSpheres,\n    showPointSpheres,\n    setViewForDirection,\n    showCross,\n    hideCross,\n    explode,\n    setLoaderValue,\n    hideLoader,\n    showLoader,\n    setTextLoaderValue)\n\n  stateManager.call('redrawAssets')\n\n  /* --- Setup data --- */\n  const dataManager = this.dataManager\n\n  /* --- Add cwData table that will hold a summary of the data --- */\n  const cwDataFields = [\n    'subject_id',\n    'trial',\n    'data_index',\n    'direction',\n    'position',\n    'observation_duration',\n    'subject_choice', // NA for NOGO\n    'correct',\n    'feedback',\n    'response_time', // NA for NOGO or no response\n    'key_hits', // ['key', 'time'], [k,t], ...\n    'clicks',\n    'has_paused',\n    'start_observation',\n    'end_observation',\n    'responded_at',\n  ]\n\n  dataManager.addTable('walkerData', cwDataFields)\n  dataManager.addTable('tryoutData', cwDataFields)\n\n  let userId = `unknown${this.timeInMs}`\n  try {\n    userId = dataManager.connections[0].credentials.userId\n  } catch (e) {\n    debugError(e)\n  }\n\n  stateManager.set('subject_id', userId)\n\n  /* --- Add the surveyData table --- */\n  const surveyDataFields = [\n    'level',\n    'similarTask',\n    'taskDifficulty',\n    'movementWolf',\n    'boredom',\n    'dependance',\n    'repeatsSequence',\n    'comments',\n  ]\n\n  dataManager.addTable('surveyData', surveyDataFields)\n\n  /* --- Add the logs for each level --- */\n  const eventFields = ['id', 'flag', 'happenedAt', 'handledAt', 'data']\n  dataManager.addTable('stateRunningEvents', eventFields)\n  dataManager.addTable('stateActiveEvents', eventFields)\n\n  /* --- Store scene level inside the stateManager --- */\n  stateManager.setGlobal('positionData', {\n    indexOnTransitionSequence: -1,\n    indexOnPredictionSequence: -1,\n    fullSequenceIndex: -1,\n  })\n\n  stateManager.setGlobal('hasSeenLearningInfo', false)\n  stateManager.setGlobal('hasSeenPredictionInfo', false)\n\n  /* --- Setup states --- */\n\n  /* --- Set state key and store them in the stateManager --- */\n  R.add({\n    states: {\n      running: 'running',\n      tutorial: 'tutorial',\n      tryout: 'tryout',\n      tryoutFMRI: 'tryoutFMRI',\n      end: 'end',\n    },\n    checkpoint: {\n      tutorialDone: ['tutorialOneDone', 'tutorialTwoDone'],\n      levelDone: ['levelOneDone', 'levelTwoDone', 'levelThreeDone', 'levelFourDone'],\n      taskDone: 'taskDone',\n      taskEndNoComeback: 'taskEndNoComeback',\n    },\n    flags: {\n      levelDefined: 'levelDefined',\n    },\n    events: {\n      sequenceGenerated: 'sequenceGenerated',\n      nextTrial: 'nextTrial',\n      goNextPosition: 'goNextPosition',\n      endObservation: 'endObservation',\n      startPrediction: 'startPrediction',\n      responseTimeEnded: 'responseTimeEnded',\n      isiAfterLearningEnded: 'isiAfterLearningEnded',\n      feedbackEnded: 'feedbackEnded',\n      isiAfterFeedbackEnded: 'isiAfterFeedbackEnded',\n      pauseTransition: 'pauseTransition',\n      forcePause: 'forcePause',\n      predictionStartBlackout: 'predictionStartBlackout',\n      blackoutEnds: 'blackoutEnds',\n      predictionEndsBlackout: 'predictionEndsBlackout',\n      isiAfterPredictionEndsBlackout: 'isiAfterPredictionEndsBlackout',\n      screenWentBlack: 'screenWentBlack',\n      playPredictionSound: 'playPredictionSound',\n      playObservationSound: 'playObservationSound',\n      showModal: 'showModal',\n      goToTutorial: 'goToTutorial',\n      hasResponded: 'hasResponded',\n      restartTutorial: 'restartTutorial',\n      goToLevel1: 'goToLevel1',\n      goToLevel2: 'goToLevel2',\n      goToLevel3: 'goToLevel3',\n      goToLevel4: 'goToLevel4',\n      tic: 'tic',\n      moreThanFiveNA: 'moreThanFiveNA',\n      aknowledgedEnding: 'aknowledgedEnding',\n      tutorialNext: 'tutorialNext',\n    },\n  })\n\n  // eslint-disable-next-line\n  const [tutorialState, runningState, tryoutState, endState] = stateManager.addState(R.get.states_tutorial, R.get.states_running, R.get.states_tryout, R.get.states_end)\n  const pauseState = stateManager.states.pause\n\n  /* ======== State Active ======== */\n  if (options.level !== null) {\n    const eventData = new EventData(R.get.flags_levelDefined, scene.stateManager.timeInMs, {\n      belongsTo: [\n        'globalLog', 'stateActiveEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n      level: options.level,\n    })\n    stateManager.addEvent(eventData)\n  } else {\n    stateManager.states.active.addAwakeningFunctions(selectLevel)\n  }\n\n  stateManager.states.active.addEndingFunctions(endActive)\n\n  stateManager.states.active.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  stateManager.states.active.addEventFunctions(R.get.events_goToTutorial,\n    ({ data: { tutorial } }) => {\n      stateManager.setGlobal('currentTutorial', tutorial)\n      stateManager.goToState(R.get.states_tutorial)\n    })\n\n  /* ======== State RUNNING ======== */\n  const goToPause = function () {\n    if (this.state.shouldPause) {\n      this.state.freeze()\n      if (hasConstructor(Object, this.taskObject.currentModal) && hasConstructor(SmartModal, this.taskObject.currentModal.modalBox)) {\n        this.taskObject.currentModal.modalBox.hide()\n      }\n      this.stateManager.goToState(this.R.get.states_pause)\n    }\n  }\n\n  /* --- Register functions --- */\n  runningState.addAwakeningFunctions(startRunning)\n\n  runningState.addEventFunctions(R.get.events_nextTrial, nextTrial)\n  runningState.addEventFunctions(R.get.events_goNextPosition, goToNextPosition)\n  runningState.addEventFunctions(R.get.events_endObservation, endObservation)\n\n  runningState.addEventFunctions(R.get.events_startPrediction, startPrediction)\n\n  runningState.addEventFunctions(R.get.events_pauseTransition, pauseTransition)\n\n  runningState.addEventFunctions(R.get.events_unfrozen, stateUnfrozen)\n  runningState.addEventFunctions(R.get.events_forcePause, goToPause)\n  runningState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  runningState.addEventFunctions(R.get.events_moreThanFiveNA, goToPause)\n\n  runningState.addEventFunctions(R.get.events_click, checkForClickPrediction)\n  runningState.addEventFunctions(R.get.events_keydown, checkKeyStrokeForPrediction)\n\n  runningState.addEventFunctions(R.get.events_playPredictionSound, playSound)\n  runningState.addEventFunctions(R.get.events_playObservationSound, playSound)\n\n  /* ======= State Running ======= */\n\n  // Center cross\n  // Observe movement\n  // Respond at any time\n  // ITI\n  // Center cross\n\n\n  /* ======= State Tutorial ======= */\n  tutorialState.addAwakeningFunctions(awakeTutorial)\n\n  tutorialState.addEventFunctions(R.get.events_tutorialNext, showNextPage)\n  tutorialState.addEventFunctions(R.get.events_showModal, showModal)\n\n  tutorialState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  tutorialState.addEventFunctions(R.get.events_unfrozen, tutorialUnfrozen)\n\n  tutorialState.addEventFunctions(R.get.events_playPredictionSound, playSound)\n  tutorialState.addEventFunctions(R.get.events_playObservationSound, playSound)\n\n\n  /* ======= State Tryout ======= */\n  dataManager.addTable('stateTryout1', eventFields)\n  dataManager.addTable('stateTryout2', eventFields)\n\n  tryoutState.addAwakeningFunctions(awakeTryout)\n  tryoutState.addEndingFunctions(tryoutEnd)\n\n  tryoutState.addEventFunctions(R.get.events_goNextPosition, tryoutGoToNextPosition)\n  tryoutState.addEventFunctions(R.get.events_endObservation, endObservation)\n\n  tryoutState.addEventFunctions(R.get.events_windowBlur, goToPause)\n  tryoutState.addEventFunctions(R.get.events_unfrozen, tutorialUnfrozen)\n\n  tryoutState.addEventFunctions(R.get.events_startPrediction, tryoutStartPrediction)\n  tryoutState.addEventFunctions(R.get.events_responseTimeEnded, tryoutEndPrediction)\n  tryoutState.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  tryoutState.addEventFunctions(R.get.events_restartTutorial, () => {\n    stateManager.goToState(R.get.states_tutorial)\n  })\n\n  tryoutState.addEventFunctions(R.get.events_keydown, tryoutCheckKeyStrokeForPrediction)\n  tryoutState.addEventFunctions(R.get.events_click, checkForClickPrediction)\n\n  /* ======== State Pause ======== */\n  // stateManager.setPauseKeyStroke()\n  pauseState.addAwakeningFunctions(awakenPause)\n  pauseState.addEndingFunctions(endPause)\n  pauseState.addEventFunctions(R.get.events_keydown, pauseKeyDown)\n  pauseState.addEventFunctions(R.get.events_windowFocus, pauseKeyDown)\n  // pauseState.addEventFunctions(R.get.flags_levelDefined, startLevel)\n  // pauseState.addEndingFunctions(function () { this.stateManager.promise('disposeOfButtons') })\n\n  /* ======= prematureEnd State ======= */\n  endState.addAwakeningFunctions(awakenEnd)\n\n  return scene\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/MainScene.js","import {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n} from 'experiment-js'\n\n\nconst selectLevel = function () {\n  if (typeof this.state === 'undefined') {\n    throw new Error('state.selectLevel: state is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const dataManager = this.dataManager\n  const elements2D = stateManager.get('elements2D')\n  // const GUI = stateManager.get('GUI')\n  const R = this.R\n\n  const checkTaskDone = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskDone }, this.connection)\n  const checkTaskEndNoComeback = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskEndNoComeback }, this.connection)\n  const checkTutorialOne = dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_tutorialDone[0] }, this.connection)\n\n  stateManager.call('hideAll')\n  stateManager.set('shouldCheckTime', false)\n\n  let taskEnded = false\n  const deferred = new Deferred()\n\n  Promise.all([checkTaskDone, checkTaskEndNoComeback, checkTutorialOne])\n  .then((results) => {\n    for (const result of results) {\n      if (typeof result.code === 'undefined') {\n        if (stateManager.currentStateKey !== R.get.states_idle) {\n          stateManager.goToState(R.get.states_idle)\n        }\n\n        this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n        .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n      } else if ((result.code === R.get.checkpoint_taskDone) || (result.code === R.get.checkpoint_taskEndNoComeback)) {\n        taskEnded = true\n        stateManager.set('endReason', result.message)\n        stateManager.goToState(R.get.states_end)\n\n        deferred.resolve('active.selectLevel: end of task')\n        return false\n      } else if ((result.code === R.get.checkpoint_tutorialDone[0]) && (!taskEnded)) {\n        stateManager.set('shouldCheckTime', true)\n      }\n    }\n    return this.dataManager.query('getCheckpoint', null, this.connection)\n  })\n  .then((result) => {\n    if (result !== false) {\n      if (typeof result.code === 'undefined') {\n        if (stateManager.currentStateKey !== R.get.states_active) {\n          stateManager.goToState(R.get.states_idle)\n        }\n\n        this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n        .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n      }\n\n      let eventLevel\n      switch (result.code) {\n        case R.get.checkpoint_tutorialDone[0]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 1 })\n          elements2D.wolfFaceSprite.spriteFrame = 0\n          break\n        case R.get.checkpoint_tutorialDone[1]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 4 })\n          elements2D.wolfFaceSprite.spriteFrame = 3\n          break\n        case R.get.checkpoint_levelDone[0]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 2 })\n          elements2D.wolfFaceSprite.spriteFrame = 1\n          break\n        case R.get.checkpoint_levelDone[1]:\n          eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 3 })\n          elements2D.wolfFaceSprite.spriteFrame = 2\n          break\n        case R.get.checkpoint_levelDone[2]:\n          eventLevel = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, { tutorial: 2 })\n          elements2D.wolfFaceSprite.spriteFrame = 3\n          break\n        case R.get.checkpoint_levelDone[3]:\n          stateManager.set('endReason', 'You finished the task finished')\n          stateManager.goToState(R.get.states_end)\n          break\n        case R.get.checkpoint_taskDone:\n          stateManager.set('endReason', result.message)\n          stateManager.goToState(R.get.states_end)\n          break\n        case R.get.checkpoint_taskEndNoComeback:\n          stateManager.set('endReason', result.message)\n          stateManager.goToState(R.get.states_end)\n          break\n        default:\n          // Start tutorial\n          // eventLevel = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, { level: 3 }) // TODO TAKE THAT BACk\n          eventLevel = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, { tutorial: 1 })\n\n      }\n\n      delay(150).then(() => { stateManager.addEvent(eventLevel) })\n      deferred.resolve('active.selectLevel: level selected - resolved')\n    }\n  })\n  .catch(() => {\n    if (stateManager.currentStateKey !== R.get.states_active) {\n      stateManager.goToState(R.get.states_idle)\n    }\n\n    this.taskObject.modal({ type: 'centralLarge', title: R.get.lostConnectionTitle, content: R.get.lostConnectionContent })\n    .then(() => delay(50)).then(() => { stateManager.call('checkIdleAndConnection', { returnToState: 'active' }) })\n  })\n\n  // GUI.levelVisible = true\n  // /* --- Delete buttons --- */\n  // stateManager.promise('disposeOfButtons')\n  //\n  // const eventButtonOne = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 1,\n  // })\n  // const eventButtonTwo = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 2,\n  // })\n  // const eventButtonThree = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 3,\n  // })\n  // const eventButtonFour = new EventData(R.get.flags_levelDefined, stateManager.timeInMs, {\n  //   level: 4,\n  // })\n  //\n  // const eventButtonTutorialOne = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, {\n  //   tutorial: 1,\n  // })\n  // const eventButtonTutorialFour = new EventData(R.get.events_goToTutorial, stateManager.timeInMs, {\n  //   tutorial: 2,\n  // })\n  //\n  // const width = 220\n  // const height = 40\n  // const widthOffset = width / 2\n  //\n  // const buttonOptionLevelOne = {\n  //   id: 'levelOne',\n  //   parent: GUI,\n  //   text: 'Level 1',\n  //   marginAlignment: 'h: center, v: bottom',\n  //   margin: {\n  //     rightPixels: (width) + widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   width,\n  //   height,\n  //   fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.8, 0.8, 0.8, 1)),\n  //   clickEventData: eventButtonOne,\n  //   callbackFunction: null,\n  //   fontName: '20pt Arial',\n  //   baseOpacity: 0.8,\n  //   hoverOpacity: 1,\n  // }\n  //\n  // const buttonOptionTutorialOne = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonTutorialLevelFour',\n  //   text: 'Tutorial 1',\n  //   margin: {\n  //     rightPixels: (width) + widthOffset,\n  //     bottomPixels: height,\n  //   },\n  //   clickEventData: eventButtonTutorialOne,\n  // })\n  //\n  //\n  // const buttonOptionLevelTwo = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelTwo',\n  //   text: 'Level 2',\n  //   margin: {\n  //     rightPixels: widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonTwo,\n  // })\n  //\n  // const buttonOptionLevelThree = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelThree',\n  //   text: 'Level 3',\n  //   margin: {\n  //     leftPixels: widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonThree,\n  // })\n  //\n  // const buttonOptionLevelFour = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonLevelFour',\n  //   text: 'Level 4',\n  //   margin: {\n  //     leftPixels: (width) + widthOffset,\n  //     topPixels: 0,\n  //   },\n  //   clickEventData: eventButtonFour,\n  // })\n  //\n  // const buttonOptionTutorialFour = _.extend(_.clone(buttonOptionLevelOne), {\n  //   id: 'buttonTutorialLevelFour',\n  //   text: 'Tutorial 4',\n  //   margin: {\n  //     leftPixels: (width) + widthOffset,\n  //     bottomPixels: height,\n  //   },\n  //   clickEventData: eventButtonTutorialFour,\n  // })\n  //\n  // Promise.all([stateManager.promise('addButton', buttonOptionLevelOne),\n  //   stateManager.promise('addButton', buttonOptionLevelTwo),\n  //   stateManager.promise('addButton', buttonOptionLevelThree),\n  //   stateManager.promise('addButton', buttonOptionLevelFour),\n  //   stateManager.promise('addButton', buttonOptionTutorialOne),\n  //   stateManager.promise('addButton', buttonOptionTutorialFour),\n  // ])\n  //   .then((buttons) => {\n  //     elements2D.levelButtons = buttons\n  //     for (const button of buttons) {\n  //       button.levelVisible = true\n  //     }\n  //     deferred.resolve('stateManager.selectLevel: resolved')\n  //   })\n\n  return deferred.promise\n}\n\nconst startLevel = function (options = null) {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('state.startLevel: this.taskObject is undefined')\n  }\n\n  if (typeof options.data.level === 'undefined') {\n    throw new Error('state.startLevel: options.level is undefined')\n  }\n\n  /* --- Get context --- */\n  const taskObject = this.taskObject\n  const stateManager = this.stateManager\n  const R = this.R\n  const elements2D = stateManager.get('elements2D')\n  stateManager.emptyTimeTriggerEvents()\n  elements2D.agent.opacity = 0\n  elements2D.cross.spriteFrame = R.get.cross_base\n\n  /* --- Delete buttons --- */\n  stateManager.promise('disposeOfButtons')\n\n  stateManager.setGlobal('level', options.data.level)\n  stateManager.setGlobal('levelObject', taskObject.parameters.levels[options.data.level - 1])\n\n  stateManager.set('positionData', {\n    indexOnTransitionSequence: -1,\n    indexOnPredictionSequence: -1,\n    fullSequenceIndex: taskObject.parameters.levels[options.data.level - 1].sequenceObject.fullSequence.length - 3, // TODO PUT IT BACK -1,\n  })\n\n  if (stateManager.currentStateKey !== R.get.states_running) { stateManager.goToState(R.get.states_running) }\n\n  return ('state.startLevel: resolved')\n}\n\nconst endActive = function () {\n  // this.stateManager.promise('disposeOfButtons')\n}\nexport { startLevel, selectLevel, endActive }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/active.js","import { EventData } from 'experiment-js'\n\nconst awakenEnd = function () {\n  const R = this.R\n  const scene = this.scene\n  this.stateManager.call('hideAll')\n  scene.initialGui.levelVisible = false\n  this.dataManager.authorize_manual_login = false\n  this.dataManager.query('hasCheckpoint', { checkpoint: R.get.checkpoint_taskDone }, this.connection)\n  .then((r) => {\n    const event = new EventData(this.R.get.events_aknowledgedEnding)\n    this.stateManager.onNext(this.R.get.events_aknowledgedEnding, () => {\n      window.open('', '_self').close()\n    })\n    let reason = 'You completed the task !'\n    let title = R.get.taskFinishedTitle\n    let content = R.get.taskFinishedContent\n\n    if (r.code !== R.get.checkpoint_taskDone) {\n      reason = this.stateManager.get('endReason', '')\n      title = R.get.taskStoppedTitle\n      content = R.get.taskStoppedMessage\n      if (reason !== '') {\n        content += R.get.taskStoppedReason.replace('{t}', reason)\n      }\n      this.taskObject.setCheckpoint(R.get.checkpoint_taskEndNoComeback, reason)\n\n      this.taskObject.modal({ type: 'centralLarge', title, content, event })\n    } else {\n      // this.dataManager.query('getFinalCode', null, this.connection)\n      // .then((r) => {\n      //   content = content.replace('{c}', r.code)\n      this.taskObject.modal({ type: 'centralLarge', title, content, event })\n      // })\n    }\n  })\n}\n\nexport { awakenEnd } //eslint-disable-line\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/end.js","import BABYLON from 'experiment-babylon-js'\nimport {\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  hasConstructor,\n  delay,\n} from 'experiment-js'\n\nimport { setMargins } from '../functions/globalFunctions'\n\n\nconst awakenPause = function () {\n  const stateManager = this.stateManager\n  const levelObject = stateManager.get('levelObject')\n  const GUI = stateManager.get('GUI')\n  const R = this.R\n  const state = this.state\n  const pauseTime = stateManager.timeInMs\n  const threshold = R.get.thresholdIdle\n\n\n  state.hitKeyTime = null\n  state.initialGuiVisible = GUI.levelVisible\n\n  GUI.backgroundFill = BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0, 0, 0, 1))\n  GUI.levelVisible = true\n\n  const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: pauseTime })\n  if (lastPauseInfo.level !== levelObject.level) {\n    stateManager.set('pauseTimeLeft', threshold)\n  }\n\n  const currentTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n  stateManager.set('lastPauseInfo', { level: levelObject.level, time: pauseTime })\n\n  // datamanager get pause left\n  const options = { id: 'pauseText',\n    parent: GUI,\n    marginAlignment: 'h: center, v: center',\n    fontName: '30pt Arial',\n    fontSignedDistanceField: true,\n  }\n\n  state.timerText = function () {\n    const timeLeft = parseInt((currentTimeLeft - stateManager.timeInMs + pauseTime) / 1000, 10)\n    if (timeLeft < 0) { return false }\n    return R.get.timeLimitText.replace('{n}', String(timeLeft))\n  }\n\n  let t = 0\n  const delayInMs = 200\n  state.tic = function () {\n    state.centerText.levelVisible = true\n    const text = state.timerText()\n    if (text === false) {\n      stateManager.set('endReason', R.get.endReasonIdle.replace('{t}', (threshold / 1000)).replace('{l}', levelObject.level))\n      stateManager.goToState(R.get.states_end)\n    } else {\n      state.centerText.text = text\n      delay(delayInMs).then(() => {\n        if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n      })\n      t += delayInMs\n      if (t >= 3000) {\n        stateManager.get('sounds').prediction.play()\n        t = 0\n      }\n    }\n  }\n\n  if (!hasConstructor(BABYLON.Text2D, state.centerText)) {\n    state.topText = new BABYLON.Text2D(R.get.pauseText, options)\n    setMargins(state.topText, { topPixels: 0, bottomPixels: 40, leftPixels: 0, rightPixels: 0 })\n    state.centerText = new BABYLON.Text2D(state.timerText(), options)\n  } else {\n    state.topText.levelVisible = true\n    state.centerText.levelVisible = true\n    state.centerText.text = state.timerText\n  }\n\n\n  delay(200).then(() => {\n    if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n  })\n}\n\nconst pauseKeyDown = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n  const levelObject = { level: 0 } // stateManager.get('levelObject')\n  const R = this.R\n  const context = this\n  const threshold = R.get.thresholdIdle\n\n  if (state.hitKeyTime === null) { state.hitKeyTime = stateManager.timeInMs }\n\n  state.timerText = function () {\n    const timeLeft = Math.ceil((3000 - stateManager.timeInMs + state.hitKeyTime) / 1000, 10)\n    if (timeLeft < 0) { return false }\n    return R.get.pauseRestart.replace('{n}', String(timeLeft))\n  }\n\n  state.tic = function () {\n    const text = state.timerText()\n    if (text !== false) {\n      state.centerText.text = text\n      delay(200).then(() => {\n        if (!document.hasFocus()) {\n          const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: stateManager.timeInMs })\n          const previousTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n          const currentTimeLeft = previousTimeLeft - stateManager.timeInMs + lastPauseInfo.time\n\n          stateManager.set('pauseTimeLeft', currentTimeLeft)\n          awakenPause.bind(context)()\n        } else if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n      })\n    } else if (stateManager.frozenState) { stateManager.goToState(stateManager.frozenState) }\n  }\n\n  delay(200).then(() => {\n    if (!document.hasFocus()) {\n      awakenPause.bind(context)()\n    } else if (stateManager.currentStateKey === R.get.states_pause) { state.tic() }\n  })\n}\n\nconst endPause = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const levelObject = { level: 0 } // stateManager.get('levelObject')\n  const GUI = stateManager.get('GUI')\n  const R = this.R\n  const threshold = R.get.thresholdIdle\n\n  GUI.backgroundFill = BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(1, 1, 1, 0))\n  GUI.levelVisible = state.initialGuiVisible\n\n  state.hitKeyTime = null\n  state.topText.levelVisible = false\n  state.centerText.levelVisible = false\n\n  const lastPauseInfo = stateManager.get('lastPauseInfo', { level: levelObject.level, time: stateManager.timeInMs })\n  const previousTimeLeft = stateManager.get('pauseTimeLeft', threshold)\n  const currentTimeLeft = previousTimeLeft - stateManager.timeInMs + lastPauseInfo.time\n\n  if (currentTimeLeft < -3) {\n    stateManager.call('prematureEnd', { reason: R.get.prematureEndPauseAboveThreshold })\n  } else {\n    stateManager.set('pauseTimeLeft', currentTimeLeft)\n  }\n}\n\n\nexport { awakenPause, endPause, pauseKeyDown }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/pause.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n  mandatory,\n  debuglog,\n  debugError,\n  sizeToVec,\n  hasConstructor,\n  samplePermutation,\n  rep,\n} from 'experiment-js'\n\n  /* --- State function --- */\n\nconst stateUnfrozen = function () {\n  if (_.has(this.state, 'currentTrialData.hasPaused')) {\n    this.state.currentTrialData.hasPaused = true\n  }\n}\n\nconst pauseTransition = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  /* --- Get the trial data --- */\n  const trials = this.R.get.trials\n\n  const index = stateManager.get('currentTrial', 0)\n  const pausesDone = stateManager.get('pausesDone', 0)\n\n  try {\n    if (index + 1 >= trials.length) {\n      return this.taskObject.setCheckpoint(R.get.checkpoint_taskDone).promise\n      .then(() => {\n        stateManager.goToState(R.get.states_end)\n      })\n    }\n    const maxTransitionTime = parameters.pauseTime + stateManager.timeInMs\n    const promise = stateManager.resolveOnKey({ except: null })\n    let shouldtic = true\n    let text2d\n\n    const transitionText = function () {\n      const timeLeft = Math.ceil((maxTransitionTime - stateManager.timeInMs) / 1000, 10)\n      if (timeLeft < 0) { return false }\n      return R.get.finishedLevelTransition.replace('{n}', String(timeLeft)).replace('{l}', String(pausesDone.length))\n    }\n\n    state.tic = function () {\n      if (!shouldtic) { return }\n      const text = transitionText()\n      if (text !== false) {\n        text2d.text = text\n        state.tooltipPause.box.levelVisible = true\n        delay(200).then(() => {\n          state.tooltipPause.box.levelVisible = false\n          state.tic()\n        })\n      } else {\n        stateManager.set('endReason', 'You were idle for more than 15 min')\n        stateManager.goToState(R.get.states_end)\n      }\n    }\n\n    const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n    state.tooltipPause = stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, (this.taskObject.renderSize.height / 2) - 100)), text: transitionText(), duration: promise })\n    text2d = state.tooltipPause.text\n    this.state.shouldPause = false\n    state.tic()\n\n    return promise.then(() => {\n      shouldtic = false\n      stateManager.newEvent(R.get.events_nextTrial, null, null, ['stateRunningEvents'])\n      // stateManager.newEvent(R.get.flags_levelDefined, null, { level: level + 1 }, ['globalLog', `stateRunningEventsLvl${level}`])\n    })\n  } catch (e) {\n    debugError('running.pauseTransition: error with the level data.')\n    stateManager.set('endReason', 'There was an error with the task. We are sorry.')\n    stateManager.goToState(R.get.states_end)\n    return 'Running.pauseTransition: Error'\n  }\n}\n\nconst startRunning = function () {\n  if (typeof this.taskObject === 'undefined') {\n    throw new Error('state.startRunning: this.taskObject is undefined')\n  }\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = stateManager.R\n  const parameters = R.get.parameters\n\n  R.get.trials = R.get.trials.slice(1, 20)\n\n  if (!document.hasFocus()) {\n    stateManager.newEvent(R.get.forcePause)\n  }\n\n  state.shouldPause = false\n  state.pausedBetween = []\n  stateManager.call('showAll')\n  stateManager.call('setLoaderValue', 0)\n\n  if (stateManager.get('trialIndices') === null) {\n    if (parameters.shouldRandomize === 'yes') {\n      stateManager.set('trialIndices', samplePermutation(rep(0, R.get.trials.length).map((o, i) => i)))\n    } else {\n      stateManager.set('trialIndices', rep(0, R.get.trials.length).map((o, i) => i))\n    }\n  }\n\n  /* --- Setup state variables --- */\n  if (typeof state.data === 'undefined') {\n    state.data = []\n  }\n  state.numberOfMissed = 0\n  state.isPredicting = false\n\n  /* --- Store the data --- */\n  const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n  const promise = stateManager.resolveOnKey({ except: null })\n  stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, (this.taskObject.renderSize.height / 2) - 100)), text: 'You are about to start the task\\nHit a key to when ready', duration: promise })\n\n\n  promise.then(() => {\n    // show the first position\n    const nextTransitionTime = this.stateManager.timeInMs + 100\n    const nextTransitionEvent = new EventData(R.get.events_nextTrial, nextTransitionTime, {\n      belongsTo: [\n        'globalLog', 'stateRunningEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n    })\n    stateManager.addTimeTriggerEvent(nextTransitionEvent)\n  })\n\n\n  return ('state.startRunning: resolved')\n}\n\nconst storeData = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n\n  /* --- If currentTrialData is already set, send it to the dataManager to be stored before handling new position --- */\n  let dataToStore = state.currentTrialData\n  try {\n    if ((hasConstructor(Object, state.currentTrialData)) && (stateManager.get('subject_id'))) {\n      const { trial, dataIndex, direction, choice, feedback, responseTime, startObservation,\n      endObservation, respondedAt, keysHits, hasPaused, clicks } = state.currentTrialData\n\n      // check if next position is not end of sequence\n      const correct = direction === choice\n\n      /* --- Store the data --- */\n      dataToStore = {\n        subject_id: stateManager.get('subject_id'),\n        trial,\n        data_index: dataIndex,\n        direction,\n        observation_duration: endObservation - startObservation,\n        subject_choice: choice, // NA for NOGO\n        response_time: responseTime, // NA for NOGO or no response\n        correct,\n        feedback,\n        key_hits: JSON.stringify(keysHits), // ['key', 'time'], [k,t], ...\n        clicks: JSON.stringify(clicks),\n        has_paused: hasPaused,\n        start_observation: startObservation,\n        end_observation: endObservation,\n        responded_at: respondedAt,\n        belongsTo: ['walkerData'],\n      }\n\n      stateManager.storeData(dataToStore)\n      state.currentTrialData = null\n    }\n  } catch (e) {\n    const message = 'runningState.goToNextPosition: could not store cwData.'\n    debugError(message)\n    stateManager.storeInErrorLog({ message, timestamp: stateManager.timeInMs, data: dataToStore })\n    // TODO check that the stateManager will store it in the DB\n  }\n}\n\nconst nextTrial = function () {\n  /* --- Get parameters --- */\n  const parameters = this.R.get.parameters\n\n  // explode spheres\n  if ((parameters.feedback === 'yes') && (hasConstructor(Object, this.state.currentTrialData)) && (this.state.currentTrialData.direction === this.state.currentTrialData.choice)) {\n    this.stateManager.call('explode', { meshes: this.stateManager.get('pointSpheres', []) })\n  }\n  // start from a new position - set the prediction phase to false\n  this.state.isPredicting = false\n\n  // hide the spheres\n  this.stateManager.call('hidePointSpheres')\n\n  /* --- Store Data --- */\n  storeData.bind(this)()\n\n  /* --- Get the trial data --- */\n  const trials = this.R.get.trials\n  const trialIndices = this.stateManager.get('trialIndices', rep(0, this.R.get.trials.length).map((o, i) => i))\n  const pausesDone = this.stateManager.get('pausesDone', [])\n  const trialIndex = this.stateManager.get('currentTrial', -1) + 1\n\n  if ((trialIndex >= trials.length) || (Math.floor(trialIndex / parameters.trialsBeforePause) > pausesDone.length)) {\n    this.stateManager.set('pausesDone', pausesDone.concat(pausesDone.length))\n    this.stateManager.newEvent(this.R.get.events_pauseTransition, null, null, ['globalLog', 'stateRunningEvents'])\n    return 'End trials'\n  }\n\n  this.stateManager.call('setLoaderValue', Math.floor(100 * trialIndex / trials.length))\n  this.stateManager.call('setTextLoaderValue', trialIndex)\n\n  // const trialIndex = _.random(0, trials.length - 1)\n  this.stateManager.set('currentTrial', trialIndex)\n  this.stateManager.set('currentDataTrialIndex', trialIndices[trialIndex])\n  const trialData = trials[trialIndices[trialIndex]] // NOTE used for randomization\n\n  /* --- Set up the stored data --- */\n  // setup the trialData for this specific trial\n  const data = {\n    trial: trialIndex, // sequenceObject.trial[index],\n    dataIndex: trialIndices[trialIndex],\n    direction: trialData.direction, // sequenceObject.trialType[index],\n    positions: trialData.positions,\n    feedback: parameters.feedback,\n    currentIndex: -1,\n    state: this.state.stateKey,\n    choice: null,\n    responseTime: null,\n    startObservation: null,\n    endObservation: null,\n    respondedAt: null,\n    keysHits: [],\n    clicks: [],\n    hasPaused: false,\n  }\n\n  this.state.data.push(data)\n\n  // Change the currentTrialData to match new index\n  // keep the currentTrialData reference directly in the state\n  this.state.currentTrialData = data\n\n  // wait for explosion to finish\n  delay(parameters.explosion.explosionTime).then(() => {\n    // change the camera based on the future direction\n    this.stateManager.call('setViewForDirection', data)\n\n    // show the center cross\n    this.stateManager.call('showCross')\n  })\n\n  // wait fixation time then start looping\n  if (trialIndex === 21) {\n    const tutorial = this.R.get.tutorials_getHarder\n    const event = new EventData(this.R.get.events_goNextPosition)\n    this.taskObject.modal({ type: 'centralLarge', title: tutorial.title.en, content: tutorial.content.en, event })\n    this.taskObject.currentModal.modalBox.buttonText = 'Next'\n  } else {\n    this.stateManager.newEvent(this.R.get.events_goNextPosition, parameters.ITI + parameters.explosion.explosionTime, null, ['stateRunningEvents'])\n  }\n\n  return 'End nextTrial'\n}\n\nconst goToNextPosition = function () {\n  if (this.state.currentTrialData === 'undefined') {\n    return 'State.Running.goToNextPosition: undefined current trial data'\n  }\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = stateManager.R\n  const parameters = R.get.parameters\n\n  // hide the cross\n  stateManager.call('hideCross')\n\n  // get the trial data\n  const trialData = state.currentTrialData\n\n  /* --- Check the participant is doing the task and has valid connection --- */\n  if (!document.hasFocus()) {\n    stateManager.newEvent(R.get.events_windowBlur, null, null, ['stateRunningEvents'])\n  }\n\n  let checkConnection = false\n  if (hasConstructor(Deferred, this.state.checkLastInteraction)) {\n    if (!this.state.checkLastInteraction.pending) {\n      this.state.checkLastInteraction = new Deferred()\n      checkConnection = true\n    }\n  } else {\n    this.state.checkLastInteraction = new Deferred()\n    checkConnection = true\n  }\n\n  if (checkConnection) {\n    stateManager.call('checkIdleAndConnection', { deferred: this.state.checkLastInteraction })\n  }\n\n  /* --- Check if observation has started or set it up --- */\n  if (trialData.startObservation === null) {\n    trialData.startObservation = stateManager.timeInMs\n  }\n\n  /* --- Check if observation-prediction is finished --- */\n  if (((stateManager.timeInMs - trialData.startObservation) > parameters.maxObservationTime) || (trialData.choice !== null)) {\n    trialData.endObservation = stateManager.timeInMs\n    stateManager.newEvent(R.get.events_nextTrial, null, null, ['stateRunningEvents'])\n    return 'End observation'\n  }\n\n  // make sure the spheres are showing\n  this.stateManager.call('showPointSpheres')\n\n  // accept prediction\n  state.isPredicting = true\n\n  /* --- Setup next position --- */\n  const positions = trialData.positions\n\n  /* --- Set index --- */\n  if (trialData.currentIndex + parameters.framePerPosition >= positions.length) {\n    trialData.currentIndex = -1\n  }\n  trialData.currentIndex += parameters.framePerPosition\n\n  const index = trialData.currentIndex\n\n  /* --- Check if end of level --- */\n  if (index >= positions.length) {\n    // positionData.fullSequenceIndex -= 1\n    // go to endBlock -> pause - wait for next level to start\n    const nextTransitionEvent = new EventData(R.get.events_pauseTransition, stateManager.timeInMs, {\n      belongsTo: [\n        'globalLog', 'stateRunningEvents',\n      ],\n      handledAt: null,\n      storedAt: null,\n    })\n    stateManager.addTimeTriggerEvent(nextTransitionEvent)\n    return ('goToNextPosition: resolved. End of sequence.')\n  }\n\n\n  // set up a deferred object to return and catch promises resolution\n  const deferred = new Deferred()\n\n  // Redraw tiles and move to next position\n  const points = positions[index]\n  const rate = parameters.rate\n  stateManager.promise('updatePoints', points)\n  .then(() => {\n    // delay(1000 / rate).then(() => {\n    stateManager.newEvent(R.get.events_goNextPosition, 1000 / rate, null, ['stateRunningEvents'])\n    // })\n\n    if (state.numberOfMissed >= 5) {\n      stateManager.newEvent(R.get.events_moreThanFiveNA, null, null, ['stateRunningEvents'])\n      deferred.resolve('goToNextPosition: resolved. Too many NA.')\n    }\n\n    deferred.resolve('stateManager.goToNextPosition: resolved')\n  })\n  /* --- Check if data is set and if subject had not been idle  --- */\n\n\n  return deferred.promise\n}\n\nconst endObservation = function () {\n  this.state.currentTrialData.endObservation = this.stateManager.timeInMs\n  this.stateManager.call('setAgentOpacity', { opacity: 0 })\n  return 'endObservation resolved'\n}\n\nconst startPrediction = function () {\n  if (typeof this.state.currentTrialData === 'undefined') {\n    throw new Error('state.startPrediction: state.currentTrialData is undefined')\n  }\n\n  const state = this.state\n  const stateManager = this.stateManager\n  const R = stateManager.R\n\n  state.numberOfMissed += 1\n\n  const levelObject = stateManager.get('levelObject')\n  stateManager.promise('setAgentOpacity', { opacity: R.get.agent_predictionOpacity })\n\n  stateManager.call('drawPredictionTiles')\n\n  const cross = this.stateManager.get('elements2D').cross\n  cross.spriteFrame = R.get.cross_predict\n  if (levelObject.sound === true) { this.stateManager.get('sounds').prediction.play() }\n\n  state.isPredicting = true\n  state.currentTrialData.startPrediction = stateManager.timeInMs\n  const endResponse = levelObject.predictionDuration\n\n  this.stateManager.newEvent(R.get.events_responseTimeEnded, endResponse, null, ['stateRunningEvents'])\n}\n\nconst checkForClickPrediction = function (event = mandatory()) {\n  try {\n    if (typeof this.taskObject === 'undefined') {\n      throw new Error('state.checkForClickPrediction: this.taskObject is undefined')\n    }\n\n      // todo with click detection Canvas2D\n    if (typeof event.data.clientY === 'undefined') {\n      throw new Error('state.checkForClickPrediction: event.data.clientY is undefined.')\n    }\n\n    if (typeof this.state.currentTrialData === 'undefined') {\n      throw new Error('state.checkForClickPrediction: options.trialData is undefined')\n    }\n\n    const stateManager = this.stateManager\n    const state = this.state\n\n    state.currentTrialData.clicks.push([event.data.engineX, event.data.engineY, stateManager.timeInMs])\n  } catch (e) {\n    debugError(e)\n  }\n  return 'checkForClickPrediction resolved'\n}\n\nconst checkKeyStrokeForPrediction = function (event = mandatory()) {\n  try {\n    if (typeof this.taskObject === 'undefined') {\n      throw new Error('state.checkKeyStrokeForPrediction: this.taskObject is undefined')\n    }\n\n    if (typeof event.data.keyCode === 'undefined') {\n      throw new Error('state.startPrediction: event.data.keyCode is undefined')\n    }\n\n    if (typeof this.state.currentTrialData === 'undefined') {\n      throw new Error('state.startPrediction: state.currentTrialData is undefined')\n    }\n\n    const stateManager = this.stateManager\n    const state = this.state\n    const R = this.R\n\n    const keyCode = event.data.keyCode\n\n    const keyValue = event.data.key\n\n    if (_.has(state, 'currentTrialData.keysHits')) {\n      if (!hasConstructor(Array, state.currentTrialData.keysHits)) {\n        state.currentTrialData.keysHits = []\n      }\n\n      state.currentTrialData.keysHits.push([keyValue, keyCode, stateManager.timeInMs])\n    }\n\n    const keys = {\n      ArrowLeft: [39, 'LEFT', R.get.cross_bottomRight],\n      ArrowRight: [37, 'RIGHT', R.get.cross_topLeft],\n    }\n\n    let direction = null\n    for (const key in keys) {\n      if (keys.hasOwnProperty(key)) {\n        const keyPosition = keys[key]\n        if (keyValue === key) {\n          direction = keyPosition[1]\n        }\n      }\n    }\n\n    if (direction !== null) {\n      /* --- Check if the subjects click was during the prediction phase and that he did not already chose  --- */\n\n      if ((state.isPredicting === true) && (state.currentTrialData.choice === null)) {\n        /* --- If the key was one of the specified store the corresponding direction, responseTime and choice --- */\n\n\n          // Store the choice of the subject and responseTime\n        state.currentTrialData.choice = direction\n        state.currentTrialData.responseTime = stateManager.timeInMs - state.currentTrialData.startObservation\n        state.currentTrialData.respondedAt = stateManager.timeInMs\n\n        // stateManager.call('highlightPosition', { direction })\n\n          // reset the number of missed trials\n        state.numberOfMissed = 0\n\n        debuglog(`state.checkKeyStrokeForPrediction: has chosen direction ${direction}.`)\n        return direction\n      }\n      debuglog('state.checkKeyStrokeForPrediction: already chosen')\n      return false\n    }\n    debuglog('state.checkKeyStrokeForPrediction: key did not correspond to state selection keys.')\n    return false\n  } catch (e) {\n    debugError(e)\n    return false\n  }\n}\n\nconst playSound = function (event) {\n  const sounds = this.stateManager.getGlobal('sounds')\n  sounds[event.data.name].play()\n}\n\nexport {\n  stateUnfrozen,\n  startRunning,\n  nextTrial,\n  goToNextPosition,\n  startPrediction,\n  checkForClickPrediction,\n  checkKeyStrokeForPrediction,\n  playSound,\n  endObservation,\n  pauseTransition,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/running.js","import _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  Deferred,\n  delay,\n  mandatory,\n  debuglog,\n  hasConstructor,\n  rep,\n  sizeToVec,\n  debugError,\n  debugWarn,\n} from 'experiment-js'\n\nimport { getFullSequenceObjectForClassicLevels, sampleExponential } from '../../../utilities/taskUtilities'\n\n\nconst awakeTryout = function () {\n  const taskObject = this.taskObject\n  const state = this.state\n  const currentTutorial = this.stateManager.get('currentTutorial', 1)\n  const stateManager = this.stateManager\n  const elements2D = stateManager.get('elements2D')\n  const R = this.R\n\n  elements2D.loader.value = 0\n  stateManager.call('showAll')\n\n  state.data = state.data || []\n  state.isPredicting = false\n  state.shouldPause = (currentTutorial !== 1)\n  state.index = -1\n  stateManager.setGlobal('level', `tryout-${currentTutorial}`)\n\n  if (currentTutorial === 1) {\n    // set classic sequence object with 10 transition\n    state.sequenceObject = getFullSequenceObjectForClassicLevels([1, 3, 4, 2, 1, 3, 4, 2, 1, 3, 2, 4, 2, 1, 3])\n    stateManager.setGlobal('levelObject', this.taskObject.parameters.levels[0])\n  } else {\n    // set fMRI sequence object with 5 transition wolf and 5 transition rabbit\n    state.sequenceObject = {\n      fullSequence: [1, 2, 1, 3, 4, 2, 1, 3, 4, 3],\n      trial: _.range(1, 10),\n      trialType: rep(['observation_prediction', 'blackout'], 5),\n      block: rep(1, 5).concat(rep(2, 5)),\n      blockType: rep('random', 5).concat(rep('normal', 5)),\n    }\n    stateManager.setGlobal('levelObject', taskObject.parameters.levels[3])\n  }\n\n  this.stateManager.newEvent(this.R.get.events_goNextPosition, null, null, [`stateTryout${currentTutorial}`])\n}\n\nconst tryoutGoToNextPosition = function () {\n  // TODO experiment-boxes penser a faire dans un tooltip tool qui permet de focus sur un element et fait un modal en dessous pour expliquer\n\n  const stateManager = this.stateManager\n  const state = this.state\n  state.index += 1\n\n  const elements2D = stateManager.get('elements2D')\n  const levelObject = stateManager.get('levelObject')\n  const cross = elements2D.cross\n  const R = this.R\n  const tutorials = R.get.tutorials\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n  const index = state.index\n  const sequenceObject = state.sequenceObject\n\n  stateManager.hideTooltip()\n  state.isWaitingToPredict = new Deferred()\n  state.isWaitingToPredict.resolve()\n\n  const ntransition = sequenceObject.fullSequence.length\n  // Check if finished\n  if (index > ntransition - 1) {\n    // show finished tryout\n    stateManager.call('hideAll')\n\n    if (currentTutorial === 1) {\n      const event = new EventData(this.R.get.flags_levelDefined, stateManager.timeInMs, { level: 1 })\n      this.taskObject.modal({ title: tutorials.askContinue.title.en, content: tutorials.askContinue.content.en, event })\n    } else {\n      const event = new EventData(this.R.get.flags_levelDefined, stateManager.timeInMs, { level: 4 })\n      this.taskObject.modal({ title: tutorials.askfMRIContinue.title.en, content: tutorials.askfMRIContinue.content.en, event })\n    }\n\n    this.taskObject.currentModal.modalBox.buttonText = 'Go !'\n\n    return 'state.tryoutGoToNextPosition: finished tryout'\n  }\n\n  elements2D.loader.value = 100 * index / ntransition\n\n\n  let lastChoice = null\n  if ((typeof state.currentTrialData === 'object') && (typeof state.currentTrialData.choice === 'number')) {\n    lastChoice = parseInt(state.currentTrialData.choice, 10)\n  }\n\n  // setup the trialData for this specific trial\n  const trialData = {\n    level: levelObject.level,\n    fullSequenceIndex: index,\n    block: sequenceObject.block[index],\n    blockType: sequenceObject.blockType[index],\n    trial: sequenceObject.trial[index],\n    trialType: sequenceObject.trialType[index],\n    state: state.stateKey,\n    position: sequenceObject.fullSequence[index],\n    choice: null,\n    responseTime: null,\n    startObservation: null,\n    endObservation: null,\n    respondedAt: null,\n    startPrediction: null,\n    endPrediction: null,\n    nextPosition: null,\n    observedTransitionWasDominant: null,\n    keysHits: [],\n    clicks: [],\n    hasPaused: null,\n  }\n  state.data.push(trialData)\n\n  /* --- If currentTrialData is already set, send it to the dataManager to be stored before handling new position --- */\n  let dataToStore = state.currentTrialData\n  try {\n    if ((typeof state.currentTrialData !== 'undefined') && (stateManager.get('subject_id'))) {\n      const { block, blockType, trial, trialType, position, choice, responseTime, startObservation,\n      startPrediction, respondedAt, endPrediction, keysHits, hasPaused, clicks, endObservation } = state.currentTrialData\n\n      /* --- Check if the transition observed was dominant --- */\n      const dominant = null\n\n\n      /* --- Store the data --- */\n      dataToStore = {\n        subject_id: stateManager.get('subject_id'),\n        level: currentTutorial,\n        block,\n        block_type: blockType,\n        dominant_structure: levelObject.dominantStructure,\n        dominant_transition_probability: levelObject.dominantProbability,\n        trial,\n        trial_type: trialType,\n        position,\n        observation_duration: startPrediction ? (startPrediction - startObservation) : (this.timeInMs - startObservation),\n        observed_transition_was_dominant: dominant, // NA for first transition in a sublevel and after prediction\n        transition_to: sequenceObject.fullSequence[index], // NA for GO trials (non blackouts)\n        subject_choice: choice, // NA for NOGO\n        response_time: responseTime, // NA for NOGO or no response\n        correct: parseInt(sequenceObject.fullSequence[index], 10) === parseInt(choice, 10),\n        key_hits: JSON.stringify(keysHits), // ['key', 'time'], [k,t], ...\n        clicks: JSON.stringify(clicks),\n        has_paused: hasPaused,\n        start_observation: startObservation,\n        end_observation: endObservation,\n        start_prediction: startPrediction,\n        responded_at: respondedAt,\n        end_prediction: endPrediction,\n        belongsTo: ['tryoutData'],\n      }\n      stateManager.storeData(dataToStore)\n    }\n  } catch (e) {\n    const message = 'runningState.goToNextPosition: could not store cwData.'\n    debugError(message)\n    stateManager.storeInErrorLog({ message, timestamp: stateManager.timeInMs, data: dataToStore })\n    // TODO check that the stateManager will store it in the DB\n  }\n\n    // keep the currentTrialData reference directly in the state\n  state.currentTrialData = trialData\n\n    // start from a new position - set the prediction phase to false\n  state.isPredicting = false\n\n  // set up a deferred object to return and catch promises resolution\n  // const deferred = new Deferred()\n\n  let agentType = 'wolf'\n  if (sequenceObject.blockType[index] === 'random') { agentType = 'rabbit' }\n  if (elements2D.agentType !== agentType) {\n    stateManager.call('setAgent', { agent: agentType })\n  }\n\n  cross.spriteFrame = this.R.get.cross_base\n  stateManager.call('drawTiles', { withKeys: false })\n  stateManager.call('moveAgentToTile', { tile: trialData.position - 1, opacity: 1 })\n  let promise = Promise.resolve()\n  if ((currentTutorial === 1) && (!R.get.wolfFirstAppears.passed)) {\n    promise = this.taskObject.modal({ title: R.get.wolfFirstAppears_title, content: R.get.wolfFirstAppears_message })\n    R.get.wolfFirstAppears.passed = true\n  } else if ((currentTutorial === 2) && (!R.get.rabbitFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.rabbitFirstAppear_title, content: R.get.rabbitFirstAppear_message })\n    R.get.rabbitFirstAppear.passed = true\n  } else if ((currentTutorial === 2) && (sequenceObject.trialType[index - 1] === 'blackout') && (!R.get.blackoutFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.blackoutFirstAppear_title, content: R.get.blackoutFirstAppear_message })\n    R.get.blackoutFirstAppear.passed = true\n  } else if ((currentTutorial === 2) && (sequenceObject.blockType[index] === 'normal') && (!R.get.wolfFmriFirstAppear.passed)) {\n    promise = this.taskObject.modal({ title: R.get.wolfFmriFirstAppear_title, content: R.get.wolfFmriFirstAppear_message })\n    R.get.wolfFmriFirstAppear.passed = true\n  }\n\n  promise.then(() => {\n    trialData.startObservation = stateManager.timeInMs\n\n    let promise = Promise.resolve()\n\n    const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n    if ((index !== 0) && (sequenceObject.trialType[index - 1] !== 'blackout') && (sequenceObject.blockType[index - 1] === sequenceObject.blockType[index])) {\n      if (lastChoice === sequenceObject.fullSequence[index]) {\n         // Correct\n        const background = new BABYLON.Color4(0.1, 0.7, 0.1, 0.9)\n        let text = 'Correct!'\n        let duration = 2000\n        if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n          text += '\\nHit a key to continue'\n          promise = stateManager.resolveOnKey({ except: null })\n          duration = promise\n        }\n\n\n        let position = centerPosition\n        const tilePosition = stateManager.call('getTilePositions')[lastChoice - 1]\n        position = tilePosition\n        stateManager.tooltip({ position, background, text, duration })\n      } else {\n           // Incorrect\n        const background = new BABYLON.Color4(0.7, 0.1, 0.1, 0.9)\n\n        let position = centerPosition // TODO this.taskObject.center\n        if (hasConstructor(Number, lastChoice)) {\n          const tilePosition = stateManager.call('getTilePositions')[lastChoice - 1]\n               // const sign = Math.sign(position.subtract(tilePosition).x)\n          position = tilePosition\n        }\n\n        let text = 'Incorrect!'\n        let duration = 2000\n        if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n          text += '\\nHit a key to continue'\n          promise = stateManager.resolveOnKey({ except: null })\n          duration = promise\n        }\n\n        stateManager.tooltip({ position, background, text, duration })\n      }\n    }\n\n\n    if (currentTutorial === 1 && !R.get.predictionTest.passed && R.get.predictionTest.numberOfPrediction >= 3) {\n      R.get.predictionTest.passed = true\n      promise = stateManager.resolveOnKey({ except: null })\n      stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, centerPosition.y - 100)), text: `${R.get.realTimeTest_message}\\nHit a key to continue`, duration: promise })\n    } else if (R.get.predictionTest.passed) {\n      delay(1000).then(() => { state.isWaitingToPredict = new Deferred() })\n    }\n\n    return promise\n  })\n  .then(() => {\n    trialData.startObservation = stateManager.timeInMs\n    stateManager.newEvent(R.get.events_endObservation, levelObject.observationDuration, null, [`stateRunningEventsLvl${levelObject.level}`])\n\n    if (currentTutorial === 1) {\n      const nextTransitionTime = trialData.startObservation + levelObject.observationDuration + _.random(levelObject.minISIAfterLearning, levelObject.maxISIAfterLearning)\n      stateManager.newEvent(this.R.get.events_startPrediction, nextTransitionTime, null, [`stateTryout${currentTutorial}`])\n    } else if (sequenceObject.trialType[index] === 'blackout') {\n      const observationTime = levelObject.observationDuration +\n            levelObject.fixedISIAfterObservation +\n            sampleExponential(levelObject.sampleMeanISIAfterObservation, 0, levelObject.maxSampleAfterObservation, levelObject.maxSampleAfterObservation)\n\n      // add a blackout delay\n      delay(observationTime).then(() => {\n        stateManager.newEvent(R.get.events_screenWentBlack, null, [`stateRunningEventsLvl${levelObject.level}`])\n        stateManager.call('setAgentOpacity', { opacity: 0 })\n      })\n\n\n      const blackoutTime = observationTime + levelObject.fixedBlackScreenDuration +\n            sampleExponential(levelObject.sampleMeanBlackScreen, 0, levelObject.maxSampleBlackScreen, levelObject.maxSampleBlackScreen)\n\n          // create prediction event\n      stateManager.newEvent(R.get.events_goNextPosition, blackoutTime, null, [`stateRunningEventsLvl${levelObject.level}`])\n    } else if (sequenceObject.trialType[index] === 'observation_prediction') {\n      let observationTime = stateManager.timeInMs + levelObject.observationDuration + levelObject.fixedISIAfterObservation\n      observationTime += sampleExponential(levelObject.sampleMeanISIAfterObservation, 0, levelObject.maxSampleAfterObservation, levelObject.maxSampleAfterObservation)\n\n      debugWarn('Observation Time', (observationTime - stateManager.timeInMs) / 1000)\n          // create prediction event\n      stateManager.newEvent(R.get.events_startPrediction, observationTime, [`stateRunningEventsLvl${levelObject.level}`])\n    } else {\n      debugError('Error in sequence', sequenceObject)\n    }\n  })\n\n  return 'tryoutGoToNextPosition: finish sync call'\n}\n\nconst tryoutStartPrediction = function () {\n  const state = this.state\n  const stateManager = this.stateManager\n  const R = stateManager.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n  const levelObject = stateManager.get('levelObject')\n  stateManager.promise('setAgentOpacity', { opacity: R.get.agent_predictionOpacity })\n\n  const cross = stateManager.get('elements2D').cross\n  cross.spriteFrame = R.get.cross_predict\n\n  const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n\n  let promise = Promise.resolve()\n  if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n    stateManager.call('drawPredictionTiles', { withKeys: 'dkmc' })\n    promise = stateManager.resolveOnKey({ except: null })\n    stateManager.tooltip({\n      position: centerPosition.add(new BABYLON.Vector2(0, centerPosition.y - 100)),\n      text: `${R.get.predictionTest_message}\\n${R.get.hitAKeyToContinue}`,\n      duration: promise,\n      event: new EventData('predictionTextDismissed'),\n    })\n\n    const text = R.get.changeCenterSquare\n    stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, -50)), text, duration: promise })\n  } else {\n    stateManager.call('drawPredictionTiles')\n  }\n\n  promise.then(() => {\n    state.isPredicting = true\n    state.isWaitingToPredict = new Deferred()\n    state.isWaitingToPredict.resolve()\n    state.currentTrialData.startPrediction = stateManager.timeInMs\n\n    if ((currentTutorial === 1) && (!R.get.predictionTest.passed)) {\n      const background = null // new BABYLON.Color4(0.6, 100 / 255, 0, 0.9)\n      const choiceDeferred = new Deferred()\n      state.choiceDeferred = choiceDeferred\n\n      const text = R.get.chooseNextPosition\n      stateManager.tooltip({ position: centerPosition, background, text, duration: choiceDeferred.promise })\n      choiceDeferred.promise.then(() => {\n        stateManager.newEvent(R.get.events_responseTimeEnded, stateManager.timeInMs + levelObject.predictionDuration, null, [`stateTryout${currentTutorial}`])\n      })\n    } else if (currentTutorial === 1) {\n      stateManager.newEvent(R.get.events_responseTimeEnded, stateManager.timeInMs + levelObject.predictionDuration, null, [`stateTryout${currentTutorial}`])\n    } else {\n      stateManager.call('setAgentOpacity', { opacity: 0 })\n      const endResponse = levelObject.predictionDuration\n      delay(endResponse).then(() => {\n        this.state.isPredicting = false\n        if (this.state.currentTrialData.choice !== null) {\n          cross.spriteFrame = R.get.crossLockByPosition[this.state.currentTrialData.choice - 1]\n        } else {\n          cross.spriteFrame = R.get.cross_base\n        }\n      })\n      const endPrediction = endResponse + levelObject.fixedISIAfterPrediction +\n          sampleExponential(levelObject.sampleMeanISIAfterPrediction, null, levelObject.maxSampleAfterPrediction, levelObject.maxSampleAfterPrediction)\n\n      this.stateManager.newEvent(R.get.events_goNextPosition, endPrediction, null, [`stateTryout${currentTutorial}`])\n    }\n  })\n}\n\nconst tryoutCheckKeyStrokeForPrediction = function (event = mandatory()) {\n  if (typeof event.data.keyCode === 'undefined') {\n    throw new Error('state.checkKeyStrokeForPrediction: event.data.keyCode is undefined')\n  }\n\n\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n\n  const keyCode = event.data.keyCode\n  const keyValue = event.data.key\n  const keys = {\n    m: [77, 3, R.get.cross_bottomRight],\n    d: [68, 1, R.get.cross_topLeft],\n    c: [67, 4, R.get.cross_bottomLeft],\n    k: [75, 2, R.get.cross_topRight],\n  }\n\n  if (_.has(state, 'currentTrialData.keysHits')) {\n    if (!hasConstructor(Array, state.currentTrialData.keysHits)) {\n      state.currentTrialData.keysHits = []\n    }\n\n    state.currentTrialData.keysHits.push([keyValue, keyCode, stateManager.timeInMs])\n  }\n\n  let position = null\n  let cross = 1\n  let chosenKey = null\n  for (const key in keys) {\n    if (keys.hasOwnProperty(key)) {\n      const keyPosition = keys[key]\n      if (keyValue === key) {\n  //  if (keyCode === keyPosition[0]) {\n        position = keyPosition[1]\n        cross = keyPosition[2]\n        chosenKey = key\n      }\n    }\n  }\n\n  if (position !== null) {\n  /* --- Check if the subjects hit was during the prediction phase and that he did not already chose  --- */\n\n    if ((state.isPredicting === true) && (state.currentTrialData.startPrediction !== null) && (state.currentTrialData.choice === null)) {\n    /* --- If the key was one of the specified store the corresponding position, responseTime and choice --- */\n\n      // Store the choice of the subject and responseTime\n      if (hasConstructor(Deferred, state.choiceDeferred)) {\n        state.choiceDeferred.resolve()\n        state.choiceDeferred = null\n      }\n\n      state.currentTrialData.choice = position\n      state.currentTrialData.responseTime = stateManager.timeInMs - state.currentTrialData.startPrediction\n      state.currentTrialData.respondedAt = stateManager.timeInMs\n\n      this.stateManager.get('elements2D').cross.spriteFrame = cross\n      if (!R.get.predictionTest.passed) {\n        R.get.predictionTest.numberOfPrediction += 1\n\n        const centerPosition = sizeToVec(this.taskObject.renderSize).scale(0.5)\n        let tilePosition = stateManager.call('getTilePositions')[position - 1]\n        const sign = Math.sign(centerPosition.subtract(tilePosition).x)\n        tilePosition = tilePosition.add(new BABYLON.Vector2(sign * 50, sign * 50))\n        stateManager.tooltip({ position: tilePosition, text: `${R.get.youSelectedThisTile} (${chosenKey})`, duration: delay(2000) })\n        const text = R.get.aLittleSquareShowsYourChoice\n        stateManager.tooltip({ position: centerPosition.add(new BABYLON.Vector2(0, -50)), text, duration: 2000 })\n      }\n\n      // reset the number of missed trials\n      state.numberOfMissed = 0\n\n\n      stateManager.newEvent(R.get.events_hasResponded, null, null, [`stateTryout${currentTutorial}`])\n      debuglog(`state.checkKeyStrokeForPrediction: has chosen position ${position}.`)\n      return position\n    } else if (hasConstructor(Deferred, state.isWaitingToPredict) && state.isWaitingToPredict.pending) {\n      const background = new BABYLON.Color4(0.7, 0.1, 0.1, 0.9)\n      stateManager.tooltip({ position: new BABYLON.Vector2((this.taskObject.renderSize.width / 2), (this.taskObject.renderSize.height / 2) - 100), text: R.get.tooEarly, background, duration: state.isWaitingToPredict })\n      state.isWaitingToPredict.resolve()\n      debuglog('state.checkKeyStrokeForPrediction: too early')\n      return false\n    }\n    debuglog('state.checkKeyStrokeForPrediction: already chosen')\n    return false\n  }\n  debuglog('state.checkKeyStrokeForPrediction: not a valid time to choose or already chosen')\n  return false\n}\n\nconst tryoutEndPrediction = function () {\n  const stateManager = this.stateManager\n  const state = this.state\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n\n  /* --- End prediction - store data --- */\n  state.isPredicting = false\n  state.currentTrialData.endPrediction = stateManager.timeInMs\n\n  stateManager.newEvent(R.get.events_goNextPosition, null, null, [`stateTryout${currentTutorial}`])\n  return ('state.endPrediction: resolved')\n}\n\n\nconst tryoutEnd = function () {\n  const stateManager = this.stateManager\n  const R = this.R\n\n  const currentTutorial = stateManager.get('currentTutorial', 1)\n  this.taskObject.setCheckpoint(R.get.checkpoint_tutorialDone[currentTutorial - 1])\n}\n\nexport {\n  awakeTryout,\n  tryoutEndPrediction,\n  tryoutCheckKeyStrokeForPrediction,\n  tryoutGoToNextPosition,\n  tryoutStartPrediction,\n  tryoutEnd,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/tryout.js","import {\n  EventData,\n  Array, // eslint-disable-line\n  String, // eslint-disable-line\n  delay,\n  debuglog,\n  hasConstructor,\n} from 'experiment-js'\n\nimport { SmartModal } from 'experiment-boxes'\n\n\nconst pageOrderTutorialOne = ['intro', 'disclaimer', 'trialInstruction', 'arrowKeyboard', 'progressInstruction']\n\nconst awakeTutorial = function () {\n  const currentTutorial = this.stateManager.get('currentTutorial', 1)\n\n  const pageOrder = pageOrderTutorialOne\n\n  this.stateManager.set('currentPage', pageOrder[0])\n\n  const showIntro = new EventData(this.R.get.events_showModal, { page: pageOrder[0] })\n  this.stateManager.addEvent(showIntro)\n\n\n  this.stateManager.set('levelObject', { level: `tutorial-${currentTutorial}` })\n  this.state.shouldPause = (currentTutorial !== 1)\n}\n\nconst showModal = function ({ data: { page = 'intro' } }) {\n  const tutorials = this.R.get.tutorials\n  delay(50).then(() => { // TODO Check why you have to do that ...\n    if (tutorials.hasOwnProperty(page)) {\n      const tutorial = tutorials[page]\n      const event = new EventData(this.R.get.events_tutorialNext, { page })\n      this.taskObject.modal({ type: 'centralLarge', title: tutorial.title.en, content: tutorial.content.en, event })\n      this.taskObject.currentModal.modalBox.buttonText = 'Next'\n    }\n  })\n}\n\nconst tutorialUnfrozen = function () {\n  if (hasConstructor(Object, this.taskObject.currentModal) && hasConstructor(SmartModal, this.taskObject.currentModal.modalBox)) {\n    this.taskObject.currentModal.modalBox.show()\n  }\n}\n\nconst showNextPage = function ({ data: { page: currentPage = this.stateManager.get('currentPage', 'intro') } }) {\n  const pageOrder = pageOrderTutorialOne\n  const R = this.R\n\n  const currentIndex = pageOrder.indexOf(currentPage)\n  if (currentIndex !== -1) {\n    if (currentIndex !== pageOrder.length - 1) {\n      const showEvent = new EventData(R.get.events_showModal, { page: pageOrder[currentIndex + 1] })\n      this.stateManager.addEvent(showEvent)\n    } else {\n      debuglog('state.showNextPage: end of tutorial.')\n      this.stateManager.goToState(R.get.states_running, true) // TODO make it able to use the state object as well\n    }\n  } else {\n    throw new Error('state.showNextPage: invalid currentPage.')\n  }\n}\n\nexport { showNextPage, showModal, awakeTutorial, tutorialUnfrozen }\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/scenes/main/states/tutorial.js","/** @module taskUtilities */\nimport math from 'experiment-mathjs'\nimport _ from 'lodash'\n\nimport { mandatory, rep } from 'experiment-js'\nimport BABYLON from 'experiment-babylon-js'\n\n/* ======= Texture Functions ======= */\nconst getAspectRatio = function (surfaceObject = mandatory()) {\n  if (surfaceObject.constructor === BABYLON.Texture) {\n    const { width: w, height: h } = surfaceObject.getBaseSize()\n    return (w / h)\n  }\n\n  throw new Error('getAspectRatio: object type not valid.')\n}\n\n/* =============== Task specific functions =============== */\n/**\n * Returns an array of the four possible main transition matrices\n * @return {Array} Each of the four entry is a 16*16 matrix with either 0 or 1\n */\n\nconst getDensity = function (elements, nsteps = 100, windowSize = 3) { // eslint-disable-line\n  if (elements.some(isNaN)) {\n    throw new Error('TaskObject.getDensity: elements are not all numeric.')\n  }\n\n  const range = [math.min(elements), math.max(elements)]\n\n  const stepSize = (range[1] - range[0]) / nsteps\n  // const windowLenght = stepSize * windowSize\n\n  const elementsInWindow = []\n  const windowPosition = []\n  const density = []\n  const points = []\n  for (let i = 0; i < nsteps; i++) {\n    const subset = _.filter(elements, (e) => {\n      const centered = e - range[0] - (i * stepSize)\n      return ((centered >= 0) && (centered < stepSize))\n    })\n\n    windowPosition[i] = (i + 0.5) * stepSize\n    elementsInWindow[i] = subset.length\n    density[i] = elementsInWindow[i] / elements.length\n    points[i] = {\n      x: windowPosition[i],\n      y: density[i],\n    }\n  }\n\n  return ({\n    windows: {\n      position: windowPosition,\n      numberOfElements: elementsInWindow,\n      density,\n    },\n    points,\n    chartOptions: {\n      type: 'line',\n      data: {\n        datasets: [{\n          label: 'Density',\n          data: points,\n        }],\n      },\n      options: {\n        scales: {\n          xAxes: [{\n            type: 'linear',\n            position: 'bottom',\n          }],\n        },\n      },\n    },\n  })\n}\n\nconst randomColor = function (opacity) {\n  return `rgba(${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${opacity || '.3'})`\n}\n\nconst computeDurationEstimate = function (options = {}) {\n  const parametersBase = {\n    dominantProbability: 0.76,\n    minNumberOfObservationsPerLearning: 3,\n    maxNumberOfObservationsPerLearning: 7,\n    observationDuration: 500,\n    interObservationDuration: 50, // to add ?\n    minTimeToPredict: 2000,\n    maxTimeToPredict: 5000,\n    feedbackDuration: 500,\n    minISIAfterLearning: 1000,\n    maxISIAfterLearning: 1500,\n    minISIAfterFeedback: 3000,\n    maxISIAfterFeedback: 5000,\n    rabbitAutoTransition: false,\n    rabbitDominantProbability: 0.6,\n    observationSegmentSizes: [3, 4, 5],\n    observationSegmentRepetitionPerBlock: 2,\n    numberOfBlocks: 6,\n    numberOfRandomBlocks: 2,\n    feedbackType: 'transition',\n  }\n\n  options = _.extend(parametersBase, options)\n\n  // number of observation = sum(segment sizes) * segment repetition per block\n  const numberOfObservationPerLevel = math.sum(options.observationSegmentSizes) * options.observationSegmentRepetitionPerBlock\n\n  // duration of one observation = observationDuration (add inter observation duration ?)\n  const oneObservationDuration = options.observationDuration\n\n  // observation duration for one block\n  const observationsDurationPerBlock = numberOfObservationPerLevel * oneObservationDuration\n\n  // number of prediction per block\n  const numberOfPredictionEventsPerBlock = options.observationSegmentSizes.length * options.observationSegmentRepetitionPerBlock\n\n  // min max and mean duration of one prediction event stored in a matrix\n  // timeDurationMatrix 4*2 min, max\n  const timeDurationMatrix = math.matrix([\n    [options.minISIAfterLearning, options.maxISIAfterLearning],\n    [options.minTimeToPredict, options.maxTimeToPredict],\n    [options.feedbackDuration, options.feedbackDuration],\n    [options.maxISIAfterFeedback, options.maxISIAfterFeedback],\n  ])\n\n  // factorMatrix 2*3 min max mean\n  const factorMatrix = math.matrix([\n    [1, 0, 1 / 2],\n    [0, 1, 1 / 2],\n  ])\n\n  // predictionDurationMatrix 4*3\n  const predictionDurationMatrix = math.multiply(timeDurationMatrix, factorMatrix)\n\n  // sumPredictionDurationVector 1*3\n  const sumPredictionDurationVector = math.multiply(math.matrix([1, 1, 1, 1]), predictionDurationMatrix)\n\n  const predictionsDurationPerBlock = math.multiply(sumPredictionDurationVector, numberOfPredictionEventsPerBlock)\n\n  // duration of one block\n  const observationDurationMatrix = math.matrix(rep(observationsDurationPerBlock, 3))\n\n  const durationPerBlock = math.add(observationDurationMatrix, predictionsDurationPerBlock)\n\n  // let total duration for one level min max mean in miliseconds\n  const totalDuration = (math.multiply(durationPerBlock, (options.numberOfBlocks + options.numberOfRandomBlocks))).toArray()\n\n  return ({\n    min: totalDuration[0],\n    max: totalDuration[1],\n    mean: totalDuration[2],\n  })\n}\n\nexport {\n  computeDurationEstimate,\n  randomColor,\n  getDensity,\n  getAspectRatio,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/task/utilities/taskUtilities.js","module.exports = __WEBPACK_EXTERNAL_MODULE_16__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}\n// module id = 16\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_17__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}\n// module id = 17\n// module chunks = 0"],"sourceRoot":""}